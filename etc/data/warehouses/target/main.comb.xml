if (typeof window.PopWeb !== 'undefined') {
    throw 'Namespace conflict: "PopWeb" in use.';
}

window.PopWeb = { };
/* object.create.polyfill.js */
if (typeof Object.create !== 'function') {
   Object.create = function(o, props) {
    function F() {}
    F.prototype = o;
  
    if (typeof(props) === "object") {
     for (prop in props) {
      if (props.hasOwnProperty((prop))) {
       F[prop] = props[prop];
      }
     }
    }
    return new F();
   };
}
/* FlashOverlay.js */
/*
    Flash Overlay Controller
    6/28/12
    MS

    DEPENDENCIES:
    jQuery
    
    PURPOSE:
    Singleton that controls loading a flash experience into a modal
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = new Object(); }

TARGET.FlashOverlay = (function(){
    var _instance;
    
    function kickoff(){
        return {    
			_isFlash: false,
			flashLoaded: false,
			minFlashVersion: '9.0.0',
			galleryContainer: $('.gallery'),
			textLink: $('a.textLink'),
			overlayLinkUrl: "#",
			initialize: function(options){
				var self = this;
				
				this.options = options;					
				this.openLinks = $(self.options.openLinkSelector);
				this.overlayLinkClass = self.options.overlayLinkClass;
				this.containerId = this.options.containerId;
				this._flashButtonText = this.options.flashButtonText;
				this._noFlashButtonText = this.options.noFlashButtonText;

				this.isFlash();
				this.updateOverlayLinkUrl();
				this.createOverlayLink();

				this.setupExperience();
				
				$(window).resize(function(){
					self.setupExperience();
				});
				
			},
			setupExperience: function() {
				var self = this;
				this.isFlash();
				this.updateOverlayLinkUrl();
				
				//this.openLinks = $('body.history.about .gallery .redBtn');
				this.overlayLink = $('a.'+this.overlayLinkClass);
				
				
				if (this._isFlash && !Modernizr.touch) {
					this.flashButtonText();
					
					this.openLinks.bind("click", function(e){
						e.preventDefault();
						self.loadFlash();
					});
					this.overlayLink.bind("click", function(e){
						e.preventDefault();
						self.loadFlash();
					});
				} else {
					this.noFlashButtonText();
					
					this.openLinks.bind("click", function(e){
						//e.preventDefault();
					});
				};
			},
			loadFlash: function(){
				var self = this;
				
				if (self.flashLoaded == false) {
					self.embedFlash();
					var flashObject = $('#'+this.containerId);
					
					var templateHeight = this.options.templateHeight;
					
					$.overlay.load({
						div: flashObject,
						height: templateHeight,
						onClose: function(){
							self.unembedFlash();
							self.setupExperience();
						}
					});
					
				};
				
			},
			isFlash: function(){
				var self = this;
				
				if (swfobject.hasFlashPlayerVersion(this.minFlashVersion)) {
					this._isFlash = true;
				} else {
					this._isFlash = false;
				};
			},
			createOverlayLink: function(){
				var self = this;
				
				this.galleryContainer.find('img').wrap('<div class="galleryImageWrapper" />').parent('.galleryImageWrapper').append('<a href="'+this.overlayLinkUrl+'" class="'+this.overlayLinkClass+'"></a>');
				
				if (this.overlayLinkUrl = '#'+this.containerId) {

				} else {

				};
				
				this.overlayCreated = true;
				
			},
			updateOverlayLinkUrl: function(){
				var self = this;
				
				if (!this._isFlash || Modernizr.touch) {
					this.overlayLinkUrl = this.textLink.attr('href');
				} else {
					this.overlayLinkUrl = '#'+this.containerId;
				};
			},
			noFlashButtonText: function(){
				var self = this;
				
				this.openLinks.attr('href', this.overlayLinkUrl).text(this._noFlashButtonText);
				this.textLink.css('display', 'none');
			},
			flashButtonText: function(){
				var self = this;
				
				this.openLinks.attr('href', this.overlayLinkUrl).text(this._flashButtonText);
				this.textLink.css('display', 'block');
			},
			embedFlash: function(){
				var self = this;
				
				swfobject.embedSWF(
					this.options.shellSWF,  
					this.options.containerId, 
					this.options.width, 
					this.options.height, 
					"9.0.0", 
					"../../../images/company/flash/global/expressInstall.swf",
					this.options.flashOptions,
					{
						allowScriptAccess: "always",				
						menu: "false",
						scale: "noscale",
						wmode: "opaque"
					},
					{id: this.options.containerId}
				);	
					
				this.flashLoaded = true;
			},
			unembedFlash: function(){
				var self = this;
				
				$('#'+this.options.containerId).remove();
				$('.primaryColumn').after('<div id="'+this.options.containerId+'"></div>');
				this.flashLoaded = false;
			}
        };
    };
    return {
        getInstance: function(){
            if(!_instance)
                _instance = kickoff();
            return _instance;
        }
    };
})();
/* targetMaps.js */
/*

	Target Maps
	VERSION 0.5
	AUTHOR JF

	DEPENDENCIES:
	- Bing Maps API v7.0
	- jQuery

	TODO:
	- 
	
*/

var TMAPS = {
	init: function (options) {
		var self = this,
			key;
		
		// Defaults
		self.options = {
			mapElement: document.getElementById("distCenterMap"),
			iconImagePath: '/_ui/img/global/small-pin.png',
			microsoftMapsCredentials: "Ak280HLmROTyGC6_JYfrOcMOI2ir10pS5MQ4sTjnKH3Irvlm-UPwfT5y74AhzhO7",
			startLocation: new Microsoft.Maps.Location(39.909736, -96.108398),
			startZoom: 4
		};
		
		// Validate options
		if (typeof options === 'object') {
			for (key in self.options) {
				if (typeof options[key] !== "undefined") {
					self.options[key] = options[key];
				}
			}
		}

		// Create map
		self.map = new Microsoft.Maps.Map(self.options.mapElement,
					{ credentials: self.options.microsoftMapsCredentials,
						center: self.options.startLocation,
						mapTypeId: Microsoft.Maps.MapTypeId.road,
						zoom: self.options.startZoom
					});
	},
	addPins: function (pins) {
		var self = this,
			i,
			pin;
		
		// Iterate over pins array
		for (i = 0; i < pins.length; i++) {	
			
			var latVal = parseInt(pins[i][0]);
			var longVal = Microsoft.Maps.Location.normalizeLongitude(parseInt(pins[i][1]));
			var location = new Microsoft.Maps.Location(latVal, longVal);
			
			var pin = new Microsoft.Maps.Pushpin(location, {
				draggable: false,
				icon: self.options.iconImagePath
			}); 
			
			self.map.entities.push(pin);
		}
	}
};
/* targetMapData.js */
TMAPS.allTargetLocations = 
[[45.0528, -93.3655],
[46.8087, -92.1681],
[44.8602, -93.3116],
[38.7538, -90.4263],
[32.9274, -96.814],
[38.8381, -104.756],
[36.137, -95.9205],
[42.957, -87.9512],
[38.5945, -90.5477],
[39.6778, -105.056],
[35.5244, -97.5644],
[35.4193, -97.5291],
[39.8401, -105.085],
[44.9495, -93.2367],
[32.8566, -96.7521],
[43.1768, -88.0159],
[46.8607, -96.853],
[40.0216, -105.257],
[33.0376, -96.7077],
[44.9502, -93.0281],
[41.5994, -93.753],
[29.7354, -95.5684],
[43.512, -96.7691],
[38.9211, -90.1707],
[40.5275, -105.079],
[33.8646, -98.534],
[43.0348, -88.1774],
[33.528, -101.872],
[32.9871, -96.8897],
[48.2073, -101.312],
[42.4907, -90.7222],
[35.1135, -89.9034],
[37.6833, -97.2514],
[39.0921, -108.603],
[30.3622, -97.7159],
[30.2333, -97.7924],
[44.9695, -93.4466],
[40.0599, -85.6551],
[38.0157, -87.5764],
[40.4753, -86.1089],
[38.1248, -85.855],
[40.5064, -88.9555],
[38.3053, -85.8416],
[36.3037, -86.6941],
[36.0428, -86.6585],
[36.1307, -86.8539],
[39.5932, -104.882],
[35.9255, -84.043],
[42.6992, -87.8436],
[38.9054, -104.78],
[30.1268, -94.1546],
[34.7886, -92.2284],
[42.8474, -106.264],
[31.2808, -92.4613],
[45.7705, -108.583],
[29.565, -98.4798],
[32.2228, -110.88],
[34.2318, -119.177],
[34.2455, -118.42],
[34.0908, -118.148],
[34.0787, -117.292],
[34.0184, -118.152],
[33.9483, -118.167],
[33.7875, -117.914],
[33.7618, -117.956],
[33.7987, -118.123],
[33.9994, -118.394],
[33.8889, -118.395],
[33.8267, -118.346],
[32.7522, -117.21],
[32.6046, -117.08],
[32.6512, -117.089],
[32.8162, -117.151],
[33.9065, -117.46],
[45.5571, -94.2087],
[40.8163, -96.655],
[32.4023, -99.763],
[44.8545, -93.425],
[35.1858, -101.935],
[33.9919, -117.919],
[42.992, -87.9083],
[41.1615, -104.8],
[34.1101, -117.76],
[33.9375, -118.048],
[34.1904, -118.627],
[33.8039, -118.012],
[33.8242, -117.835],
[33.6008, -111.99],
[44.2713, -88.4709],
[38.9635, -92.3733],
[45.0656, -93.307],
[34.6737, -118.149],
[34.2815, -118.742],
[33.7256, -117.986],
[33.7028, -117.887],
[33.3942, -111.786],
[33.3383, -111.844],
[47.4935, -111.272],
[31.432, -100.501],
[32.8391, -96.9908],
[39.6366, -104.789],
[34.4203, -118.561],
[34.0312, -117.684],
[33.5708, -117.705],
[44.9371, -93.3468],
[36.1711, -115.21],
[36.1574, -115.06],
[36.117, -115.139],
[38.746, -121.254],
[39.5652, -104.965],
[37.6871, -120.996],
[33.1135, -117.1],
[36.8097, -119.847],
[34.5061, -117.329],
[42.6285, -82.9965],
[42.3279, -83.1971],
[42.2032, -83.2557],
[42.3374, -83.3912],
[42.5282, -83.1082],
[33.7591, -117.851],
[34.167, -118.587],
[33.8472, -118.063],
[33.8866, -118.317],
[33.9473, -117.382],
[33.8887, -117.874],
[34.1879, -118.372],
[32.9804, -117.061],
[34.1381, -117.245],
[34.2622, -119.237],
[34.2309, -118.561],
[33.6062, -117.689],
[34.1081, -117.574],
[34.1382, -117.983],
[33.1841, -117.33],
[32.8091, -116.96],
[32.9109, -117.146],
[33.7893, -116.481],
[34.9217, -120.435],
[38.5623, -121.498],
[38.6615, -121.349],
[38.6005, -121.402],
[37.992, -121.314],
[36.7803, -119.772],
[39.7256, -121.807],
[39.146, -121.633],
[33.3795, -111.908],
[37.6736, -122.465],
[37.4754, -122.218],
[37.4007, -122.106],
[37.324, -122.036],
[37.2645, -121.918],
[37.7068, -121.931],
[37.9776, -122.067],
[38.1317, -122.224],
[38.008, -121.84],
[27.7067, -97.3735],
[33.6836, -117.81],
[47.9099, -122.227],
[47.8328, -122.267],
[47.5747, -122.172],
[47.2374, -122.48],
[47.1588, -122.295],
[45.6508, -122.592],
[45.4878, -122.788],
[45.4543, -122.779],
[45.4318, -122.571],
[43.479, -83.9723],
[48.7848, -122.489],
[47.1639, -122.511],
[42.9838, -83.7496],
[42.6375, -83.1293],
[42.3284, -83.3006],
[42.3232, -83.4718],
[39.028, -95.759],
[35.13, -106.548],
[35.0855, -106.528],
[36.8067, -119.698],
[33.5063, -117.146],
[44.791, -93.2058],
[42.6634, -84.5439],
[45.5073, -122.957],
[33.5403, -111.888],
[44.9072, -89.5911],
[42.7233, -84.4214],
[37.9923, -84.5245],
[33.8977, -84.479],
[35.2608, -81.1539],
[43.022, -85.6881],
[42.9025, -85.7891],
[41.2947, -96.1166],
[38.9236, -95.2625],
[41.1653, -96.0448],
[41.5723, -90.5263],
[42.2208, -85.5888],
[42.5528, -83.0272],
[47.6582, -122.695],
[47.0446, -122.937],
[44.9388, -122.986],
[44.6304, -123.079],
[42.2622, -85.1883],
[42.4522, -83.3441],
[44.0727, -123.046],
[42.3474, -122.878],
[35.3939, -118.956],
[40.5867, -122.349],
[42.7403, -84.6272],
[43.6105, -116.286],
[38.3016, -104.605],
[45.0569, -93.1447],
[43.8739, -91.1934],
[41.7203, -83.5612],
[41.6995, -83.6539],
[41.6153, -83.6948],
[35.1862, -106.664],
[37.4143, -121.876],
[47.4554, -122.258],
[46.1427, -122.9],
[43.0121, -83.6381],
[43.6275, -83.8963],
[43.0389, -82.4526],
[42.2439, -83.7697],
[39.9102, -86.0586],
[47.7477, -117.4],
[47.5217, -122.367],
[26.3553, -80.2052],
[33.3879, -111.684],
[37.3225, -120.485],
[26.4366, -80.0868],
[44.7299, -93.2148],
[30.3287, -81.5484],
[28.6631, -81.4177],
[28.5551, -81.3456],
[28.4497, -81.391],
[28.0635, -82.7072],
[27.8931, -82.7846],
[28.0885, -82.5049],
[28.0723, -82.4279],
[47.4938, -94.9104],
[46.8757, -96.7284],
[46.3631, -94.2423],
[34.0649, -117.434],
[45.1017, -95.0412],
[44.8156, -92.9307],
[44.1739, -93.9514],
[45.0321, -93.4511],
[27.228, -82.4924],
[40.0902, -83.09],
[39.9566, -83.1005],
[30.1926, -81.5509],
[39.7494, -89.7101],
[44.7255, -85.6369],
[43.6583, -84.2412],
[42.2672, -84.4252],
[37.7469, -88.9759],
[38.2466, -122.069],
[36.7142, -121.653],
[33.8658, -117.747],
[47.7345, -116.791],
[36.065, -115.048],
[47.3665, -122.203],
[35.0652, -89.7559],
[30.1693, -95.4534],
[34.5997, -118.147],
[30.4689, -87.209],
[29.6211, -82.3836],
[29.1839, -81.0801],
[28.0809, -80.6657],
[27.0128, -82.1414],
[28.8266, -81.7844],
[38.09, -122.553],
[45.0913, -93.378],
[44.9269, -92.9596],
[35.9656, -86.8128],
[48.4606, -122.337],
[42.5907, -114.462],
[32.3992, -110.959],
[41.524, -87.4685],
[41.8395, -87.7418],
[38.7834, -89.9488],
[31.6184, -84.2205],
[31.5559, -110.255],
[33.9007, -117.564],
[37.9878, -122.309],
[37.7601, -121.459],
[38.7928, -104.801],
[30.4105, -86.6589],
[25.6854, -80.4372],
[33.9704, -84.015],
[33.5669, -84.3262],
[34.0148, -84.1886],
[30.8433, -83.3169],
[45.0522, -93.06],
[38.5795, -92.2136],
[42.13736, -88.027031],
[32.3987, -90.1476],
[35.0553, -78.9748],
[36.343, -82.3737],
[37.7204, -87.1216],
[32.7586, -97.1696],
[38.6551, -77.2878],
[46.6065, -120.489],
[33.746, -117.009],
[35.1077, -80.8786],
[45.525, -122.54],
[44.1053, -121.3],
[34.1044, -117.823],
[40.6291, -111.94],
[32.3175, -106.744],
[32.0273, -102.146],
[29.3554, -98.5407],
[38.2987, -77.5106],
[39.7144, -86.3614],
[37.0849, -94.474],
[32.2734, -95.3086],
[42.447, -82.9368],
[42.4511, -83.2045],
[33.4808, -84.4427],
[37.7287, -85.8805],
[38.2156, -85.5937],
[41.3777, -81.7362],
[41.1208, -81.4775],
[40.8622, -81.4313],
[36.0081, -84.0231],
[34.2905, -83.846],
[30.673, -88.1248],
[28.0272, -82.5489],
[27.3369, -82.4633],
[30.6108, -96.315],
[27.5693, -99.5004],
[26.1828, -97.7214],
[41.5249, -93.5991],
[43.1504, -93.2492],
[44.6846, -90.1655],
[44.5244, -89.5226],
[43.998, -88.5821],
[43.7903, -88.4839],
[42.7223, -88.9972],
[42.2693, -88.9875],
[30.1911, -85.6488],
[27.937, -82.3233],
[27.0522, -82.3918],
[26.1509, -80.3216],
[27.2367, -80.2721],
[27.4323, -82.5784],
[26.5423, -81.8691],
[42.5458, -82.9031],
[45.1273, -93.2684],
[45.8495, -95.3904],
[31.8182, -106.548],
[31.7698, -106.305],
[26.1865, -98.2131],
[33.6358, -112.228],
[36.2191, -115.25],
[38.3631, -121.964],
[37.7014, -121.747],
[28.3064, -81.4412],
[46.2216, -119.222],
[41.8701, -103.643],
[33.4266, -104.522],
[42.239, -87.9579],
[42.0258, -88.3413],
[42.0236, -88.1458],
[41.9378, -88.0998],
[41.9057, -87.8438],
[41.8588, -88.1403],
[41.8556, -88.3426],
[41.7715, -88.2041],
[41.7627, -87.7431],
[41.6035, -87.8493],
[41.7808, -87.8601],
[30.4326, -84.245],
[28.7538, -81.3484],
[41.5983, -87.5657],
[47.5112, -92.5502],
[45.4575, -98.44],
[31.7838, -106.413],
[36.1247, -115.242],
[33.4758, -112.218],
[38.3467, -122.72],
[38.117, -121.304],
[32.3354, -111.049],
[32.2493, -110.853],
[42.02, -97.4305],
[40.7222, -99.0854],
[29.849, -95.5025],
[44.8891, -97.0833],
[40.8199, -91.1721],
[45.1645, -93.8552],
[44.8614, -93.5437],
[43.1896, -88.1291],
[43.051, -88.3768],
[42.3833, -87.9658],
[41.7711, -88.039],
[41.7048, -88.1219],
[41.6514, -87.7409],
[41.4697, -87.3041],
[40.7484, -89.6352],
[42.4346, -83.4314],
[29.1738, -82.1572],
[28.9161, -81.2929],
[32.8041, -96.7903],
[32.9286, -97.0896],
[26.0126, -80.1747],
[42.506, -94.1622],
[40.7592, -96.6411],
[42.0386, -88.0462],
[39.8214, -86.2801],
[29.0499, -95.465],
[34.1466, -118.135],
[34.5488, -112.432],
[46.8898, -114.038],
[29.7718, -94.9765],
[28.8654, -96.9992],
[46.6971, -92.1056],
[41.0128, -92.4376],
[40.9759, -90.3853],
[42.353, -88.2658],
[41.967, -87.9929],
[41.5766, -88.1541],
[41.1727, -87.8542],
[42.534, -83.4415],
[28.6577, -81.2344],
[28.6713, -81.3402],
[26.2091, -81.7704],
[41.9474, -83.3888],
[42.2977, -85.6554],
[42.0971, -88.2945],
[47.2095, -93.5274],
[38.7841, -97.6092],
[37.9797, -100.843],
[29.7823, -95.7162],
[33.3214, -111.981],
[45.5388, -122.866],
[36.8459, -119.788],
[34.0022, -117.719],
[33.6776, -117.664],
[33.6417, -117.598],
[47.6564, -117.219],
[33.8753, -84.0156],
[35.1225, -80.707],
[28.4932, -82.5996],
[26.0097, -80.2985],
[35.687, -88.8573],
[42.5453, -83.7919],
[42.1378, -83.225],
[43.577, -84.7647],
[41.4692, -90.5247],
[42.0203, -87.7061],
[42.0128, -87.7802],
[41.3626, -89.1293],
[45.5648, -94.1448],
[45.0373, -92.8386],
[41.8163, -90.2438],
[35.184, -111.66],
[33.6274, -111.889],
[38.4196, -122.712],
[37.6945, -121.065],
[34.4684, -117.244],
[33.7249, -116.403],
[36.8354, -121.389],
[41.9291, -87.6858],
[40.1417, -88.2558],
[42.677, -82.8293],
[38.0712, -97.8995],
[32.8626, -96.8542],
[29.5625, -98.5891],
[37.7618, -121.964],
[33.4789, -111.984],
[39.9207, -105.089],
[36.7682, -108.148],
[31.3134, -94.7206],
[29.7461, -95.4532],
[41.9068, -87.9774],
[36.9504, -86.4382],
[36.5869, -87.2928],
[35.8481, -78.585],
[35.7564, -78.7383],
[35.9713, -77.811],
[33.7133, -78.894],
[35.3791, -77.9392],
[35.4433, -80.8622],
[30.2538, -81.391],
[25.7354, -80.3209],
[34.1725, -84.786],
[34.047, -84.2874],
[34.0095, -84.5735],
[33.9513, -84.2324],
[41.1547, -81.8647],
[41.3168, -81.8277],
[41.1273, -81.6053],
[41.1556, -81.41],
[40.0291, -82.4527],
[39.7302, -82.621],
[39.4908, -84.3338],
[37.2997, -89.5806],
[29.8778, -95.6469],
[47.672, -122.104],
[47.5418, -122.05],
[32.7794, -117.012],
[39.567, -76.9738],
[39.3708, -76.4521],
[39.5252, -76.3501],
[39.1332, -76.6343],
[38.9526, -76.7221],
[38.7988, -77.3012],
[38.8966, -76.8265],
[39.0969, -76.81],
[38.6211, -76.9232],
[39.0262, -77.4003],
[42.9987, -78.8184],
[42.995, -78.6981],
[43.0895, -78.9794],
[42.9557, -78.8735],
[42.9108, -78.7722],
[35.1014, -77.0962],
[37.2481, -77.3877],
[37.3518, -77.4106],
[37.5867, -77.5014],
[37.6727, -77.4628],
[36.7716, -76.2314],
[35.5772, -77.383],
[27.8121, -82.7552],
[41.8443, -88.0033],
[38.4266, -121.416],
[38.2824, -122.277],
[34.2173, -119.073],
[34.0736, -117.885],
[33.0633, -117.265],
[35.2037, -89.7962],
[37.1511, -93.2623],
[32.913, -96.9611],
[34.0698, -117.978],
[35.6396, -106.013],
[38.7391, -90.6359],
[42.187, -88.1028],
[39.2879, -84.4542],
[25.907, -80.1565],
[25.6926, -80.3054],
[33.1682, -117.215],
[37.5038, -77.605],
[39.2511, -76.8197],
[39.5213, -76.178],
[39.1971, -76.8139],
[39.4331, -76.7987],
[39.1992, -77.2489],
[36.8466, -76.0223],
[36.8653, -76.2123],
[37.65, -77.5998],
[27.6401, -80.4479],
[27.8943, -82.5042],
[42.8651, -85.6864],
[28.3861, -80.7052],
[37.6352, -122.418],
[40.5515, -74.333],
[42.0942, -76.0017],
[42.7924, -78.7833],
[39.9938, -83.0266],
[36.1829, -86.638],
[43.0614, -89.5252],
[30.2337, -97.8285],
[36.6212, -121.844],
[40.0083, -86.1286],
[47.4375, -120.327],
[32.8941, -96.4683],
[30.4791, -97.6694],
[44.0861, -93.2487],
[43.1196, -89.308],
[42.4079, -87.8561],
[38.2972, -85.558],
[40.0568, -82.9221],
[33.5585, -85.0763],
[25.9715, -80.1412],
[25.576, -80.3746],
[38.8337, -77.0493],
[36.1684, -80.2787],
[36.0569, -79.9069],
[35.9935, -80.0087],
[35.8708, -78.7194],
[35.2933, -80.7457],
[43.4776, -111.983],
[41.0965, -73.9534],
[40.6866, -74.3088],
[39.9346, -75.0256],
[36.0692, -80.32],
[35.0594, -80.816],
[38.9549, -77.3707],
[38.7743, -77.5065],
[33.4909, -82.0812],
[39.296, -84.3059],
[39.0735, -84.3132],
[38.0223, -84.4148],
[45.005, -93.2289],
[44.0321, -91.621],
[38.9431, -121.096],
[38.6717, -121.152],
[34.1912, -118.935],
[38.8052, -90.3102],
[38.6278, -90.3438],
[37.1075, -76.492],
[35.7157, -78.6381],
[36.7878, -76.1089],
[34.0353, -84.4605],
[34.2485, -77.8807],
[40.8389, -73.2852],
[39.452, -74.634],
[26.6183, -80.1373],
[41.6289, -81.4286],
[41.6922, -91.606],
[34.7556, -92.414],
[30.3131, -95.4737],
[32.6776, -97.0099],
[35.2533, -106.651],
[47.7586, -122.155],
[37.526, -122.002],
[35.584, -120.698],
[38.6728, -121.274],
[37.5593, -122.283],
[29.9997, -95.5838],
[42.0531, -87.8389],
[35.844, -86.4259],
[42.0812, -86.4348],
[39.7639, -84.051],
[39.8711, -84.134],
[39.8179, -84.2814],
[27.8464, -82.6442],
[39.7324, -75.0397],
[39.8503, -74.9844],
[40.039, -75.6294],
[40.1761, -74.8779],
[39.9155, -75.334],
[39.3821, -77.3982],
[39.0519, -76.9562],
[40.7417, -73.5995],
[32.739, -116.939],
[33.6671, -112.119],
[39.3948, -76.5814],
[36.9158, -121.776],
[45.195, -93.3506],
[39.8305, -75.5408],
[40.688, -73.4068],
[40.7264, -73.2772],
[40.7831, -73.8333],
[40.3059, -74.6766],
[40.4422, -74.426],
[40.0583, -74.1498],
[39.9879, -74.1754],
[40.6412, -74.4221],
[43.0334, -77.4485],
[43.0785, -77.6317],
[40.0357, -74.8229],
[40.2247, -75.2394],
[40.4585, -78.4085],
[37.2711, -76.7607],
[37.2994, -79.9592],
[26.168, -80.1158],
[33.852, -84.6032],
[33.9478, -84.6256],
[42.2284, -88.3055],
[42.1029, -87.8135],
[42.1914, -87.8253],
[34.966, -90.0055],
[42.0194, -93.6074],
[36.0122, -115.122],
[33.7261, -84.7346],
[43.6839, -92.9958],
[46.2912, -96.1135],
[40.8895, -74.2718],
[42.1019, -87.9635],
[39.2489, -94.5949],
[40.4095, -105.004],
[32.5343, -84.9716],
[36.1046, -79.8209],
[35.7019, -81.3073],
[34.8306, -82.3084],
[40.1359, -74.9618],
[40.2905, -74.3009],
[45.0136, -93.0089],
[42.7647, -71.2155],
[42.5524, -70.9372],
[41.7065, -71.4937],
[41.8781, -71.0693],
[41.9405, -71.3527],
[40.8842, -73.1001],
[40.4115, -74.136],
[39.1194, -77.2021],
[43.2031, -77.6926],
[43.1281, -77.4437],
[40.2234, -75.1371],
[33.8532, -84.3585],
[34.5499, -82.6798],
[34.0668, -81.1653],
[39.0197, -84.6339],
[39.0506, -94.3701],
[44.2933, -94.4439],
[29.5687, -98.3271],
[47.3607, -122.608],
[34.07, -83.9824],
[36.161, -115.288],
[37.9046, -122.065],
[33.3342, -111.757],
[44.8689, -94.3775],
[44.434, -93.1861],
[43.3193, -87.9227],
[41.6437, -88.0043],
[39.7771, -85.9869],
[41.3888, -82.1083],
[40.1878, -80.2269],
[40.4457, -80.1831],
[40.5854, -80.0405],
[40.434, -79.7719],
[40.3037, -79.5959],
[39.987, -76.6802],
[40.357, -75.981],
[33.3932, -84.7589],
[40.5623, -74.5533],
[37.4219, -77.633],
[34.7861, -77.4041],
[43.2189, -71.4844],
[42.7027, -71.4381],
[42.3992, -71.072],
[43.6619, -116.353],
[33.0997, -96.6821],
[42.1677, -72.6423],
[38.4157, -75.5606],
[39.1531, -78.1685],
[44.9654, -92.7233],
[40.1387, -82.979],
[45.7127, -111.071],
[33.7278, -117.785],
[39.1, -119.777],
[33.2642, -111.86],
[38.7775, -90.6968],
[33.4632, -112.356],
[36.2383, -115.172],
[45.2748, -92.9996],
[44.7373, -92.8888],
[44.8221, -87.4039],
[44.4905, -88.0712],
[44.2452, -88.3573],
[41.8098, -72.5497],
[35.7523, -83.9918],
[42.706, -83.2909],
[39.6339, -84.2137],
[40.4108, -79.9108],
[40.3086, -76.7967],
[41.9951, -72.5825],
[40.1246, -75.116],
[39.6203, -77.773],
[38.2977, -76.5133],
[40.6879, -80.0844],
[40.9942, -75.2449],
[38.3386, -81.7138],
[40.6611, -73.7258],
[40.8135, -73.9821],
[40.7247, -73.4947],
[39.4622, -76.6343],
[42.5187, -71.1347],
[41.3773, -72.1496],
[42.7049, -73.8241],
[40.1055, -75.2962],
[40.3478, -79.9538],
[43.0996, -73.7444],
[44.7755, -93.5012],
[30.5302, -87.224],
[30.6027, -87.8964],
[37.3459, -79.1901],
[39.9405, -83.8408],
[38.4128, -90.397],
[38.565, -90.405],
[38.7878, -90.5627],
[42.16, -71.4978],
[46.6214, -112.02],
[33.5656, -117.204],
[47.7098, -122.324],
[42.2358, -83.6778],
[41.467, -87.0302],
[42.0572, -80.0919],
[40.8106, -77.9118],
[41.711, -72.764],
[42.4811, -71.0246],
[40.1305, -75.4533],
[37.1578, -80.422],
[33.6825, -117.918],
[29.8758, -81.3222],
[38.9982, -76.9066],
[41.452, -74.3696],
[32.2552, -80.8499],
[27.9997, -81.973],
[30.1878, -81.6292],
[41.2167, -80.7526],
[35.0251, -85.1566],
[45.5742, -93.2008],
[37.5205, -120.879],
[33.8594, -118.089],
[34.0226, -118.373],
[34.1743, -118.467],
[42.3042, -71.402],
[34.2128, -118.461],
[33.5044, -81.7112],
[42.9578, -88.1071],
[39.1594, -75.5105],
[42.5449, -83.1891],
[38.5025, -90.4465],
[40.6196, -74.2431],
[32.1606, -110.989],
[41.5427, -83.5804],
[41.9685, -73.9859],
[34.1185, -80.8775],
[34.842, -87.635],
[41.9186, -88.2645],
[41.5242, -81.435],
[41.4632, -82.0096],
[39.4082, -104.857],
[33.7795, -111.923],
[33.7827, -118.07],
[33.9478, -118.333],
[40.8983, -74.0389],
[47.9983, -122.101],
[34.147, -118.086],
[45.8054, -108.473],
[46.5517, -87.4596],
[33.6371, -112.352],
[29.6918, -95.4185],
[26.3032, -80.0926],
[43.6339, -70.3471],
[32.6836, -97.1348],
[33.9255, -118.107],
[38.8557, -77.3935],
[42.0067, -87.8862],
[40.7344, -73.8676],
[40.2771, -74.5415],
[34.7418, -86.6818],
[32.4413, -93.7194],
[42.2928, -71.7749],
[34.934, -82.0087],
[39.9591, -86.0108],
[44.0624, -92.5027],
[44.8273, -93.6001],
[38.6671, -90.5858],
[29.6122, -98.5099],
[47.0434, -122.836],
[44.9171, -93.5044],
[37.1013, -113.555],
[41.0324, -73.7653],
[29.5642, -95.5647],
[33.6747, -111.974],
[33.5546, -112.261],
[34.1893, -118.33],
[39.4636, -119.781],
[39.6032, -86.1579],
[39.8672, -74.9229],
[39.9364, -86.2324],
[34.6729, -86.5414],
[32.882, -97.1016],
[30.3851, -91.0601],
[35.9009, -84.1487],
[34.9388, -80.9784],
[39.9161, -104.975],
[41.5526, -72.8153],
[41.7957, -71.3208],
[44.9748, -93.2749],
[30.6741, -88.228],
[29.5393, -95.0244],
[40.2307, -74.0448],
[32.8176, -83.7145],
[32.6167, -83.6859],
[40.7867, -82.5947],
[28.1729, -82.3556],
[33.8799, -117.963],
[35.3846, -119.103],
[42.1544, -87.951],
[33.4537, -111.682],
[40.8093, -73.2871],
[39.1739, -94.5333],
[39.8297, -75.0918],
[33.8452, -84.2458],
[32.7981, -80.0321],
[38.9314, -94.4091],
[39.1622, -84.2752],
[34.1861, -84.1341],
[33.0104, -96.9686],
[29.6516, -95.1539],
[35.6126, -97.5477],
[35.6507, -97.4636],
[30.1996, -93.2467],
[33.886, -84.7445],
[40.6522, -73.8697],
[41.6967, -88.3167],
[41.6498, -88.2052],
[41.8765, -71.5187],
[44.0492, -123.171],
[45.5327, -122.443],
[37.6704, -122.471],
[34.1414, -118.225],
[33.8522, -118.141],
[32.7693, -117.147],
[34.0749, -118.07],
[39.6939, -104.863],
[40.8754, -79.9419],
[39.0365, -77.055],
[38.7748, -77.1756],
[36.8222, -119.788],
[33.8584, -117.925],
[45.5165, -122.561],
[36.8269, -76.4142],
[40.8055, -124.145],
[37.5451, -121.985],
[34.0894, -117.692],
[33.9184, -118.076],
[34.0016, -118.086],
[37.3723, -121.843],
[37.2919, -121.989],
[37.6997, -122.126],
[33.3919, -111.865],
[32.9434, -96.6976],
[38.8693, -77.1438],
[33.5738, -111.718],
[45.6119, -122.682],
[29.7826, -95.5427],
[38.9724, -94.6075],
[41.9454, -87.7005],
[38.3221, -122.3075],
[32.2228, -110.918],
[42.3769, -71.0899],
[42.3639, -71.158],
[39.9243, -75.1462],
[45.6165, -122.506],
[41.7182, -86.1758],
[41.6222, -85.9051],
[39.1623, -84.4261],
[45.1841, -93.105],
[30.003, -90.1828],
[29.613, -90.7571],
[29.8897, -90.0538],
[34.1928, -79.838],
[33.9419, -83.4407],
[26.6064, -81.9771],
[39.2473, -94.4611],
[45.1978, -93.5541],
[30.0187, -95.2681],
[30.0507, -95.4343],
[29.5537, -95.3841],
[41.569, -87.6346],
[33.4668, -84.217],
[36.28, -115.263],
[41.0212, -80.6463],
[40.6738, -75.1351],
[42.4873, -83.5329],
[42.7116, -83.0324],
[40.6277, -74.3074],
[31.2672, -85.4409],
[32.4998, -92.0703],
[36.1157, -94.1555],
[39.7081, -104.823],
[37.6077, -122.063],
[30.1596, -92.0494],
[41.4657, -75.6379],
[43.1878, -76.2464],
[43.0313, -76.0193],
[42.8568, -73.7724],
[38.4207, -82.288],
[38.1986, -85.6707],
[26.1176, -80.2584],
[37.9756, -87.4709],
[42.832, -86.0908],
[44.465, -87.9851],
[44.6833, -93.2912],
[32.8419, -116.982],
[33.8281, -84.325],
[39.0179, -94.6657],
[41.7388, -87.6067],
[32.9653, -96.6441],
[26.2689, -98.2168],
[40.8122, -74.3799],
[43.0822, -75.3176],
[33.0397, -80.1573],
[41.971, -70.7173],
[42.2807, -71.6555],
[30.1037, -81.7081],
[30.317, -89.8289],
[32.6178, -85.4101],
[39.732, -105.157],
[38.888, -104.718],
[38.7909, -121.29],
[30.1883, -81.7366],
[35.9743, -78.5422],
[35.5977, -80.8715],
[31.8918, -102.349],
[37.931968, -122.326354],
[42.4835, -76.4912],
[38.5068, -90.3394],
[40.6131, -75.5363],
[36.3343, -86.6256],
[25.98, -80.372],
[38.141, -85.6722],
[32.9098, -97.1877],
[38.5925, -90.2954],
[42.3595, -71.6066],
[33.0683, -97.0807],
[28.494, -81.4287],
[28.5491, -81.7053],
[43.0457, -71.461],
[42.7748, -73.8908],
[44.5688, -92.5837],
[29.4948, -98.5512],
[36.1141, -115.311],
[39.6382, -106.078],
[37.7952, -121.197],
[38.4591, -121.415],
[41.4155, -73.4015],
[32.8238, -79.8177],
[40.2217, -85.3808],
[31.5346, -97.1926],
[42.7986, -71.536],
[38.7753, -77.0832],
[39.3561, -84.3617],
[29.2904, -94.8407],
[32.5912, -97.1443],
[41.1419, -95.9703],
[38.8156, -94.516],
[38.5729, -89.9238],
[48.2356, -114.327],
[39.385, -76.7316],
[30.3151, -97.7058],
[38.8491, -94.8199],
[41.0553, -73.5417],
[39.2359, -84.5896],
[33.6578, -84.5003],
[34.2792, -118.866],
[33.8244, -117.511],
[40.9182, -111.887],
[40.6229, -111.85],
[40.5667, -111.892],
[41.1735, -112.006],
[40.2959, -111.699],
[41.0876, -111.981],
[38.9107, -94.7644],
[38.9083, -94.6747],
[39.0099, -94.7681],
[28.553, -81.2002],
[34.0637, -84.3976],
[40.4193, -86.8473],
[33.1048, -96.8123],
[33.0302, -96.8273],
[32.8899, -97.2572],
[32.8366, -97.1841],
[41.7094, -93.5791],
[42.0362, -91.6505],
[39.9564, -105.173],
[32.6787, -97.4134],
[41.9443, -91.7176],
[33.4258, -86.7118],
[33.6047, -86.6371],
[44.7806, -91.4333],
[32.9826, -96.7692],
[39.6108, -105.1015],
[41.2357, -96.1934],
[26.1919, -80.2538],
[33.951, -84.1439],
[34.0853, -84.5456],
[28.5539, -81.4857],
[36.0628, -95.8565],
[47.8873, -97.0795],
[32.8661, -96.7449],
[29.5481, -98.6639],
[29.5968, -95.6275],
[33.1933, -87.5182],
[39.761, -86.3423],
[39.6675, -86.0849],
[28.3699, -81.4068],
[41.6474, -93.7676],
[42.4666, -92.3236],
[35.2092, -80.6968],
[35.9031, -78.786],
[29.11, -81.028],
[42.6451, -73.7007],
[30.4787, -97.7968],
[40.8727, -73.9073],
[42.367, -89.0276],
[42.4514, -96.3343],
[42.1625, -88.3399],
[41.6605, -72.7255],
[42.5038, -70.92],
[41.5007, -81.5329],
[36.2921, -119.317],
[39.7085, -104.938],
[35.5732, -82.5219],
[41.1047, -74.0236],
[40.1019, -75.0105],
[33.4581, -94.0917],
[30.3165, -97.9543],
[40.3937, -104.75],
[40.3782, -111.817],
[32.6498, -116.969],
[32.8133, -115.569],
[30.4098, -97.67],
[40.9331, -72.6776],
[37.964, -121.7381],
[27.9589, -82.7268],
[39.1719, -96.6054],
[40.8258, -74.1366],
[40.1305, -74.2204],
[35.6876, -78.5797],
[32.3609, -86.1621],
[35.866, -78.5682],
[38.8964, -77.4436],
[39.3094, -80.2747],
[32.9344, -80.0362],
[43.3279, -73.6794],
[45.1728, -93.388],
[45.1659, -93.2329],
[44.744, -93.3776],
[34.133, -117.641],
[42.2002, -71.7779],
[32.603, -96.9355],
[29.5367, -95.1513],
[33.2963, -111.899],
[42.3573, -72.5476],
[38.8802, -94.606],
[41.3122, -81.5249],
[38.8531, -94.6816],
[33.939, -117.282],
[35.1383, -89.7976],
[41.2375, -75.8463],
[32.7414, -117.054],
[45.3332, -122.767],
[39.9148, -86.1394],
[40.685, -73.9766],
[32.9514, -96.8537],
[37.0009, -121.551],
[29.3531, -98.4334],
[30.2352, -81.6953],
[39.0558, -77.1167],
[44.8423, -68.7418],
[41.6258, -73.9197],
[38.4692, -77.4086],
[38.1296, -78.4405],
[28.0923, -81.9712],
[35.5561, -97.6401],
[33.68, -96.6121],
[38.0556, -121.374],
[32.2081, -110.788],
[40.9039, -74.5492],
[40.802, -74.0217],
[40.7514, -73.4198],
[33.7104, -116.2914],
[45.3666, -122.838],
[34.0717, -117.207],
[34.7064, -82.2558],
[39.4603, -76.3167],
[35.9674, -78.9582],
[38.7956, -77.6056],
[39.1155, -77.5332],
[39.9642, -76.7787],
[30.4433, -90.1402],
[29.9477, -93.9877],
[39.1621, -86.4942],
[41.8122, -87.7228],
[43.7161, -87.7664],
[41.5425, -88.2027],
[41.7491, -87.944],
[45.6865, -122.667],
[34.0901, -118.345],
[40.773, -73.5314],
[40.7326, -74.0357],
[40.9005, -73.8192],
[41.9553, -87.8084],
[41.8683, -87.6312],
[38.9683, -76.9549],
[35.0871, -92.4135],
[35.8362, -78.6424],
[38.8445, -77.1163],
[29.9696, -95.6962],
[43.0156, -87.9707],
[41.9756, -88.3439],
[38.8483, -76.8862],
[42.3291, -71.0626],
[41.5612, -93.7794],
[41.6278, -86.2291],
[41.8008, -88.1705],
[30.0915, -95.6393],
[33.3791, -112.034],
[36.3237, -119.675],
[35.0496, -89.6903],
[29.7357, -95.7763],
[33.6916, -84.0925],
[31.9839, -81.175],
[39.2192, -85.885],
[42.2841, -88.0452],
[41.567, -87.5076],
[38.1565, -92.6017],
[42.7577, -73.7697],
[41.3511, -72.8712],
[39.9683, -74.9155],
[28.3318, -81.4717],
[35.8228, -90.6668],
[32.3435, -90.0586],
[30.2868, -81.4573],
[32.5263, -97.3447],
[33.9818, -80.9686],
[41.9275, -87.7876],
[42.8823, -87.9154],
[37.8832, -122.3071],
[37.2522, -121.863],
[39.8872, -105.073],
[40.5484, -74.4234],
[42.0338, -71.3108],
[37.5343, -77.5274],
[35.7452, -78.8776],
[41.122, -85.0639],
[28.2281, -80.7203],
[26.7108, -80.2029],
[33.7611, -117.888],
[34.9372, -82.2799],
[39.1907, -76.611],
[41.6421, -93.5063],
[39.6584, -84.1071],
[26.8061, -80.0827],
[42.3991, -70.9995],
[37.6783, -97.432],
[37.7244, -97.2113],
[37.7322, -97.4648],
[39.3897, -84.5044],
[47.3136, -122.309],
[40.8246, -72.9886],
[39.655, -80.0063],
[42.0179, -88.2014],
[39.8899, -88.9589],
[38.61999, -90.519886],
[30.4039, -97.8531],
[41.2174, -73.7217],
[41.2794, -72.9872],
[41.2335, -73.1518],
[47.1712, -122.172],
[34.1519, -117.474],
[33.3228, -111.688],
[33.279, -111.788],
[33.9777, -117.554],
[32.4244, -96.8377],
[35.8927, -86.8803],
[33.757, -84.3461],
[42.5271, -71.7143],
[28.7993, -81.3337],
[28.2042, -82.6646],
[37.6003, -77.3509],
[40.0363, -83.1213],
[39.3344, -76.4475],
[42.6348, -83.7572],
[39.9709, -82.8953],
[30.5631, -84.214],
[30.2608, -81.5247],
[29.686742, -95.462077],
[39.5811, -104.723],
[39.8114, -94.8133],
[40.0653, -83.0207],
[29.4375, -98.6494],
[33.8689, -118.358],
[32.7279, -97.7861],
[30.6312, -97.6964],
[36.043, -86.7779],
[37.3397, -121.841],
[40.529, -74.2304],
[38.9542, -76.8247],
[32.8114, -97.4292],
[42.9412, -71.4722],
[41.3166, -96.0256],
[35.448, -82.5361],
[42.909, -85.541],
[42.8464, -85.6192],
[41.4202, -81.896],
[38.5967, -77.3328],
[36.8386, -119.728],
[33.9439, -117.996],
[34.2347, -118.503],
[39.7872, -105.112],
[26.0467, -80.25],
[39.5341, -104.882],
[41.3181, -74.1542],
[45.218, -93.317],
[33.8461, -118.263],
[33.5267, -82.1184],
[41.5074, -87.9211],
[39.5578, -107.352],
[34.3954, -118.4643],
[35.1721, -106.582],
[28.5961, -81.288],
[42.2842, -83.2023],
[27.3865, -82.4568],
[41.5468, -87.798],
[33.931, -84.3412],
[36.0665, -79.5175],
[43.2137, -77.4502],
[27.9572, -82.508],
[41.6314, -93.7008],
[32.7532, -97.3529],
[38.9507, -94.7194],
[40.8005, -81.4967],
[41.2353, -73.0349],
[44.8933, -93.0787],
[41.4399, -87.4681],
[38.727, -90.2749],
[33.6708, -117.955],
[39.7886, -104.9],
[35.1435, -85.248],
[31.3226, -89.3797],
[34.096, -84.1745],
[36.0369, -83.8873],
[28.9345, -81.9398],
[26.49, -81.788],
[35.0476, -89.8064],
[35.4381, -97.3953],
[28.8198, -81.671],
[26.2708, -81.7396],
[27.8378, -82.6858],
[26.5932, -80.2031],
[29.9681, -95.5316],
[26.5263, -80.1658],
[38.3268, -85.7665],
[35.9038, -78.9505],
[39.8766, -83.0372],
[38.4289, -78.8443],
[40.0259, -76.2028],
[41.9376, -71.4764],
[35.0213, -80.5813],
[39.9904, -75.0899],
[41.5048, -74.0592],
[40.5342, -80.0688],
[41.835, -87.6748],
[41.9913, -87.6823],
[35.349869, -80.859765],
[41.8506, -87.8494],
[33.8575, -118],
[32.7006, -114.602],
[34.56044, -86.971764],
[30.3912, -86.4807],
[39.9872, -82.7858],
[41.7211, -87.725],
[37.3387, -121.905],
[30.4413, -91.0222],
[35.0342, -80.8068],
[34.0398, -84.6835],
[26.318911, -80.15136],
[29.776, -95.3833],
[36.2903, -95.8436],
[37.71374, -120.955089],
[36.6738, -93.2257],
[40.1962, -77.1572],
[40.681, -80.3127],
[45.0072, -93.1642],
[40.7721, -73.2003],
[38.7689, -90.7683],
[40.0123, -74.9581],
[42.7876, -83.7372],
[43.0139, -89.4828],
[36.1132, -79.8766],
[25.853136, -80.317819],
[45.0074, -122.999],
[35.7989, -78.5096],
[27.5156, -99.4504],
[42.630629, -82.91279],
[40.321, -79.6869],
[38.6378, -121.5],
[28.17384, -82.47047],
[41.0428, -81.6921],
[42.9263, -72.3013],
[33.984513, -84.42926],
[42.0736, -88.1918],
[40.5418, -111.983],
[40.0065, -75.2128],
[41.2609, -96.0247],
[36.168, -86.5089],
[42.4923, -73.206],
[33.652889, -117.74438],
[33.4402, -84.5898],
[43.9349, -69.9824],
[40.2127, -75.4997],
[35.0998, -80.987],
[38.5418, -76.9823],
[36.1101, -80.0995],
[44.9958, -92.9473],
[47.11332, -122.291621],
[33.79322, -84.399391],
[38.2247, -77.5015],
[29.7364, -95.5186],
[32.2802, -110.9765],
[40.71713, -74.285666],
[33.1286, -96.7298],
[34.1929, -118.604],
[29.9197, -95.6062],
[33.19, -97.0984],
[26.285442, -80.203609],
[34.040762, -117.911061],
[33.4236, -112.269],
[40.6114, -111.984],
[33.6965, -117.827],
[25.9686, -97.5118],
[33.6098, -85.7836],
[30.3031, -87.6807],
[30.6278, -81.5487],
[41.5832, -73.0337],
[41.238, -81.3531],
[42.154, -76.8709],
[41.4213, -82.6744],
[41.3602, -81.3763],
[33.623109, -117.683475],
[36.0409, -115.196],
[33.1359, -117.2281],
[43.4737, -70.5112],
[41.638, -71.0033],
[35.7428, -77.9654],
[35.4185, -80.6769],
[39.4219, -75.0423],
[33.8251, -84.3663],
[39.882786, -75.528169],
[42.1106, -70.9279],
[33.6318, -84.0157],
[38.344835, -77.493816],
[33.4312, -111.904],
[41.799, -88.3651],
[42.603501, -83.29418],
[34.0034, -117.821],
[45.293, -93.7723],
[39.7462, -74.9943],
[43.235, -70.8833],
[39.9564, -104.777],
[39.9082, -79.7573],
[37.6666, -122.121],
[40.247, -76.8045],
[29.6045, -98.5982],
[25.8089, -80.1937],
[44.9359, -93.3939],
[33.5469, -101.955],
[42.8788, -78.6989],
[48.1514, -122.191],
[45.136681, -93.476099],
[46.7985, -100.785],
[33.6897, -117.342],
[25.940511, -80.292665],
[39.9584, -104.989],
[42.9962, -88.0454],
[45.0659, -93.2512],
[40.5255, -80.0082],
[40.25, -77.0091],
[36.6613, -76.2342],
[34.6043, -92.5321],
[29.5479, -95.7524],
[43.6088, -116.59],
[42.5133, -83.2252],
[30.2188, -85.8686],
[28.1842, -82.5509],
[26.5332, -80.0867],
[43.1981, -77.5745],
[40.63136, -73.94668],
[41.8914, -72.6524],
[38.8732, -121.301],
[31.7589, -106.266],
[41.1111, -85.1364],
[40.1534, -105.133],
[39.5125, -104.772],
[35.2354, -97.4831],
[38.9726, -104.745],
[39.127, -94.8334],
[45.0443, -93.5276],
[26.2437, -98.2529],
[39.74613, -105.05583],
[41.4683, -81.7739],
[33.7088, -112.275],
[41.4608, -81.6902],
[44.9546, -93.1552],
[42.3669, -83.3357],
[40.0578, -80.5991],
[32.656097, -117.065659],
[30.1984, -81.8272],
[32.9086, -96.5599],
[27.895291, -82.333009],
[33.638106, -112.069349],
[26.1979, -98.284],
[37.3071, -121.813],
[29.6534, -98.4447],
[36.135, -86.89],
[39.9416, -77.6277],
[32.6448, -97.0598],
[35.214143, -80.834793],
[34.0754, -117.564],
[40.4603, -75.3712],
[40.989187, -74.326089],
[27.2699, -80.4279],
[41.3407, -73.0799],
[38.481, -77.9637],
[42.564943, -87.928252],
[37.1549, -121.652],
[43.9716, -75.9611],
[42.5629, -83.0868],
[38.5359, -90.9813],
[40.3809, -74.5759],
[42.151915, -71.072335],
[38.929131, -77.033725],
[34.5276, -117.219],
[39.650597, -105.005977],
[40.6426, -79.941],
[41.4998, -87.73],
[28.523062, -81.585764],
[26.297005, -80.251636],
[41.4584, -81.8505],
[42.0282, -71.142],
[38.549, -121.536],
[28.5521, -80.8411],
[38.649816, -121.063082],
[38.980842, -76.54141],
[39.0084, -77.4388],
[32.5591, -93.7085],
[32.4577, -86.396],
[33.879955, -118.219413],
[33.2265, -86.8058],
[34.0065, -81.1924],
[31.0926, -97.3855],
[30.6013, -87.1265],
[33.922712, -118.318806],
[37.303565, -121.866808],
[32.549104, -94.726442],
[35.339423, -94.38964],
[42.7401, -71.1602],
[30.162964, -97.792677],
[28.016912, -82.612318],
[47.496556, -122.199684],
[41.772956, -70.746285],
[41.612231, -88.121262],
[38.057165, -78.942602],
[43.1619, -76.1224],
[37.258592, -76.641798],
[38.9659, -78.194],
[44.885899, -93.249402],
[31.2019, -81.4817],
[40.397728, -75.929158],
[40.7277, -96.6656],
[33.7466, -118.011],
[41.818533, -73.075714],
[36.667862, -121.810661],
[34.1445, -118.259],
[36.637, -82.1095],
[33.9373, -117.189],
[38.781296, -76.087618],
[39.9148, -75.3531],
[44.875488, -93.323006],
[46.258773, -119.312784],
[44.3124, -69.805],
[26.669449, -81.93371],
[26.403853, -81.805629],
[33.8164, -118.182],
[29.4649, -95.0842],
[43.9553, -92.4638],
[41.6862, -81.2936],
[38.73984, -77.534759],
[43.0466, -76.2359],
[42.787623, -71.114832],
[41.288998, -96.180299],
[43.159604, -86.208798],
[33.809459, -118.28619],
[34.272747, -118.5031],
[38.526407, -90.034042],
[32.040628, -81.06959],
[36.550008, -82.496296],
[33.908102, -84.379927],
[32.6489, -96.8612],
[33.2186, -96.6385],
[37.6392, -77.5119],
[33.173307, -96.843915],
[61.5774, -149.405],
[44.748202, -93.288522],
[33.580505, -112.153324],
[30.5277, -97.8143],
[38.443429, -107.868579],
[41.679734, -87.664349],
[38.820137, -90.880928],
[40.9838, -81.4958],
[37.808667, -121.298924],
[42.59794, -88.41647],
[36.225068, -119.314602],
[34.575249, -118.048184],
[41.4136, -82.2416],
[32.880922, -111.684228],
[33.5226, -112.0959],
[33.606814, -86.806285],
[30.217257, -95.565871],
[36.054894, -96.003674],
[39.99063, -83.150099],
[37.053541, -120.875686],
[35.979378, -86.570379],
[41.229561, -73.226954],
[35.740535, -86.940527],
[26.509577, -81.944629],
[29.477281, -81.219628],
[33.253536, -111.640818],
[28.232329, -81.643094],
[35.215888, -84.866058],
[35.051132, -114.59182],
[26.615527, -81.801616],
[28.344987, -81.614297],
[61.227563, -149.742602],
[61.129517, -149.881796],
[41.96292, -87.65668],
[31.074102, -97.663385],
[33.333883, -86.99048],
[28.515487, -81.379909],
[30.264942, -91.995841],
[41.6612, -88.4604],
[39.2212, -78.1359],
[40.7948, -73.9315],
[40.91544, -74.058896],
[43.016159, -78.200864],
[41.21443, -96.10945],
[39.76491, -75.130961],
[40.538217, -79.837285],
[37.34036, -120.6112],
[34.17945, -83.91168],
[42.904232, -88.037661],
[30.000261, -95.170557],
[44.724374, -93.174043],
[39.8667, -86.1198],
[39.710778, -74.283471],
[39.317408, -76.65498],
[38.67286, -76.87373],
[34.9993, -80.6956],
[36.755575, -76.008729],
[33.916057, -117.957537],
[34.270205, -119.248931],
[40.638632, -75.440299],
[33.437512, -112.421574],
[40.526385, -105.022355],
[36.038276, -114.995926],
[36.59915, -79.41855],
[38.672775, -121.72546],
[30.392518, -97.744467],
[21.35588, -157.92863],
[21.331505, -158.092428],
[19.6484, -156.0034],
[38.572595, -89.987205],
[42.269144, -83.502679],
[40.051005, -75.058938],
[29.732888, -95.625989],
[36.078197, -119.047534],
[33.831151, -117.942502],
[36.067009, -95.776399],
[39.257692, -94.654643],
[33.87726, -118.166406],
[32.748133, -97.432168],
[29.4921, -98.7093],
[26.7223, -80.0849],
[30.66472, -96.322015],
[29.7302, -98.0729],
[41.724465, -71.476147],
[34.099047, -84.269375],
[41.840369, -71.884504],
[41.585898, -71.99532],
[41.610761, -72.901906],
[37.531146, -77.355702],
[41.24358, -76.835183],
[29.8437, -97.9708],
[40.841824, -76.837878],
[41.0765, -85.2031],
[33.739409, -116.217949],
[34.964885, -89.897729],
[34.000001, -84.282439],
[30.363559, -87.35716],
[40.847725, -74.809394],
[37.568412, -97.242317],
[44.8424, -93.7708],
[39.93529, -82.7927],
[40.75709, -73.8354],
[29.483085, -98.348183],
[41.219497, -95.837466],
[38.554173, -121.698906],
[45.27725, -93.562131],
[44.098702, -103.187464],
[39.5927, -104.8043],
[44.702275, -73.491221],
[35.48137, -97.763218],
[42.966106, -74.19003],
[34.2734, -118.7979],
[38.596466, -121.285233],
[32.821836, -117.179294],
[29.517627, -98.50388],
[34.424682, -117.384773],
[36.357583, -119.295701],
[33.760137, -118.293449],
[33.682, -117.1735],
[39.529998, -119.718714],
[38.2583, -85.6426],
[35.101339, -89.863041],
[40.824125, -73.930124],
[34.235236, -84.457879],
[37.5117, -77.691],
[42.623853, -71.317859],
[33.918865, -117.88802],
[30.455394, -88.900219],
[39.378584, -84.220235],
[39.144586, -84.619528],
[28.477827, -82.478374],
[41.8677, -87.8867],
[43.171022, -89.26765],
[38.5495, -121.4264],
[33.9443, -83.7537],
[29.602567, -95.264617],
[30.46814, -97.59951],
[40.05259, -75.665338],
[36.28957, -115.1331],
[36.299484, -94.173495],
[33.604179, -117.173854],
[37.0429, -76.3912],
[33.361141, -86.85259],
[33.121754, -96.662309],
[33.064687, -96.884937],
[45.576622, -122.564653],
[35.336502, -119.03577],
[39.023365, -94.24851],
[42.482275, -92.44385],
[40.0751, -75.1561],
[43.105117, -77.746641],
[40.309332, -75.859321],
[43.04945, -70.817669],
[30.4819, -90.4594],
[42.136962, -70.838953],
[30.7088, -95.5664],
[40.712962, -75.288023],
[40.049, -75.5203],
[39.439629, -77.992152],
[43.538413, -96.655021],
[36.018897, -95.884261],
[42.504356, -83.084573],
[42.989291, -88.258604],
[28.039694, -80.662203],
[40.265441, -75.652378],
[33.009075, -96.593493],
[41.9543, -88.7256],
[36.002854, -115.085172],
[36.271928, -115.20894],
[32.8128, -96.6211],
[37.418054, -121.956306],
[37.3741, -122.0314],
[43.0876, -88.0642],
[34.1371, -117.90785],
[33.984956, -118.394165],
[40.7439, -111.9018],
[42.222, -71.0256],
[35.349897, -119.125227],
[39.550043, -105.006169],
[30.011421, -97.86413],
[38.246545, -85.514562],
[34.7493, -92.3448],
[39.6811, -75.6522]];

TMAPS.headquarterLocations = 
[[44.97336, -93.275213],
[44.967895, -93.3267975],	
[33.368778, -111.963179],
[43.5040348, -96.7728165],
[40.763788, -111.89094],	 
[45.13519, -93.369092],
//newly added on 2/15/11
[44.974476, -93.274337],
[44.97456683426126, -93.27321767807007],
[44.861459, -93.313051],
[33.336171, -111.963128],
[32.22168, -110.952944],
[42.278005, -88.978888],
[44.490533, -88.090288],
[43.044958, -89.369589],
[44.93128, -89.656985]];

TMAPS.distributionCenterLocations =
[[45.0823983, -93.2814269],    
[34.1567306, -117.4553451],   
[38.2921829, -104.5285873],   
[38.6785157, -121.7732971],   
[31.4504629, -83.5084973],    
[43.1116731, -88.4992659],    
[44.6365107, -123.1059282],   
[39.6679687, -86.3400726],    
[38.0301356, -79.0336374],    
[32.4689369, -95.445877],     
[43.1334648, -73.606781],     
[36.800045, -76.5159988],     
[32.482361, -96.9944489],     
[42.9386856, -74.1881858],    
[38.9815559, -95.6852188],    
[39.944784, -83.2688045],     
[34.1591567, -117.404602],    
[34.1591567, -117.404602],    
[31.805769, -81.4306642],     
[41.9294736, -88.7503647],    
[32.1412239, -81.1917343],    
[35.6698552, -81.2214708],    
[30.1896756, -82.6392899],    
[33.4652252, -112.160614],    
[32.6818504, -97.33218],      
[42.5236111, -92.4463889],    
[44.9199562, -92.9438209],    
[32.0575542, -110.7180252],   
[34.054807, -117.6003444],    
[34.6992579, -86.7483318],    
[42.2886529, -85.418056],     
[33.4652252, -112.160614],    
[39.9375911, -77.6611022],    
[42.5236111, -92.4463889],    
[35.5005139, -119.2717761],   
[34.2273712, -80.6892486],    
[47.0342629, -122.8231915]];
/* Video.js */
/*
	Carousel / Video Carousel Class
	6/27/12
	MS

	DEPENDENCIES:
	jQuery
	
	PURPOSE:
	Provides functionality for video item & carousel
	
	TODO:

*/
if (TARGET === null || typeof(TARGET) !== "object") { var TARGET = new Object(); }

TARGET.Carousel = function (target, options) {
    var self = this;

    this.target = $(target);

    this.options = {
        activeClass: 'current', // class (HTML attribute) for active states
        animationDuration: 500, // time (in milliseconds) it takes for animation to complete
        currentIndex: 0, // current index of slides
        disabledClass: 'disabled', // class (HTML attribute) for disabled states
        groupsOf: 4, // organize slides into groups of x
        loop: false, // should the carousel loop around?
        nextBtn: 'next', // next button class
        prevBtn: 'prev', // previous button class
        sectionName: 'section', // names for each section/panel
        sectionSeparator: '-', // dash/underscore (or nothing) separates section name and index
        slidesSelector: 'ul', // the parent of all slides
        slideName: 'slide', // name for each slide
        slideSeparator: '-', // dash/underscore (or nothing) separates slide name and index
        showStates: true // display navigation states (usually dots)?
    };
    if (typeof options == 'object') {
        $.extend(this.options, options);
    }

    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------

    if (this.target) {
        // shortcuts and instance variables
        this.groupsOf = this.options.groupsOf;
        this.section = this.options.sectionName + this.options.sectionSeparator;
        this.states = false;
        this.animating = false;
        this.init = true; // initialize flag

        // construction
        this.slideWindow = this.target.find(this.options.slidesSelector); // find child
        this.slides = this.slideWindow.children(); // get the children of the ul (these are our slides)
        var childWidth = $(this.slides[0]).width(); // get width of first child to use as measuring stick
        var l = this.slides.length; // cache length
        var slideWindowWidth = (childWidth + 6) * l + 'px'; // set length of entire carousel
        this.slideWindow.css({ 'width': slideWindowWidth });

        this.currentIndex = (this.inBounds(this.options.currentIndex)) ? this.options.currentIndex : 0;
        this.groupIndex = (this.currentIndex % this.groupsOf === 0) ? this.currentIndex : (Math.floor(this.currentIndex / this.groupsOf) * this.groupsOf);

        // how many groups are there altogether?
        this.totalGroups = Math.ceil(this.slides.length / this.groupsOf);

        // are there more slides than the viewport can fit? If so create nav and set viewport items
        // if not, we're done

        // create nav
        this._createNav();
        // update nav and viewports
        this._updateNav();
        this._viewport(true);

        if (l <= this.groupsOf) {
			this._hideNav();
		}
    }
};

TARGET.Carousel.prototype = {
    inBounds: function (n) {
        // check if index is a) numeric and b) within the bounds of the carousel
        return (!isNaN(parseFloat(n)) && isFinite(n) && n >= 0 && n <= (this.slides.length - 1));
    },

    _createNav: function () {
        /**
        * create nav and next / previous buttons
        */
        var self = this;

        var nav = $(document.createElement('div')).addClass('pagination');

        this.prevBtn = $(document.createElement('a'))
							 .attr({ 'href': '#', 'title': 'Show Previous Panel' })
							 .addClass(this.options.prevBtn)
							 .append('<span>Previous Panel</span>');

        this.nextBtn = $(document.createElement('a'))
							 .attr({ 'href': '#', 'title': 'Show Next Panel' })
							 .addClass(this.options.nextBtn)
							 .append('<span>Next Panel</span>');

        // insert previous and next buttons in to nav or before / after carousel? @TOOD: set option to decide?
        this.target.prepend(this.prevBtn);
        this.target.append(this.nextBtn);

        this.target.append(nav);
        if (this.options.showStates === true && this.groupsOf > 1) {
            this.states = true;
            var ul = $(document.createElement('ul'));
            counter = 1;
            for (var i = 0, l = this.slides.length; i < l; i++) {
                if (i === 0 || i % this.groupsOf === 0) {
                    var li = '<li><a href="#"><span class="offscreen">Panel ' + counter + ' of ' + this.totalGroups + '</span></a></li>';
                    ul.append(li);
                    counter++;
                }
            }
            nav.append(ul);

            this.stateNav = ul;
            this.stateDots = ul.find('a');
            this.stateDots.bind('click', function (e) {
                e.preventDefault();
                self.currentIndex = self.groupsOf * $(e.currentTarget).parent().index();
                self.advanceTo(self.currentIndex);
            });
        }

        // events
        this.prevBtn.bind('click', function (e) {
            e.preventDefault();
            self.prev();
        });
        this.nextBtn.bind('click', function (e) {
            e.preventDefault();
            self.next();
        });

        // keyboard navigation
        $(document).bind('keydown', function (e) {
            var code;
            e = e || window.event;
            switch (e.keyCode) {
                case 37: // left arrow
                    self.prev();
                    break;
                case 39: // right arrow
                    self.next();
                    break;
            }
        });

		/*
		** Swipe
		*/
		self.isSwipeAnimating = false;
		if (TARGET.Config.hasTouch) {	    
    		//uses jquery.touchSwipe.min.js plugin
    		this.slideWindow.swipe({
    			swipeLeft:function(event, distance, duration, fingerCount) {
    			    
        			if (self.isSwipeAnimating === false) {
    					self.isSwipeAnimating = true;
    					self.advanceTo(self.getNextIndex(), false, function(){
    						self.isSwipeAnimating = false;
    					});
    				};
    			},
    			swipeRight:function(event, distance, duration, fingerCount) {
        			if (self.isSwipeAnimating === false) {
    					self.isSwipeAnimating = true;
    					self.advanceTo(self.getPrevIndex(), false, function(){
    						self.isSwipeAnimating = false;
    					});
    				};
    			},
    			fingers:$.fn.swipe.fingers.ALL 
    		});
    	}

    },
    _hideNav: function () {
        this.prevBtn.hide();
        this.nextBtn.hide();
        this.target.find('.pagination').hide();
        this.target.find('.playlist-thumbs').css('margin-left',0);
    },
    prev: function () {
		// find prev slide
        this.currentIndex = this.getPrevIndex();
        this.advanceTo(this.currentIndex);
    },

    next: function () {
        // find next slide
        this.currentIndex = this.getNextIndex();
        this.advanceTo(this.currentIndex);
    },
	getPrevIndex: function() {
		var previous = this.groupIndex - this.groupsOf;
        if (previous < 0) {
            if (this.options.loop) {
                previous = (this.totalGroups - 1) * this.groupsOf;
            } else {
                previous = 0;
            }
        }
        return previous;
	},
	getNextIndex: function() {
        var next = this.groupIndex + this.groupsOf;
        if (next >= this.slides.length) {
            if (this.options.loop) {
                next = 0;
            } else {
                next = this.groupIndex;
            }
        }
        return next;
	},
    advanceTo: function (index, jump, callback) {
        var self = this;

        // are we within bounds?
        if (!this.inBounds(index)) {
            index = this.slides.length - 1;
        }
        this.groupIndex = index = parseInt(index, 10); // make sure index is a number
        var left = this.slides[index].offsetLeft + 'px';
        this._killAnimation(); // stop any animating frames
        if (jump) {
            // go directly? Without animation?
            this.slides.find('a').css({ 'display': 'inline-block', 'visibility': 'visible' });
            this.slideWindow.css({ 'left': '-' + left });
            this._viewport();
        } else {
            this.animating = true;
            // need to port animation
            this.slides.find('a').css({ 'display': 'inline-block', 'visibility': 'visible' });

            this.slideWindow.animate({ 'left': '-' + left },
										this.options.animationDuration,
										'easeOutQuad',
										function (e) {
										    self._viewport();
										    self._killAnimation();
											if (typeof callback == "function") {
												callback.call(this);
											};
										});
        }

        this._updateNav(index);
    },

    /**
    * Hide (by setting display:none and visiblity:hidden) elements that are not currently in the viewport / frame,
    * and set display:block and visibility:visible of elements that are in the frame
    */
    _viewport: function (init) {
        var currentlyVisible = this.slides.slice(this.groupIndex, (this.groupIndex + this.groupsOf));
        var outsideViewport = [];

        $.each(this.slides, function (i, el) {
            if (jQuery.inArray(el, currentlyVisible) == -1) {
                outsideViewport.push(el);
            }
        });
        $(outsideViewport).find('a').css({ 'display': 'none', 'visibility': 'hidden' });

        // if not setup / init
        if (!this.init) {
            // set focus to current index
            this.slides.eq(this.currentIndex).next('a').focus();
        }
        this.init = false;
    },

    _updateNav: function () {
        var index = this.groupIndex / this.groupsOf;
        // update buttons (set disabled if needed)
        if ((this.groupIndex - this.groupsOf < 0) && this.options.loop !== true) {
            this.prevBtn.addClass(this.options.disabledClass).attr('tabIndex', '-1');
        } else {
            this.prevBtn.removeClass(this.options.disabledClass).attr('tabIndex', '0');
        }

        if ((this.groupIndex + this.groupsOf >= this.slides.length) && this.options.loop !== true) {
            this.nextBtn.addClass(this.options.disabledClass).attr('tabIndex', '-1');
        } else {
            this.nextBtn.removeClass(this.options.disabledClass).attr('tabIndex', '0');
        }
        var prevTxt = (index === 0) ? 1 : index;
        var nextTxt = (index + 2 > this.totalGroups) ? this.totalGroups : index + 2;
        this.prevBtn.next('span').text('Show panel ' + prevTxt + ' of ' + this.totalGroups);
        this.nextBtn.next('span').text('Show panel ' + nextTxt + ' of ' + this.totalGroups);

        // update states (if present)
        if (this.states) {
            this.stateDots.removeClass(this.options.activeClass);
            this.stateDots.eq(index).addClass(this.options.activeClass);
            var currentTxt = '',
				counter = 1;
            for (var i = 0, l = this.stateDots.length; i < l; i++) {
                if (i === index) {
                    currentTxt = ', current';
                    this.stateDots.eq(index).next('a').attr('tabindex', '-1');
                } else {
                    currentTxt = '';
                    this.stateDots.eq(index).next('a').attr('tabindex', '0');
                }
                $(this.stateDots).eq(index).next('span').text('Show panel ' + i + ' of ' + this.totalGroups);
                counter++;
            }
        }
    },

    _killAnimation: function () {
        if (this.animating) {
            // cancel animation 
            this.slideWindow.stop();
        }
        this.animating = false;
    }

};
TARGET.VideoCarousel = function (carouselRef, options) {
    var self = this;

    if (!carouselRef) {
        return;
    }
    
    this.options = {
        activeClass: 'active', // selected/active class
        autoPlay: 'false', // autoplay video (on page load)
        jsonPath: '/_ui/video/video_content.txt', // path to the JSON data
        elWrapper: '.gallery.video-player',
        playerID: 'hero-player', // selector (ID) of flash player content
        swfPlayerPath: '/_ui/swf/EverestDispatcher.swf', // path to the swf shell
        pathPrefix: '#video-', // prefix of hash
        elControls: '.controls',
        jsonString: ''
    };
    if (typeof options == 'object') {
        $.extend(this.options, options);
    }

    this.carousel = carouselRef;

    this.init = this.carousel.init = true; // flags
    this.pathPrefix = this.options.pathPrefix;

    this._route(); // get route, based on #hash in URL

    // jump to the right index
    this.carousel.advanceTo(this.carousel.groupIndex, true);

    // get all links
    this.lnks = this.carousel.slides;
    // set active link
    this.lnks.eq(this.carousel.currentIndex).addClass(this.options.activeClass);
    
    this.lnks.bind('click', function (e) {
        e.preventDefault();
        self.selectSlide($(this));
    });

    this.videoOptions = {
        autoplay: this.options.autoPlay,
        audiodescriptionSourceRatio: 0.5,
        autosize: 'full',
        newStageHeight: '368',
        newStageWidth: '655'
    };

    this.videoItem = new TARGET.VideoItem($('.gallery.video-player'), this.elControls, this.videoOptions, true);
    this.videoPlayer = this.videoItem.videoPlayer;

    var parentRef = $(this.carousel.target).parent();

    this.shareThis = parentRef.find('.share-this');
    this.shareLinks = this.shareThis.find('a');
    this.shareHeading = this.shareThis.find('h3');
    this.twitterShare = this.shareLinks.filter('.twitter');
    this.facebookShare = this.shareLinks.filter('.facebook');
    this.linkedInShare = this.shareLinks.filter('.linkedin');
    this.emailShare = this.shareThis.find('.icon-email');

    this.transcriptLink = parentRef.find('.transcriptLink');

    this.loadData(this.carousel.currentIndex);
};

TARGET.VideoCarousel.prototype = {
    _route: function () {

        // attempt to read hash
        if (window.location.hash !== '') {
            // find the id of slide 
            var name = window.location.hash.split(this.pathPrefix).pop();
            // get index of that slide, that's all we really care about
            if ($(name)) {
                var index = this.carousel.slideWindow.children('#' + name).prevAll().size();
            } else {
                index = this.carousel.currentIndex;
            }
            // is the index within the bounds?
            if (this.carousel.inBounds(index)) {
                // is the index evenly divisible by groupsOf? 
                if (index % this.carousel.groupsOf === 0) {
                    // if so we can go directly there
                    this.carousel.groupIndex = this.carousel.currentIndex = index;
                } else {
                    // if not, it's somewhere within a grouping
                    var groupCount = Math.floor(index / this.carousel.groupsOf) * this.carousel.groupsOf;
                    this.carousel.currentIndex = index;
                    this.carousel.groupIndex = groupCount;
                }
            } else {
                this.carousel.groupIndex = this.carousel.currentIndex = 0;
            }
        } else {
            this.carousel.groupIndex = this.carousel.currentIndex = 0;
        }
    },

    selectSlide: function (el) {
        var id = this.pathPrefix + el.attr('id');
        var index = el.prevAll().size();
        this.lnks.removeClass(this.options.activeClass);
        el.addClass(this.options.activeClass);
        // update hash
        window.location.hash = id;
        this.loadData(index);
    },

    loadData: function (index) {
        var video = this.carousel.slides.eq(index).attr('id'),
		self = this;

        // load JSON data (this does an AJAX request if we don't already have the json data)
        if (this.jsonPath) {
            $.ajax({
                url: this.options.jsonPath,
                method: 'get',
                success: function (response) {
                    self.jsonData = jQuery.parseJSON(response);
                    self.updateVideo(self.jsonData[video]);
                }
            });
        } else if (this.options.jsonString) {
            this.jsonData = jQuery.parseJSON(this.options.jsonString);

            this.updateVideo(this.jsonData[video]);
        }
        else {
            // we already have data, let's use it
            if (this.jsonData[video]) {
                this.updateVideo(this.jsonData[video]);
            } else {
                throw "Can't find videoID: " + video + " in the JSON data";
            }
        }
    },

    updateVideo: function (data) {
        var autoplayNow = 'true';
        if (this.init) {
            autoplayNow = 'false';
        }
        
        var loadedOptions = {
        	title: data.Title,
            poster: data.PosterImage,
            mp4Source: data.MP4Path,
            source: data.URL,
            captions: data.ClosedCaptionUrl,
            autoplay: autoplayNow
        };

        var playerDiv = $('#' + this.options.playerID);
        
        if (swfobject.hasFlashPlayerVersion("9.0.0")) {
            // moved inside this if statement
            this.videoPlayer.playVideo(loadedOptions);

            if (!this.init) {
                // set focus to video player, if it exists
                //$(this.videoPlayer.flashId_).focus();
                playerDiv.focus();
            }
        } else {

            // otherwise try to embed the mp4
            if (playerDiv) {
                if (this.init) {
                    this.videoItem.embedHTML5Player(loadedOptions);
                }
                else {
                    var html5Player = playerDiv.children('video');
                    html5Player.attr('poster', data.PosterImage).children('source').attr('src', data.MP4Path);
                    if (Modernizr.video) {
                        html5Player[0].load();
                    }

                }
                playerDiv.focus();
            }
        }

        // reset flag
        this.init = false;

        var url = encodeURIComponent(window.location.href);

        // twitter
        if (data.TwitterSharingText) {
            this.twitterShare.attr('href', 'http://twitter.com/intent/tweet?text=' + data.TwitterSharingText).parent().show();
        } else {
            this.twitterShare.parent().hide();
        }

        // linkedin
        if (data.LinkedInSummary) {
            this.linkedInShare.attr('href', 'http://www.linkedin.com/shareArticle?mini=true&url=' + url + '&title=' + data.LinkedInTitle + '&summary=' + data.LinkedInSummary + '&source=target.com').parent().show();
        } else {
            this.linkedInShare.parent().hide();
        }

        // facebook
        if (data.FacebookSharingText) {
            this.facebookShare.attr('href', 'http://www.facebook.com/sharer.php?s=100&p[url]=' + url + '&p[title]=' + data.LinkedInTitle + '&p[summary]=' + data.FacebookSharingText + '&p[images][0]=' + data.PosterImageThumb).parent().show(); //
        } else {
            this.facebookShare.parent().hide();
        }

        /* if (data.HideEmailSharingIcon == true) {
        this.shareHeading.hide();
        this.emailShare.hide();
        }
        else {
        this.shareHeading.show();
        this.emailShare.show();
        }*/
        this.emailShare.hide();
        if (this.shareThis.find('li:hidden').length == this.shareThis.find('li').length) {
            this.shareHeading.hide();
        }
        // transcript
        if (data.TranscriptUrl) {
            this.transcriptLink.show().attr('href', data.TranscriptUrl);
        } else {
            this.transcriptLink.hide();
        }

    }

};

TARGET.VideoItem = function(target, targetControls, options, isCarousel){
	var self = this;
	
	this.options = {
        elPlayer: '.player',
        minFlashVersion: '9.0.0',
        title: options.Title,
        source: options.URL,
        mp4Source: options.MP4Path,
        poster: options.PosterImage,
        captions: options.ClosedCaptionUrl,
        autoplay: options.autoplay,
        callback: 'GlobalFlashVideoReady'
	};
    if(typeof options == 'object') {
        $.extend(this.options, options);
    }

	this.elWrapper = $(target);
	this.elFlashPlayerID = this.elWrapper.find(this.options.elPlayer).attr('id');	
	this.elControls = this.elWrapper.find(targetControls);
    	
	// keyboard navigation
	$(document).bind('keydown', function(e){ 
		// listen for ESC key
		if(e.keyCode === 27) {
			self.isFlash === true ? self.videoPlayer.stop() : self.videoPlayer.pause();
		}
	});
	
	this.init(isCarousel);    
};
TARGET.VideoItem.prototype = {
    init: function (isCarousel) {
        var self = this;

        if (swfobject.hasFlashPlayerVersion(this.options.minFlashVersion) && TARGET.Util.isMobile() !== true) {
            this.embedFlashPlayer();
        } else {
            if (isCarousel === false) {
                this.embedHTML5Player();
            }
        }

        this.elControls.bind('click', function (e) {
            e.preventDefault();
            var elBtn = $(this);
            //var btnID = elBtn.attr('id');

            if (elBtn.hasClass('play')) {
                self.videoPlayer.play();
            } else if (elBtn.hasClass('pause')) {
                self.videoPlayer.pause();
            } else if (elBtn.hasClass('stop')) {
                self.isFlash === true ? self.videoPlayer.stop() : self.videoPlayer.pause();
			}
        });
    },
    embedFlashPlayer: function () {
        var timestamp = new Date().getTime(); // create a new timestamp so we can get around caching issues in IE
        var swfPath = "/_ui/swf/EverestDispatcher.swf" + "?" + timestamp;
        this.videoPlayer = new TARGET.EverestVideoPlayer(this.elFlashPlayerID, "654", "368", swfPath, 'videoPlayer', this.options);
        this.isFlash = true;
    },
    embedHTML5Player: function (data) {
	
		if (!data) {
			data = this.options;
		};
		
		data.PosterImage = (data.PosterImage)? data.PosterImage : data.poster;
		data.MP4Path = (data.MP4Path)? data.MP4Path : data.mp4Source;
	
        var html5Player = $('<video controls="controls" poster="' + data.PosterImage + '" autobuffer="autobuffer"><source src="' + data.mp4Source + '" type="video/mp4" />Sorry! Your browser can\'t play our HTML5 videos. Please enable Flash.</video>');

        this.elWrapper.find(this.options.elPlayer).append(html5Player);
        
        this.videoPlayer = html5Player[0];
        
        if(Modernizr.video) {
			this.videoPlayer.addEventListener('play', function(){
				_gaq.push(['_trackEvent', 'Video', 'HTML5 play', data.title]);
			});
			this.videoPlayer.addEventListener('ended', function(){
				_gaq.push(['_trackEvent', 'Video', 'HTML5 complete', data.title]);
			});
	        this.videoPlayer.load();
		}
        this.isFlash = false;
    }
};
function GlobalFlashVideoReady(){
    //console.log('GlobalFlashVideoReady');
    var TrackTargetVideoPlayer = $('.video-player').find('object')[0];
    TrackTargetVideoPlayer.addVideoPlayerEventListener('eventPlay', 'GlobalFlashVideoPlay');
    TrackTargetVideoPlayer.addVideoPlayerEventListener('eventPause', 'GlobalFlashVideoPause');
  	TrackTargetVideoPlayer.addVideoPlayerEventListener('eventComplete', 'GlobalFlashVideoComplete'); 
}
function GlobalFlashVideoPlay(){
    //console.log('GlobalFlashVideoPlay');
    var videoTitle = $('.playlist-thumbs').find('li.active span.video-title').text();
	_gaq.push(['_trackEvent', 'Video', 'Flash play', videoTitle]);
}
function GlobalFlashVideoPause() {
    //console.log('GlobalFlashVideoPause');
}
function GlobalFlashVideoComplete() {
    //console.log('GlobalFlashVideoComplete');
    var videoTitle = $('.playlist-thumbs').find('li.active span.video-title').text();
    _gaq.push(['_trackEvent', 'Video', 'Flash complete', videoTitle]);
}

/* CheckBoxWidget.js */
/*
    CheckBoxWidget Class
    6/11/12
    JF

    DEPENDENCIES:
    jQuery
    
    PURPOSE:
    Provides functionality for:
       - Styled Checkboxes
    
    TODO:
	
    
*/
var CheckBoxWidget = function(target, options) {
    var self = this;

    // ------------------------------------------------------------
    // DEFAULTS
    // ------------------------------------------------------------
    this.options = {};

    if(typeof options == 'object') {
        $.extend(this.options, options);
    }
    
    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------ 
    this.checkWrapper = target;
    this.checkInput =  this.checkWrapper.find('input');
    this.checkLabel = this.checkWrapper.find('label');
	this.checkSquare = this.checkWrapper.find('span.styledCheck');

    // ------------------------------------------------------------
    // EVENT HANDLERS
    // ------------------------------------------------------------      
 	this.checkSquare.attr('tabIndex',0).bind('keydown', function(e){		
		if (e.keyCode == 32) {
			e.preventDefault();
			
			if($(this).siblings('input[type=checkbox]').attr('checked'))
	            self.actionUncheck();
	        else
	            self.actionCheck();
		};
    });
    this.checkWrapper.bind('click',function(e){
        e.preventDefault();
        
        if($(this).find('input').attr('checked'))
            self.actionUncheck();
        else
            self.actionCheck();
    });
	this.checkLabel.bind('dblclick', function(e){
		e.preventDefault();
	});
};
CheckBoxWidget.prototype = {
	actionCheck: function(){
		this.checkInput.attr({checked: "checked"});
		this.checkWrapper.addClass("checked");
		this.checkSquare.text("X");		
	},
	actionUncheck: function(){
		this.checkInput.removeAttr("checked");
		this.checkWrapper.removeClass("checked");
		this.checkSquare.empty();
	}
};
/* MobileSearchWidget.js */
/*
Mobile Search Widget
7/9/12
MS

DEPENDENCIES:
jQuery

PURPOSE:
Singleton that controls show/hide of mobile search box
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = new Object(); }

TARGET.MobileSearchWidget = (function(){
    var _instance;
    
    function init(){
        return {
            //
            // Globals
            //
            numFadeSpeed        :   400,
            numNavDelay         :   50,
            elSearchLabel		:	$('#searchLabel'),
            elSearchFields		:	$('#searchFields'),
            
            isOpen			    :   false,
			
            kickoff: function(){
                var self = this;
                
                this.navigation = TARGET.Navigation.getInstance();
                this.elHeader = this.navigation.elHeader;
                
                // Click
                this.elSearchLabel.click(function(e){
                    e.preventDefault();
                    
                    // checking each time we click because of window resizing
                    if(TARGET.Util.isMobile() == true){
                    	if(self.isOpen == false)
	                    	self.openSearchWidget();
                    	else 
	                    	self.closeSearchWidget();
                    }
                });
                $(window).bind('resize', function(e){
	             	self.bindResizeEvent(e);
                });
            },
			bindResizeEvent: function(){
				var self = this;
				if(TARGET.Util.isMobile() == false){
					if(this.isOpen == true){
						this.closeSearchWidget();
					}
				}
			},
			openSearchWidget: function(){
                // define self for future this reference
                var self = this;
                
                if(this.elHeader.isOpen == true){
                	this.navigation.mobileMenuBtnClickAction();
                	
                	this.timeout = setTimeout(function(){
                		self.openActions(self);
                	},500)
                }
                else {
	                this.openActions();
                }         	      
            },
            openActions: function(scope){
            	var self = this;
            	
				this.elHeader.removeAttr('style').addClass('searchOpen');
                
				this.elSearchLabel.addClass('active');
				
				this.elSearchFields.openTimeout = setTimeout(function() {
				    self.elSearchFields.addClass('open');
				    self.isOpen = true;
				}, self.numNavDelay);  
            },
            closeSearchWidget: function(){        
                // reset dynamically applied css
                this.resetStyle();
                
                this.elHeader.removeClass('searchOpen');
                this.isOpen = false;
                this.elSearchLabel.removeClass('active');
            },
            resetStyle: function(){
				this.elSearchFields.removeClass('open');
                this.elSearchFields.removeAttr('style');
                this.elHeader.removeAttr('style');
            },
			isInTransition: function(object) {
				var self = this;
				self.isAnimating = true;
				object.on('webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd', function (e) {
					self.isAnimating = false;
					//object.off('webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd');
				});
			}
        };
    };
    return {
        getInstance: function(){
            if(!_instance) _instance = init();
            return _instance;
        }
    };
})();
/* InlineVideoWidget.js */
/*
    InlineVideoWidget Class
    7/6/12
    JF

    DEPENDENCIES:
    jQuery
    
    PURPOSE:
    Provides functionality for:
       - Inline Single Videos that load in an overlay
    
    TODO:
    
*/
if (TARGET === null || typeof(TARGET) !== "object") { var TARGET = new Object(); }

TARGET.InlineVideoWidget = function (target, options) {
    var self = this;

    // ------------------------------------------------------------
    // DEFAULTS
    // ------------------------------------------------------------
    this.options = {};

    if (typeof options == 'object') {
        $.extend(this.options, options);
    }

    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------ 
    this.elTarget = $(target);
    this.elWrapper = this.elTarget.parent();
    this.isRemote = false;
    this.elToFocus;
    this.inlineVideoTarget;
	this.modalHeight = 450;
	this.isMobileEmbedded = false;
	this.videoJSONCache = null;
	
    // ------------------------------------------------------------
    // INITIAL SETUP
    // ------------------------------------------------------------ 
    if (this.elTarget.hasClass('remote')) {
        this.isRemote = true;
    }
	
	if (TARGET.Util.isMobile() || Modernizr.touch) {
		this.mobileVideoEmbed();
	};
	
	jQuery(window).bind('resize', function(){
		if (TARGET.Util.isMobile() || Modernizr.touch) {
			if (!self.isMobileEmbedded) {
				self.mobileVideoEmbed();
			};
		} else {
			if (self.isMobileEmbedded) {
				self.mobileVideoUnembed();
			};
		};
	});

    // ------------------------------------------------------------
    // EVENT HANDLERS
    // ------------------------------------------------------------  
    if(!TARGET.Util.isMobile()){
	    this.elTarget.bind('click', function (e) {
	        e.preventDefault();
	
	        var inlineVideoTarget = null;
        	        
	        if (self.isRemote) {
	            var dataSource = self.elTarget.attr('data-source'),
					ajaxSettings = {
					    url: dataSource,
					    success: function (data, textStatus, jqXHR) {
					        if (data !== "") {
					            self.videoJSONCache = $.parseJSON(data);
								if (!self.videoJSONCache) {
									self.videoJSONCache = data;
								};
	
					            self.buildVideoEmbed(self.videoJSONCache);
								self.launchOverlay();
					        };
					    },
					    error: function (jqXHR, textStatus, errorThrown) {
					        //console.log(errorThrown.stack);
					    }
					};
					
				if (self.videoJSONCache) {
					self.buildVideoEmbed(self.videoJSONCache);
					self.launchOverlay();
				} else {
					$.ajax(ajaxSettings);
				};	
	        } else {
	            self.inlineVideoTarget = $(self.elTarget.attr('data-source'));
	            self.launchOverlay();
	        };
	    });
    }
};
TARGET.InlineVideoWidget.prototype = {
	mobileVideoEmbed: function(){
		var self = this;
		self.isMobileEmbedded = true;
		if (self.isRemote) {
			
            var dataSource = self.elTarget.attr('data-source'),
				ajaxSettings = {
				    url: dataSource,
				    success: function (data, textStatus, jqXHR) {
				        if (data !== "") {
				            self.videoJSONCache = $.parseJSON(data);
							if (!self.videoJSONCache) {
								self.videoJSONCache = data;
							};

				            self.buildVideoEmbed(self.videoJSONCache);
							self.inlineVideoTarget.removeClass('hidden');
							self.elTarget.hide();
							
				        };
				    },
				    error: function (jqXHR, textStatus, errorThrown) {
				        //alert("error: "+errorThrown.stack);
				    }
				};
			
           	if (self.videoJSONCache) {
				self.buildVideoEmbed(self.videoJSONCache);
				self.inlineVideoTarget.removeClass('hidden');
				self.elTarget.hide();
			} else {
				$.ajax(ajaxSettings);
			};
        } else {
            self.inlineVideoTarget = $(self.elTarget.attr('data-source'));
            self.launchOverlay();
        };
	},
	mobileVideoUnembed: function(){
		var self = this;
		
		self.inlineVideoTarget.remove();
		self.elTarget.show();
		self.isMobileEmbedded = false;
	},
    buildVideoEmbed: function (response) {
        var self = this,
			caption = "",
			transcript = "";

       	if (response.Caption) {
            caption = '<h3>' + response.Caption + '</h3>';
			if (response.SubCaption) { 
				this.modalHeight = 450;
				caption += '<p>' + response.SubCaption + '</p>'; 
			};
        } else if (response.Title) {
			caption = '<h3>' + response.Title + '</h3>';
		};
        if (response.TranscriptUrl) {
            transcript = '<p><a href="' + response.TranscriptUrl + '">read full transcript</a></p>';
        };

        if (response.PosterImage) {
            response.PosterImage = TARGET.Util.trimTilde(response.PosterImage);
        }
        if (response.PosterImageThumb) {
            response.PosterImageThumb = TARGET.Util.trimTilde(response.PosterImageThumb);
        }
        
        var timestamp = new Date().getTime(); // create a new timestamp so we can have multiple players
        var template = '<div class="inline-video-wrapper hidden"><div class="gallery video-player single"><div id="player'+timestamp+'" class="inline-player"></div><div class="offscreen controls"><a class="play" href="#">play video</a><a class="pause" href="#">pause video</a><a class="stop" href="#">stop video</a></div>';
        template += '<div class="videoInfo-col1">' + caption + '</div><div class="videoInfo-col2">' + transcript + '</div><div class="clear"></div></div></div>';
        
        this.elWrapper.append(template);

        this.inlineVideoTarget = this.elWrapper.find('.inline-video-wrapper');
        
        var videoOptions = {
            autoplay: "false",
            autosize: "full",
            elPlayer: '.inline-player',
            audiodescriptionSourceRatio: .5,
            title: response.Title,
            PosterImage: response.PosterImage,
            MP4Path: response.MP4Path,
            URL: response.URL,
            ClosedCaptionUrl: response.ClosedCaptionUrl
        };
        this.videoItem = new TARGET.VideoItem(this.elWrapper, '.controls a', videoOptions, false);
        
		this.elTarget.bind('click', function (e) {
			e.preventDefault();
			self.inlineVideoTarget.find('a').click();
		});
    },
    launchOverlay: function () {
        var self = this;

        if (self.inlineVideoTarget && self.inlineVideoTarget.length > 0) {
            // Clone the target so we can re-inject on close
            var inlineVideoTargetClone = self.inlineVideoTarget.clone();
            self.inlineVideoTarget.removeClass('hidden');
            $.overlay.load({
                height: self.modalHeight,
                width: 685,
                div: self.inlineVideoTarget,
                onClose: function () {
                    //self.elWrapper.append(inlineVideoTargetClone);
                }
            });
        };
    }
};

/* HistoryTimelineText.js */
/*
    History Timeline Text Version Controller
    6/28/12
    JF

    DEPENDENCIES:
    jQuery
    
    PURPOSE:
    Singleton that controls history timeline: text versions
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = new Object(); }

TARGET.HistoryTimelineText = (function () {
    var _instance;

    function kickoff() {
        return {
            initialize: function (options) {
                var self = this;

                // attach event handlers
                self.eventHandlers();
            },
            eventHandlers: function () {
                var self = this;

                // hook up back to top links
                $('.about.history-text a.back-to-top').click(function (e) {
                    self.backToTopLinks(e);
                });

                // hook up history text nav
                $('.about.history-text nav#history-text-nav ul li a').click(function (e) {
                    self.historyTextNav(e);
                });

                // hook up history text nav mobile experience
                $('.about.history-text .history-text-decade-wrapper h2.history-text-decade-label').click(function (e) {
                    self.historyTextNavMobile(e);
                });
            },
            backToTopLinks: function (e) {
                var self = this;

                TARGET.Util.smoothScroll(e, true, null, function () {
                    $('#history-text-nav li').removeClass('current');
                    $('#history-text-nav li:first').addClass('current');
                });
            },
            historyTextNav: function (e) {
                var self = this;

                var trigger = $(e.target);
                var target = $(trigger.attr('href')).next('.history-text-block');

                TARGET.Util.smoothScroll(e, false, target, function () {
                    $('#history-text-nav li').removeClass('current');
                    trigger.parent('li').addClass('current');
                });
            },
            historyTextNavMobile: function (e) {
                var self = this;

                var trigger = $(e.target);
                var panels = $('.history-text-decade-wrapper');
                var activePanel = trigger.parent('.history-text-decade-wrapper');
                var isActive = activePanel.filter('.active').length;

                panels.each(function () {
                    $(this).removeClass('active');
                });
                if (!isActive) {
                    activePanel.addClass('active');
                };
            }
        };
    };
    return {
        getInstance: function () {
            if (!_instance)
                _instance = kickoff();
            return _instance;
        }
    };
})();
/* RecruitingEvents.js */
/*
Recruiting Events Controller
8/1/13
MS

DEPENDENCIES:
jQuery
	
PURPOSE:
Singleton that controls Recruiting Events widget
*/

if (TARGET === null || typeof (TARGET) !== "object") { var TARGET = new Object(); }

TARGET.RecruitingEvents = (function () {
    var _instance;

    function init() {
        return {
            elRecruitingEvents: $('.recruiting-events-widget'),
            startNum: 1,
            endNum: 10,
            storiesPerPage: 10,
            storyPageIndex: 1,
            endIndex: 11,

            elStoryWrapper: $('.storyWrapper'),
            panelThreshold: 6,
            storyStartId: 0,
            storyEndId: 0,

            kickoff: function (options) {
                var self = this;

                this.recruitingFilterSubmitBtn = this.elRecruitingEvents.find('.form-widget input.redBtn');
                this.recruitingSelectState = $('#state-select').children('select');
                this.recruitingSelectEvent = $('#event-select').children('select');
                this.recruitingErrorState = this.elRecruitingEvents.find('.error');
                this.loadMoreBtn = $('#load-more');
                this.elListTop = $('#event-list-top');

                this.options = options;

                this.elEventListWrapper = this.elRecruitingEvents.find('.upcoming-events > div');
                this.elEventList = this.elEventListWrapper.find('ul');

                this.elEventListItems = this.elEventList.children('li');
                this.elEventLinks = this.elEventListItems.find('a');

                this.eventTemplate = '<li>'
	                	+ '<div class="float">'
	                	    + '<p class="name-city">'
                                + '<a href="#" class="title"><span class="name"></span></a>'
                                + '<span class="city"></span>'
                            + '</p>'
	                	    + '<p class="date-location">'
	                    	    + '<span class="date"></span>'
	                    	    + '<span class="location"></span>'
                            + '</p>'
	                	+ '</div>'
	                    + '<p class="learn-more">'
							+ '<a href="" class="redBtn"><span class="name offscreen"></span>learn more</a>'
						+ '</p>'
					    + '<div class="clear"></div>'
	            + '</li>';

                this.eventHandlers();
            },
            eventHandlers: function () {
                var self = this;


                this.recruitingFilterSubmitBtn.on('click', function (event) {
                    event.preventDefault();
                    self.buttonClickHandler(event);
                });

                this.loadMoreBtn.find('a').on('click', function (event) {
                    event.preventDefault();
                    self.storyPageIndex++;
                    self.endIndex = self.storiesPerPage * self.storyPageIndex;
                    var startIndex = (self.endIndex - self.storiesPerPage) + 1;
                    self.loadStories(startIndex, self.endIndex, function () { });

                    var destination = $('#topOfList').offset().top;                  
                    $('body,html').animate({
                        scrollTop: destination
                    }, 1000, 'easeInOutCubic');
                });

            },

            //clear counters used for showing "load more events" button
            resetIndexCounters: function (from) {
                this.endIndex = 10;
                this.storyPageIndex = 1;
            },

            buttonClickHandler: function (event) {
                var self = this;

                var stateSelect = this.recruitingSelectState.val(),
                    eventSelect = this.recruitingSelectEvent.val();

                self.resetIndexCounters();

				this.loadStories(this.startNum, this.endNum);
            },
            getRecruitingEventsURL: function (startNum, endNum) {
                // create REST endpoint url for fetching recruiting events by state and type
                return '/recruitingevents/' + this.recruitingSelectState.val() + '/' + this.recruitingSelectEvent.val() + '?start=' + startNum + '&end=' + endNum;
            },
            loadStories: function (startNum, endNum, callback) {

                var self = this;

                if ((!startNum || !endNum) && (this.storyNum || this.endNum === 0)) {

                    if (this.endNum < 0) {
                        this.endNum = 0;
                    };

                    this.startNum = this.endNum;
                    this.endNum = this.endNum + this.storyLoadNum;
                };

                var endpoint = this.getRecruitingEventsURL(startNum, endNum);

                var ajaxOptions = {
                    url: endpoint,
                    type: 'GET',
                    success: function (data) {

                        if (data.TotalCount > 0) {
                            self.clearEvents();

                            self.buildEvents(data, null, callback);
                        }
                        else {
                            self.showEmptyMessage();
                        };
                    }
                };

                $.ajax(ajaxOptions);

            },
            buildEvents: function (data, onBeforeSetupEvents, onAfterSetupEvents) {

                var self = this;
                var i;

                for (i = 0; i < data.TotalCount; i++) {
                    var event = data.Events[i];
                    if (event) {
                        var eventItem = $(self.eventTemplate);
                        var eventLink = event.MoreInfoLink;
                        var boolOffscreenLink = event.OpenMoreInfoLinkInNewWindow;

                        eventItem.find('a').attr('href', eventLink).find('.name').text(event.Name);
                        if (boolOffscreenLink) {
                            eventItem.find('a').attr({ 'title': 'Link opens in a new window', 'target': '_blank' }).append('<span class="offscreen"> opens in a new window</span>');
                        }

                        if (event.City !== null || event.State !== null) {
                            var cityStateText = (event.City !== null ? event.City : '') + (event.State !== null ? ', ' + event.State : '');
                            eventItem.find('.city').text(cityStateText);
                        }
                        if (event.EventStartDate !== null) {
                            //add end date if not empty.
                            if (event.EventEndDate !== null) {
                                eventItem.find('.date').text(self.formatDate(event.EventStartDate, event.EventEndDate));
                            } else {
                                eventItem.find('.date').text(self.formatStartDate(event.EventStartDate));
                            }
                        }
                        if (event.Location !== null) {
                            eventItem.find('.location').text(event.Location);
                        }

                        self.elEventList.append(eventItem);
                    }
                }

                if (typeof onBeforeSetupEvents == 'function') {
                    onBeforeSetupEvents.call(this);
                };

                //console.log('buildEvents -- totalCount, endIndex: ', data.TotalCount, self.endIndex);

                if (data.TotalCount > 10 && data.TotalCount > self.endIndex) {
                    this.loadMoreBtn.addClass('visible');

                } else {
                    this.loadMoreBtn.removeClass('visible');
                }
            },
            formatDate: function (startDate, endDate) {
                // put start and end dates into the right format               
                return startDate + ' - ' + endDate;
            },
            formatStartDate: function (startDate) {
                // show only start date               
                return startDate;
            },
            clearEvents: function () {
                var self = this;

                this.elEventListWrapper.find('.empty').removeClass('visible');

                // clear events currently showing
                this.elEventList.empty();
            },
            showEmptyMessage: function () {
                this.clearEvents();
                this.elEventListWrapper.find('.empty').addClass('visible');
                this.loadMoreBtn.removeClass('visible');
            }
        };
    };
    return {
        getInstance: function () {
            if (!_instance) {
                _instance = init();
            }
            return _instance;
        }
    };
})();

/* DiscoverControllers.js */
/*
Discover Pagination Controller
7/18/12
JF

DEPENDENCIES:
jQuery, JSON.js, Store.js
	
PURPOSE:
Singleton that controls Discover pagination
*/

if (TARGET === null || typeof (TARGET) !== "object") { var TARGET = new Object(); }

TARGET.DiscoverPagination = (function () {
    var _instance;

    function init() {
        return {
            /* tags will be appended by the CMS  */
            elStoryWrapper: $('.storyWrapper'),
            numDesktopPanelsToShow: 3,
            panelThreshold: 6,
            storyStartId: 0,
            storyEndId: 0,
            kickoff: function (options) {
                var self = this;

                this.options = options;

                this.storyEndpoint = this.options.storyEndpoint;
                this.storyLoadNum = this.options.storyLoadNum;
                this.elArrows = $('nav.arrows');
                this.elPanels = this.elStoryWrapper.find('article');
                this.elPanelLinks = this.elPanels.find('a');
                this.numPanels = this.elPanels.length;
                this.numPanelWidth = this.elPanels.first().width() + 70;
                this.numCurrPanel = 0;
                this.storyTemplate = '<article>'
	                	+ '<h3 class="block-title"><a href="#"></a></h3>'
	                	+ '<div class="img"><a href="#"></a></div>'
	                	+ '<div class="article-body">'
	                    	+ '<time class="date" datetime=""></time>'
	                    	+ '<p class="bullet tags"></p>'
	                    	+ '<div class="sharing">'
								+ '<div class="share-button">'
								    + '<div class="fb-like" data-href="" data-send="false" data-layout="button_count" data-width="120" data-show-faces="false"></div>'
					            + '</div>'
					            + '<div class="share-button">'
									+ '<a href="https://twitter.com/share" class="twitter-share-button" data-text="" data-url="" data-dnt="true" data-lang="en">Tweet</a>'
								+ '</div>'
							+ '</div>'
	                	+ '</div>'
					+ '<p class="mobile-read-more"><a href="#" class="more" title="Read the full story">read more</a></p>'
	            + '</article>';

                this.eventHandlers();

                if (this.elStoryWrapper.children().length === 0) {
                    this.loadStories();
                } else {
                    this.setupStories();
                    this.storyEndId = this.elStoryWrapper.children().length;
                };
            },
            eventHandlers: function () {
                var self = this;

                this.elArrows.find('a').bind('click', function (e) {

                    e.preventDefault();
                    e.stopPropagation();

                    if (!$(this).hasClass('disabled')) {
                        var _target = $(e.currentTarget);

                        // check which arrow was clicked and do stuff accordingly
                        if (_target.hasClass('next')) {
                            self.nextArrowAction();
                        } else if (_target.hasClass('previous')) {
                            self.prevArrowAction();
                        }
                    };

                });
                if(!Modernizr.touch){
	                // Prevent tabbing onto stories that are positioned offscreen
	                this.elPanelLinks.on('focus', function(e){
	                	var parentArticle = $(this).parents('article');
	                	
	                	if((self.getCSSNumberFromPxValue(parentArticle.css('left')) + self.getCSSNumberFromPxValue(self.elStoryWrapper.css('left'))) > $(window).width()-self.numPanelWidth){
		                	self.elArrows.find('a.next').focus();	                	
	                	}
	                	else if(self.getCSSNumberFromPxValue(parentArticle.css('left')) + self.getCSSNumberFromPxValue(self.elStoryWrapper.css('left')) < 0) {
		                		self.elArrows.find('a.previous').focus();
	                	}
	                });
                }
                $(window).resize(function (e) {
                    self.setupStories();
                });

				if (TARGET.Util.isMobile()) {
					this.loading = false;
					jQuery(window).bind('scroll', function(){
						var footerOffset = jQuery('footer#global-footer').offset();

						if ((jQuery(window).scrollTop() + jQuery(window).height()) >= footerOffset.top) {
							if (!self.loading) {
								// TODO: Keep it from making requests endlessly
								//console.log("loading");
								self.loading = true;
								self.loadStories(false, false, function(){
									self.loading = false;
								});
							};
						};
					});
				};
				
				
				self.isSwipeAnimating = false;
				if (TARGET.Config.hasTouch) {	    
            		//uses jquery.touchSwipe.min.js plugin
            		$('.storyFrame').swipe({
            			swipeLeft:function(event, distance, duration, fingerCount) {
            			    
                			if (self.isSwipeAnimating === false) {
            					self.isSwipeAnimating = true;
            					self.nextArrowAction(function(){
    								self.isSwipeAnimating = false;
    							});
            				};
            			},
            			swipeRight:function(event, distance, duration, fingerCount) {
                			if (self.isSwipeAnimating === false) {
            					self.isSwipeAnimating = true;
            					self.prevArrowAction(function(){
    								self.isSwipeAnimating = false;
    							});
            				};
            			},
            			fingers:$.fn.swipe.fingers.ALL 
            		});
            	}
			},
			loadStories: function(storyStartId, storyEndId, callback){
				var self = this;
				
				if ((!storyStartId || !storyEndId) && (this.storyEndId || this.storyEndId === 0)) {
					
					if (this.storyEndId < 0) {
						this.storyEndId = 0;
						//window.location.hash = this.storyEndId;
					};
					
					this.storyStartId = this.storyEndId;
					this.storyEndId = this.storyEndId + this.storyLoadNum;
				};
				
				var endpoint = this.storyEndpoint.replace("{start_id}", this.storyStartId).replace("{end_id}", this.storyEndId);;
				
				var ajaxOptions = {
					url: endpoint,
					type: 'GET',
					success: function(data){
						//console.log(data);
						if (data.length > 0) {
							self.storeStories(data);
							self.buildStories(data, null, callback);
						};
					}
				};
				
				$.ajax(ajaxOptions);
				
			},
			loadStoriesFromHash: function(targetStory){
				var self = this;

                if (targetStory < 0) {
                    targetStory = 0;
                    window.location.hash = targetStory;
                };

                this.loadStories(0, (targetStory + 10), function () {
                    self.goToStoryByHash(targetStory);
                });
            },
            buildStories: function (stories, onBeforeSetupStories, onAfterSetupStories) {
                var self = this;

                for (story in stories) {
                    if (story < stories.length - 1 && stories[story] !== null) {
                        var storyItem = $(self.storyTemplate);
                        var storyLink = stories[story].ArticleLink;

                        storyItem.find('h3.block-title a').text(stories[story].Title).attr('href', storyLink);

                        if (stories[story].Children[0] && stories[story].Children[0].SummaryImage) {
                            var imgSrc = TARGET.Util.trimTilde(stories[story].Children[0].SummaryImage);
                            var imgAlt = stories[story].Children[0].ImageAlt;

                            storyItem.find('div.img a').attr('href', storyLink).append('<img src="' + imgSrc + '" alt="" />');
                        };

                        storyItem.find('.article-body time').text(stories[story].ArticleDate).attr('datetime', stories[story].ArticlePropertyDate);
                        storyItem.find('.article-body time').after(stories[story].ShortDescription);
                        storyItem.find('.article-body time').next('p').find('a.more').attr('href', stories[story].ArticleLink);

                        if (stories[story].Tags != undefined && stories[story].Tags.length > 0) {
                            storyItem.find('p.tags').before('<p><a href="' + stories[story].ArticleLink + '" class="more" title="Read the full story">read the full story</a></p>').append('TAGS: ');

                            for (tag in stories[story].Tags) {

                                if (tag < stories[story].Tags.length) {
                                    var tagItem = $("<a></a>");

                                    tagItem.attr('href', stories[story].Tags[tag].TagURL)
										   .attr('rel', stories[story].Tags[tag].TagID)
										   .text(stories[story].Tags[tag].TagName);

                                    storyItem.find('p.tags').append(tagItem);
                                    if (tag != (stories[story].Tags.length - 1)) {
                                        storyItem.find('p.tags').append(", ");
                                    };
                                };
                            }

                        } else {
                            storyItem.find('p.tags').remove();
                        };

                        storyItem.find('.share-button .fb-like').attr('data-href', stories[story].ArticleLink);
                        storyItem.find('.share-button .twitter-share-button').attr('data-url', stories[story].ArticleLink).attr('data-text', stories[story].Title);
                        
                        twttr.widgets.load();         
                        
                        this.elStoryWrapper.append(storyItem);
                    }
                }

                if (typeof onBeforeSetupStories == 'function') {
                    onBeforeSetupStories.call(this);
                };

                this.setupStories(onAfterSetupStories);
            },
            setupStories: function (callback) {
                var self = this;

                this.elPanels = this.elStoryWrapper.find('article');
                this.numPanels = this.elPanels.length;
                this.numPanelWidth = this.elPanels.first().width() + 70;

                if (TARGET.Util.isMobile() === false) {
                    this.elPanels.each(function (i, e) {
                        $(this).css({ 'left': self.numPanelWidth * i });
                    });
                };

                self.checkArrowState();

                if (typeof callback == 'function') {
                    callback.call(this);
                };
            },
            storyPersistence: function () {
                var self = this;

                // Cross-browser implementation using store.js
                if (store !== null) {
                    // If we can use some sort of persistent storage
                    if (store.enabled) {

                        // If there is a hash in the url and we have stored stories
                        if (store.get('discoverStoriesLoaded') && window.location.hash) {

                            //console.log('loading stories from local storage...');

                            var targetStory = window.location.hash.split('#')[1];
                            if (!isNaN(targetStory)) {
                                self.popStories(targetStory);
                            }
                        } else if (store.get('discoverStoriesLoaded') && !window.location.hash) {

                            //console.log('clearing local storage...');

                            self.clearStories();
                        } else if (!store.get('discoverStoriesLoaded') && window.location.hash) {

                            //console.log('loading stories from endpoint...');

                            var targetStory = window.location.hash.split('#')[1];
                            if (!isNaN(targetStory)) {
                                self.loadStoriesFromHash(targetStory);
                            }
                        };
                    } else {
                        // Enforce fallback behavior when storage is not available
                        if (!store.get('discoverStoriesLoaded') && window.location.hash) {
                            self.loadStoriesFromHash();
                        };
                    }
                };
            },
            storeStories: function (jsonData) {
                var self = this;

                var stories = store.get('discoverStoriesLoaded');

                if (!stories) {
                    stories = new Array();
                };

                for (key in jsonData) {
                    if (typeof jsonData[key] !== null) {
                        stories.push(jsonData[key]);
                    };
                }

                store.set('discoverStoriesLoaded', stories);
            },
            popStories: function (targetStory) {
                var self = this;

                // remove null item from end
                var storyJSON = store.get('discoverStoriesLoaded');

                this.clearStories();

                if (typeof storyJSON == 'object') {
                    this.buildStories(storyJSON, null, function () {
                        self.goToStoryByHash(targetStory);
                    });
                } else {
                    this.loadStoriesFromHash(targetStory);
                };
            },
            clearStories: function () {
                var self = this;

                store.remove('discoverStoriesLoaded');
            },
            prevArrowAction: function (callback) {
                var self = this;

                this.numPrevPanel = this.numCurrPanel;

                this.elArrows.find('a').removeClass('disabled').removeAttr('style');

                if (this.numCurrPanel > 0) {
                    this.numCurrPanel--;
                    this.animateLeft = '+=' + this.numPanelWidth;
                    this.pageSlideAction(false, function () {
                        self.checkArrowState();
                        if (typeof callback == 'function') {
                            callback.call(this);
                        };
                    });
                } else {
                    if (typeof callback == 'function') {
                        callback.call(this);
                    };
                }
            },
            nextArrowAction: function (callback) {
                var self = this;

                this.numPrevPanel = this.numCurrPanel;

                this.elArrows.find('a').removeClass('disabled').removeAttr('style');

                if (this.numCurrPanel < this.numPanels - 1) {
                    this.numCurrPanel++;

                    if (this.numPanels - this.numCurrPanel == this.panelThreshold) {
                        this.loadStories();
                        //console.log('loading more stories...');
                    };

                    this.animateLeft = '-=' + this.numPanelWidth;

                    this.pageSlideAction(false, function () {
                        self.checkArrowState();
                        if (typeof callback == 'function') {
                            callback.call(this);
                        };
                    });
                } else {
                    if (typeof callback == 'function') {
                        callback.call(this);
                    };
                }
            },
            checkArrowState: function (arrow) {
                var self = this;
                if (this.numCurrPanel >= this.numPanels - 1 && self.numCurrPanel === 0) {
                    //console.log('both disabled');
                    this.elArrows.find('a').removeClass('disabled').removeAttr('style');
                    this.elArrows.find('a.next').addClass('disabled').fadeOut(250);
                    this.elArrows.find('a').removeClass('disabled').removeAttr('style');
                    this.elArrows.find('a.previous').addClass('disabled').fadeOut(250);
                } else if (this.numCurrPanel >= this.numPanels - 1) {
                    //console.log('next disabled');
                    this.elArrows.find('a').removeClass('disabled').removeAttr('style');
                    this.elArrows.find('a.next').addClass('disabled').fadeOut(250);
                } else if (self.numCurrPanel === 0) {
                    //console.log('prev disabled');
                    this.elArrows.find('a').removeClass('disabled').removeAttr('style');
                    this.elArrows.find('a.previous').addClass('disabled').fadeOut(250);
                } else {
                    //console.log('both enabled');
                    this.elArrows.find('a').removeClass('disabled').removeAttr('style');
                }
            },
            goToStoryByHash: function (targetStory) {
                var self = this;

                var realPanelsLength = this.elPanels.length - 1;

                if (!realPanelsLength) {
                    realPanelsLength = 0;
                };

                //console.log(realPanelsLength);

                if (realPanelsLength < targetStory) {
                    this.numCurrPanel = realPanelsLength;
                    window.location.hash = this.numCurrPanel;

                    this.storyEndId = this.numCurrPanel;

                    this.loadStories();

                } else {
                    this.numCurrPanel = targetStory;
                };

                var totalLeft = self.numPanelWidth * this.numCurrPanel;

                self.animateLeft = '-=' + totalLeft;
                self.pageSlideAction(false, function () {
                    self.checkArrowState();
                });
            },
            pageSlideAction: function (noFocus, callback) {
                var self = this;

                this.elStoryWrapper.animate({ 'left': this.animateLeft },
		                            this.numAnimTime,
		                            'easeOutQuart',
		                            function () {
		                                // focus on current tile if pagination anchor or arrow was clicked
		                                if (TARGET.Util.isMobile() === false && noFocus !== true) {
		                                    self.elPanels.eq(self.numCurrPanel).find('h3 a').focus();
		                                    //window.location.hash = self.numCurrPanel;
		                                    if (typeof callback == 'function') {
		                                        callback.call(this);
		                                    };
		                                }
		                            });
            },
            updateArrows: function () {
                var self = this;

                this.elArrows.filter('.previous').attr('title', 'Go to panel ' + (this.numCurrPanel + 1) + ' of ' + this.numPanels);
                this.elArrows.filter('.next').attr('title', 'Go to panel ' + (this.numPrevPanel + 1) + ' of ' + this.numPanels);
            },
			getCSSNumberFromPxValue: function(string){
				return parseInt(string.split('px')[0]);	
			}
        };
    };
    return {
        getInstance: function () {
            if (!_instance) {
                _instance = init();
            }
            return _instance;
        }
    };
})();
/*
Discover Tag Panel Controller
5/13/12
MS

DEPENDENCIES:
jQuery
	
PURPOSE:
Singleton that controls Discover tag panel
*/
if (TARGET === null || typeof (TARGET) !== "object") { var TARGET = new Object(); }

TARGET.TagPanelController = (function () {
    var _instance;

    function init() {
        return {
        
        	mobileTagNavSizeNums   :   {width:'100%', height:'350'},
                                 	
            /* tags will be appended by the CMS  */
            elTagWrapper: $('#tags'),
            elPanelTrigger: $('#tagTrigger'),
            elTagPanel: $('.tagList'),
            elAccessLabel: $('.accessLabel'),

            numColumns: 4,

            isOpen: false,
            supportsTransitions: $('.csstransitions').length,
            isMobile: false,

            kickoff: function () {
                var self = this;
                
                this.initialPanelWidth = this.elTagPanel.width();
                
                this.elTagPanelUl = this.elTagPanel.find('ul');
                this.elTagPanelUl.columnize({ 
					columns: this.numColumns,
					buildOnce: true
				});
                this.elTagPanelSpans = this.elTagPanel.find('span.bg');
                
                this.setSizeValues();
                
	            this.elTagPanel.addClass('hidden').css({ 'height': 0, 'width': this.numPanelHalfWidth });
                
                this.elPanelTrigger.bind('click', function (e) {
                    e.preventDefault();
                    
                    self.tagPanelAction(false, e);
                });
                $(document).click(function (e) {
                    // check if click target is descendant of primary nav...hide menu if it's not
                    if (self.elTagWrapper.has(e.target).length === 0) {
                        //console.log(self.elTagWrapper, e.target);                  
                        self.tagPanelAction(true);
                    }
                })
                .keydown(function (e) {
                    if (e.keyCode === 27) {
						self.tagPanelAction(true);
					}
                });
                $(window).resize(function(e){
                	self.setSizeValues();
                	
                	if(self.isOpen == true) self.closePanel();
                });
            },
            setSizeValues: function() {
	            this.isMobile = TARGET.Util.isMobile();
	            
                this.numPanelHeight = this.isMobile ? this.mobileTagNavSizeNums.height + 'px' : '427px';
                this.numPanelFullWidth = this.isMobile ? this.mobileTagNavSizeNums.width : this.initialPanelWidth;
                this.numPanelHalfWidth = this.isMobile ? this.mobileTagNavSizeNums.width : (this.numPanelFullWidth / 2) + 11 + 'px';
            },
            tagPanelAction: function (isExternallyTriggered, event) {
                var self = this;

                if (this.isOpen === false && isExternallyTriggered !== true) {
                	this.openPanel(event);
                }
                else if (this.isOpen === true) {
                    this.closePanel();
                }
            },
            openPanel: function(event){
            	var self = this;
            	
	            this.elTagWrapper.addClass('active');
                this.elAccessLabel.text('collapse tags:');
                
                var current = this.elTagPanel.find('.current');
                var currentTag = current.length ? current : this.elTagPanel.find('a').first();
                
                this.elTagPanel.removeClass('hidden')
                    .animate({ 'height': this.numPanelHeight })
                    .animate({ 'width': this.numPanelFullWidth },
                        function () {
                        	if(self.isMobile) {
	                            TARGET.Util.smoothScroll(event, false, self.elPanelTrigger);
                            }
                            currentTag.focus();                            	  
                            self.elTagPanelSpans.fadeIn(400);
                        }
                    );

                this.isOpen = true;
            },
            closePanel: function(){
            	var self = this;
            	
	            this.elAccessLabel.text('expand tags:');

                this.elTagPanelSpans.fadeOut(150);
                
                this.elTagPanel
                    .animate({ 'width': this.numPanelHalfWidth })
                    .animate({ 'height': '0px' },
                                function () {
                                    $(this).addClass('hidden');
                                    self.elPanelTrigger.focus();
                                }
                            );

                this.isOpen = false;
                var timeout = setTimeout(function(){
                    self.elTagWrapper.removeClass('active');
                },700);
            }
        };
    };
    return {
        getInstance: function () {
            if (!_instance) {
                _instance = init();
			}
            return _instance;
        }
    };
})();

/* GrantsRecipients.js */
/*
    GrantsRecipients Class
    7/21/12
    MS

    DEPENDENCIES:
    jQuery
    
    PURPOSE:
    Provides functionality for:
       - Grants Recipients List: Field Trip Grants, Early Childhood Reading, Arts, etc.
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = new Object(); }

TARGET.GrantsRecipients = function (target, options) {
    var self = this;

    // ------------------------------------------------------------
    // DEFAULTS
    // ------------------------------------------------------------
    this.options = {};

    if (typeof options == 'object') {
        $.extend(this.options, options);
    }

    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------ 
    this.stateListContainer = $('#state_list_container');
    this.stateListTrigger = this.stateListContainer.find('.showhide-trigger');
    this.stateList = $('#state_list');
    this.stateListItems = this.stateList.children();
    this.stateListAnchors = this.stateListItems.children('a');
    this.states = this.stateList.find('a');
    this.cityListContainer = $('#city_container');
    this.cityListTrigger = this.cityListContainer.find('.showhide-trigger');
    //this.cityListAnchors = this.cityListItems.children('a');
    this.cityList = $('#city_list');
    this.cityListItems = this.cityList.children();
    this.dataList;
    this.pagination = $('.pagination');
    this.resultsNavigationContainer = this.pagination.find('ul');
    this.resultsPrev = this.resultsNavigationContainer.find('.previous a');
    this.resultsNext = this.resultsNavigationContainer.find('.next a');
    this.resultsCount = this.resultsNavigationContainer.find('.count span');
    this.resultsContainer = $('#results_container');
    this.resultsList = this.resultsContainer.children('ul');

    // ------------------------------------------------------------
    // VARS
    // ------------------------------------------------------------ 

    // set up selector object for results gathering		
    this.resultsSelector = {
        state: '',
        city: ''
    };

    // ------------------------------------------------------------
    // INITIAL SETUP
    // ------------------------------------------------------------ 
    // set up results container for animation
    this.setupResultsContainer();

    // disable city list, subject list, and get ideas button
    this.disable(this.cityListTrigger);
    this.pagination.hide();

    this.resultsSet = false;

    this.selectedState;
    this.selectedCity;

    // ------------------------------------------------------------
    // EVENT HANDLERS
    // ------------------------------------------------------------ 
    $(this.stateList).delegate('a', 'click keydown', function (e) {
        if (e.type == 'click') {
            e.preventDefault();
            self.__changeStateDetector(e);
        }
        else if (e.type == 'keydown' && e.keyCode == 13) {
            self.__changeStateDetector(e);
        }
    })
    $(this.cityList).delegate('a', 'click keydown', function (e) {
        if (e.type == 'click') {
            e.preventDefault();
            self.__changeCityDetector(e);
        }
        else if (e.type == 'keydown' && e.keyCode == 13) {
            self.__changeCityDetector(e);
        }
    })

    this.disable(this.resultsPrev);
    this.disable(this.resultsNext);

    this.resultsPrev.bind('click', function (e) {
        self.previousResultsPage(e);
    });
    this.resultsNext.bind('click', function (e) {
        self.nextResultsPage(e);
    });
}
TARGET.GrantsRecipients.prototype = {
    disable: function (item) {
        if (item[0].tagName === 'A') {
            item.attr('tabIndex', '-1').addClass('inactive');
        }
        else if (item.tagName === 'LI') {
            item.children('a').attr('tabIndex', '-1').addClass('inactive');
        }
    },
    enable: function (item) {
        if (item[0].tagName === 'A') {
            item.attr('tabIndex', '0').removeClass('inactive');
        }
        else if (item[0].tagName === 'LI') {
            item.children('a').attr('tabIndex', '0').removeClass('inactive');
        }
    },
    addLoadingAnimation: function (item) {
        item.removeClass('inactive').addClass('loading');
    },
    removeLoadingAnimation: function (item) {
        item.removeClass('loading').addClass('enabled');
    },
    __resetCityList: function (e) {
        if (e === 0) {
            this.cityListItems.length = 0;
        }
        else {
            this.cityList.empty();
        }
        this.cityListTrigger.find('span.text').text('city');
        this.disable(this.cityListTrigger);
    },
    __changeStateDetector: function (e, isAuto) {

        if (e.target.text !== '') {

            var target = $(e.target);

            if (this.selectedState !== target.attr('rel')) {
                // clear previous results
                this.results = [];

                // reset city dropdown
                this.__resetCityList();
                this.resetPageCounter();

                if (this.resultsSet === true) {
                    this.removeResults();
                }

                // get state name and file path
                var stateName = target.attr('rel');
                var stateFile = target.attr('href');

                // update results selector
                this.resultsSelector.state = stateName;

                // get the state file
                this.getStateData(stateFile, isAuto);

                this.selectedState = stateName;

                this.stateListTrigger.find('span.text').text(target.text());
                this.stateList.hide();
            }
        }
    },
    __changeCityDetector: function (e) {
        if (e.target.value !== '') {
            var target = $(e.target);

            if (this.selectedCity !== target.attr('rel')) {
                // get clicked city and subjects
                var cityName = target.attr('rel');

                // update results selector
                this.resultsSelector.city = cityName;
                this.selectedCity = cityName;

                // update results array
                this.createResultsArray();

                if (this.resultsSet === true) {
                    this.removeResults();
                }

                this.insertResults();

                this.cityListTrigger.find('span.text').text(target.text());
                this.cityList.hide();
            }
        }
    },
    getStateData: function (stateFile) {
        var self = this;

        $.getJSON(stateFile, function (data) {

            self.dataList = data;

            self.populateCityList();
        });
    },
    populateCityList: function () {
        var self = this;
        // get all state cities	
        var cityListItem;

        $.each(this.dataList, function (key, val) {
            cityListItem = '<li><a href="#" rel="' + key + '">' + key + '</a></li>';
            self.cityList.append(cityListItem);
        });

        this.enable(this.cityListTrigger);
        this.cityListTrigger.focus();
    },
    setupResultsContainer: function () {
        this.resultsList.css({
            height: '0px',
            overflow: 'hidden'
        });
    },
    createResultsArray: function () {
        var self = this;

        this.results = this.dataList[this.selectedCity];

        this.resultStart = 0;

        if (this.results.length > 10) {
            this.resultEnd = 10;
        }
        else {
            this.resultEnd = this.results.length;
        }
    },
    insertResults: function () {

        this.resultsSet = true;

        // clear results container
        this.resultsList.html('');

        this.pagination.show();
        this.updatePageCounter();

        for (var i = this.resultStart; i < this.resultEnd; i++) {
            if (typeof (this.results[i]) !== 'undefined')
                $(this.resultsList).append('<li><h3>' + this.results[i] + '</h3></li>');
        };
        var resultsHeight = this.resultsList.children().length * 65;
        this.resultsList.animate({ 'height': resultsHeight + 'px' }, 1000, function () { $(this).focus(); });
    },
    nextResultsPage: function (e) {
        e.preventDefault();

        if (this.resultsNext.hasClass('inactive')) {
            return;
        }
        this.enable(this.resultsPrev);
        this.resultStart += 10;
        this.resultEnd += 10;
        this.insertResults();
        this.updatePageCounter();

        if (this.resultStart + 10 >= this.results.length) {
            this.disable(this.resultsNext);
        }
    },
    previousResultsPage: function (e) {
        e.preventDefault();

        if (this.resultsPrev.hasClass('inactive')) {
            return;
        }
        this.enable(this.resultsNext);
        this.resultStart -= 10;
        this.resultEnd -= 10;
        this.insertResults();
        this.updatePageCounter();

        if (this.resultEnd - 10 <= 0) {
            this.disable(this.resultsPrev);
        }
    },
    updatePageCounter: function () {
        var currentPage = (this.resultStart / 10) + 1;
        var pageCount = Math.ceil(this.results.length / 10);

        this.resultsCount.html(currentPage + ' of ' + pageCount);

        if (pageCount > 1) {
            this.enable(this.resultsNext);
        }
        else if (currentPage === (pageCount - 1)) {
            this.disable(this.resultsNext);
        }

        if (currentPage > 1) {
            this.enable(this.resultsPrev);
        }
        else {
            this.disable(this.resultsPrev);
        }
    },
    resetPageCounter: function () {
        this.resultsCount.html('1 of 1');
    },
    removeResults: function () {
        this.resultsList.html('');

        this.resultsSet = false;

        this.disable(this.resultsPrev);
        this.disable(this.resultsNext);
    }
};
/* CarouselPagination.js */
/*
    Carousel Pagination Class
    5/21/12
    MS

    DEPENDENCIES:
    jQuery
    
    PURPOSE:
    Reusable pagination class for image & homepage carousels
    
    TODO:
    
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = new Object(); }

TARGET.CarouselPagination = function(collection, target, options) {
    var self = this;

    // ------------------------------------------------------------
    // DEFAULTS
    // ------------------------------------------------------------
    this.options = {
        itemLabel : 'Image',
        offscreenClass : 'offscreen',
        accessLabel : 'Now showing '  
    };

    if(typeof options == 'object') {
        $.extend(this.options, options);
    }
    
    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------
    this.collectionToIterate = $(collection);
    this.elTargetWrapper = $(target);
    
    // ------------------------------------------------------------
    // VARS
    // ------------------------------------------------------------
    this.numItems = this.collectionToIterate.length;
    
    // ------------------------------------------------------------
    // INITIAL SETUP
    // ------------------------------------------------------------
    $.each(this.collectionToIterate, function(index, value){
        var humanIndex = index + 1;
        self.elTargetWrapper.append('<li><a href="#" title="'+self.options.itemLabel+' '+humanIndex+' of '+self.numItems+'"><span class="'+self.options.offscreenClass+'">'+self.options.itemLabel+' '+humanIndex+' of '+self.numItems+'</span></a></li>');
        
        if(index == self.numItems-1)
            self.elTargetWrapper.find('a').first().addClass('current').prepend($('<span class="accessLabel offscreen">'+self.options.accessLabel+' </span>'));
    });
}
TARGET.CarouselPagination.prototype = {    
    updatePagination: function(currItemNum){
        var elCurrent = this.elTargetWrapper.find('.current');  
             
        var elPaginationLabelTemp = elCurrent.find('span.accessLabel').detach();        
        elCurrent.removeClass('current').attr('href','#');
        
        this.elTargetWrapper.find('li')
        					.eq(currItemNum)
        					.find('a')
        					.addClass('current')
        					.removeAttr('href')
        					.prepend(elPaginationLabelTemp);
    }
}
/* ImageCarousel.js */
/*
    Image Carousel Class
    8/3/12
    MS / JF

    DEPENDENCIES:
    jQuery, TARGET.CarouselPagination
    
    PURPOSE:
    Provides functionality for multi-image carousel with captions
    
    TODO:
    Accessibility: focus on first image when stopping slideshow? 
    Test in IE
*/
if (TARGET === null || typeof(TARGET) !== "object") { var TARGET = new Object(); }

TARGET.ImageCarousel = function(options) {
    var self = this;

    // ------------------------------------------------------------
    // DEFAULTS
    // ------------------------------------------------------------
    this.options = {
        transition     :   'slide',
        autoPlay       :   true,
        numDelay       :   3500,
        numAnimTime    :   800,   
        numOffset      :   -310,
		customEventPrfx: 'TARGET:ImageCarousel'
    };

    if(typeof options == 'object') {
        $.extend(this.options, options);
    }
    
    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------
    
    this.elWrapper = $('.image-carousel');
	this.elFrame = this.elWrapper.find('.image-carousel-frame');
	this.elList = this.elWrapper.find('ul');
    this.elImagePanels = this.elWrapper.find('ul > li');
    this.elPaginationWrapper = this.elWrapper.find('.pagination ul');
    this.elPlayPauseBtn = this.elWrapper.find('.play-pause');
    
    // ------------------------------------------------------------
    // VARS
    // ------------------------------------------------------------
    this.numImages = this.elImagePanels.length;
    this.numCurrImage = 0;
    this.numPrevImage = null;
	this.isCaptionOpen = false;
	this._isInitialized = false;
    this.isAnimating = self.options.autoPlay;
    this.isSwipeAnimating = false;
    this.timeStart = undefined;
    
    this.accessLabelText = ['start image slideshow', 'pause image slideshow'];
    
    // ------------------------------------------------------------
    // INITIAL SETUP
    // ------------------------------------------------------------
    
	if (this.options.transition == "fade") {
		this.elImagePanels.attr('tabIndex','-1').not(':first').addClass('hidden').find('img').hide();
	}
	
    this.pagination = new TARGET.CarouselPagination(this.elImagePanels, this.elPaginationWrapper);
    
    if(this.options.autoPlay === true){
        // loop through once on page load
        this.startInterval(true);
    };

	// add a class to the wrapper so that we can apply transition specific css
	if (this.options.transition) {
		this.elWrapper.addClass(this.options.transition);
	};
	
	this._isInitialized = true;

	//$.event.trigger(this.options.customEventPrfx + ':isInitialized', [this.elContainer]);
	
	this.elFrame.append('<div class="image-carousel-desc-overlay"></div>');
	
	// change how we do the overlay for the slide transition
	// if (this.options.transition == 'slide') {
	// 	this.elWrapper.append('<div class="image-carousel-desc-overlay"></div>');
	// };
    
    // ------------------------------------------------------------
    // EVENT HANDLERS
    // ------------------------------------------------------------    
    this.elPaginationWrapper.find('a').bind('click', function(e){
        e.preventDefault();
        
        var index = $(e.currentTarget).parent().index();
        
        if(self.isAnimating === true) {
            self.killInterval();
        }
        if(self.numCurrImage !== index) {
			self.paginationClickAction(index);
		}
    });
    
    this.elPlayPauseBtn.bind('click', function(e){
        e.preventDefault();
        e.stopPropagation();

        if(self.paused === true) {
			self.isAnimating = true;
            self.slideshowAction(false);
            // slideshow starts again after delay. is this ok?
            self.startInterval(false);
        } else {
            self.killInterval();
        }
    }); 

	if (TARGET.Util.isMobile()) {
		jQuery('.image-carousel .pagination a.info').bind('click', function(e){
			e.preventDefault();
			
			if (self.elWrapper.hasClass('caption-open')) {
				self.elWrapper.removeClass('caption-open');
				self.elWrapper.find('.image-carousel-tiles p').stop().removeAttr('style');
				self.isCaptionOpen = false;
			} else {
				self.elWrapper.addClass('caption-open');
				self.elWrapper.find('.image-carousel-tiles p').stop().removeAttr('style');
				self.isCaptionOpen = true;
			};
		});
	};

	/*self.isSwipeAnimating = false;
	new TARGET.Swipe(this.elWrapper, {
		threshold: 100, // swipe threshold (ms)
		useOn: true,
		killVertical: false,
		onSwipeLeft: function(e, distance) {
			e.preventDefault();
			self.isAnimating = false;
			self.killInterval();
			
			if (self.isSwipeAnimating === false) {
				self.isSwipeAnimating = true;
				self.paginationClickAction(self.getNextIndex(), function(){
					self.isSwipeAnimating = false;
				});
			};
		},
		onSwipeRight: function(e, distance) {
			e.preventDefault();
			self.isAnimating = false;
			self.killInterval();
			
			if (self.isSwipeAnimating === false) {
				self.isSwipeAnimating = true;
				self.paginationClickAction(self.getPrevIndex(), function(){
					self.isSwipeAnimating = false;
				});
			};
		}
	});*/
	this.elWrapper.bind('TARGET:Swipe:onSwipeLeft', function(e) {
		self.isAnimating = false;
		
		if (!self.isSwipeAnimating) {
			//self.__clickNavNext();
			self.paginationClickAction(self.getNextIndex(), function(){
    			self.isSwipeAnimating = false;
			});
		}
	});

	this.elWrapper.bind('TARGET:Swipe:onSwipeRight', function(e) {
		self.isAnimating = false;
		
		if (!self.isSwipeAnimating) {
			//self.__clickNavPrev();
			self.paginationClickAction(self.getPrevIndex(), function(){
    			self.isSwipeAnimating = false;
			});
		}
	});

	if (TARGET.Config.hasTouch) {
		//uses jquery.touchSwipe.min.js plugin
		this.elWrapper.swipe({
			swipeLeft:function(event, distance, duration, fingerCount) {
    			self.killInterval();
    			self.isAnimating = false;
    			
				if (!self.isSwipeAnimating) {
					//self.__clickNavNext();
					self.paginationClickAction(self.getNextIndex(), function(){
    					self.isSwipeAnimating = false;
					});
				}
			},
			swipeRight:function(event, distance, duration, fingerCount) {
    			self.killInterval();
    			self.isAnimating = false;
    			
				if (!self._isAnimating) {
					//self.__clickNavPrev();
					self.paginationClickAction(self.getPrevIndex(), function(){
    					self.isSwipeAnimating = false;
					});
				}
			},
			fingers:$.fn.swipe.fingers.ALL 
		});
	}
};

TARGET.ImageCarousel.prototype = {    
    startInterval: function(loopOnce){
        var self = this,
        text = this.accessLabelText[1];

        self.isAnimating = true;
		self.paused = false;
        this.elPlayPauseBtn.addClass('paused').attr('title',text).children('.accessLabel').text(text);     
           
        this.interval = window.setInterval(function() { 
            self.slideshowAction(loopOnce);
        },
        this.options.numDelay);
    },
    killInterval: function(){
		var self = this;
        var text = this.accessLabelText[0];
        this.elPlayPauseBtn.removeClass('paused').attr('title',text).children('.accessLabel').text(text);  
  
        self.paused = true;
        this.isAnimating = false;
        window.clearInterval(this.interval); 
    },
	getPrevIndex: function(){
		if(this.numCurrImage !== 0){
            return this.numCurrImage-1;
        } else {
            return this.numImages-1;             
        }
	},
	getNextIndex: function(){
        if(this.numCurrImage < this.numImages-1){
            return this.numCurrImage+1;
        } else {
            return 0;             
        }
	},
    paginationClickAction: function(targetIndex, callback){
        this.numPrevImage = this.numCurrImage;
        this.numCurrImage = targetIndex;

        this.animateImages(false, callback);
        this.pagination.updatePagination(this.numCurrImage);
    },
    slideshowAction: function(loopOnce, callback){
        this.numPrevImage = this.numCurrImage;
        
        if(this.numCurrImage < this.numImages-1){
            this.numCurrImage++;
        } else {
            this.numCurrImage = 0;
            
            if(loopOnce == 1){
                this.killInterval();      
            }                
        }
        this.pagination.updatePagination(this.numCurrImage);
        this.animateImages(true, callback);
    },
    animateImages: function(isAuto, callback){
		var self = this;
		
		// Get previous and current panels for this iteration
		var prevImagePanel = this.elImagePanels.eq(this.numPrevImage);
		var currImagePanel = this.elImagePanels.eq(this.numCurrImage);
		
		var currPosition = currImagePanel.position();
		
		// Default to slide if no transition is set (uber-fallback)
		if (!self.options.transition) {
			self.options.transition == 'slide';
		};
	
		// Slide transition
		if (self.options.transition == 'slide') {
			// slide setup for iteration
			self.numAnimTime = 800;
			this.elWrapper.css('overflow', 'hidden');
			this.elWrapper.find('.pagination').css('z-index', '100');
			
			// actual animation
			currImagePanel.find('p').css('display', 'none').css('position', 'absolute').css('z-index', '2');
			if (!TARGET.Util.isMobile() || self.isCaptionOpen) {
				prevImagePanel.find('p').fadeOut(self.numAnimTime);
			}
			this.elList.animate({ 'left': '-'+currPosition.left+'px' }, 
				                     						self.numAnimTime, 
				                     						'easeOutQuart', function(){
					if (!TARGET.Util.isMobile() || self.isCaptionOpen) {
						currImagePanel.find('p').fadeIn(self.numAnimTime);
					};
					if (typeof callback == "function") {
						callback.call(this);
					};
				});
			
		// Fade transition	
		// This doesn't currently work
		} else if (self.options.transition == 'fade') {
			prevImagePanel.find('img').fadeOut(this.numAnimTime).parent().addClass('hidden');
			currImagePanel.removeClass('hidden').find('img').fadeIn(this.numAnimTime);
			if (typeof callback == "function") {
				callback.call(this);
			};
		};
        
		// If we are done auto-iterating, put focus on the curent tile
        if(isAuto === false){
            currImagePanel.focus();
        }
    },
    pageSlideAction: function(){     
        var elCurrentImage = this.elImagePanels.filter(":visible");
        elCurrentImage.animate({'top' : this.numMarginOut }, 
                                this.numAnimTime, 
                                'easeInQuart',
                                function(){ 
                                    $(this).addClass('inactive').css('top',''); 
                              });
        
        this.elImagePanels.eq(this.numCurrImage - 1)
                     .css({'top':this.numMarginIn}).removeClass('inactive')
                     .delay(400).animate({ 'top': '0px' }, this.numAnimTime, 'easeOutQuart');
    }
};

/* HomepageCarousel.js */
/*
	Homepage Carousel Class
	5/21/12
	MS

	DEPENDENCIES:
	jQuery, TARGET.CarouselPagination
	
	PURPOSE:
	Provides functionality for homepage content carousel
	
	TODO:
	Accessibility: add title attribute support to arrows
	Test in IE
*/
if (TARGET === null || typeof(TARGET) !== "object") { var TARGET = new Object(); }

TARGET.HomepageCarousel = function(options) {
	var self = this;

	// ------------------------------------------------------------
	// DEFAULTS
	// ------------------------------------------------------------
	this.options = {
        autoPlay        :   true,
        numDelay        :   3000,
        numAnimTime     :   400,
        numOffset       :   -600,
        numImgHeight    :   273
	};

	if(typeof options == 'object') {
		$.extend(this.options, options);
	}
	
	// ------------------------------------------------------------
	// ELEMENT REFERENCES
	// ------------------------------------------------------------
	
	this.elWrapper = $('.homepage-carousel');
	this.elHeadlines = this.elWrapper.find('.block-title');
	this.elBodyTexts = this.elWrapper.find('.article-body');
	this.elArrows =	 this.elWrapper.find('nav.arrows');
	this.elPanels = this.elWrapper.find('article');
	this.elPaginationWrapper = this.elWrapper.find('.pagination ul');	
	this.elPlayPauseBtn = this.elWrapper.find('.play-pause');	   
	
	// ------------------------------------------------------------
	// VARS
	// ------------------------------------------------------------
	this.numPanels = this.elPanels.length;
	this.numCurrPanel = 0;
	this.numPrevPanel = null;
	
	this.numOffsetNegative = this.options.numOffset;
	this.numOffset = Math.abs(this.options.numOffset);
	
    this.pagination = new TARGET.CarouselPagination(this.elPanels, this.elPaginationWrapper, { itemLabel:'Panel' });
	
	this.elPanels.attr('tabIndex','-1');
	
	this.isAnimating = false;
    this.timeStart = undefined;
    
    this.accessLabelText = ['start image slideshow', 'pause image slideshow'];
	
	// ------------------------------------------------------------
	// INITIAL SETUP
	// ------------------------------------------------------------
	
	if(this.options.autoPlay === true && TARGET.Util.isMobile() == false){
        // loop through once on page load
        this.startInterval(true);
    };

	// ------------------------------------------------------------
	// EVENT HANDLERS
	// ------------------------------------------------------------  
		   
	this.elArrows.find('a').bind('click',function(e){
		e.preventDefault();
		e.stopPropagation();
		
		var _target = $(e.currentTarget);
		
		if(self.isAnimating === false){
			self.isAnimating = true;
		
			if(self.options.autoPlay === true) {
				self.killInterval();
			}
			
			// check which arrow was clicked and do stuff accordingly
			if(_target.hasClass('next')) {
				self.nextArrowAction(function(){
					self.setIsAnimating();
				});	
			} else if(_target.hasClass('previous')) {
				self.prevArrowAction(function(){
					self.setIsAnimating();
				});
			}
		}
	});
	
	this.elPaginationWrapper.find('a').bind('click', function(e){
        e.preventDefault();
        
        var index = $(this).parent().index();
	        
		if(self.isAnimating === false && self.numCurrPanel !== index){
	        self.numPrevPanel = self.numCurrPanel;

			if(self.options.autoPlay === true) {
				self.killInterval();
			}
		
			self.paginationClickAction(index);   
		}
    });
    
	this.elPlayPauseBtn.bind('click', function(e){
        e.preventDefault();
        
		if(self.options.autoPlay === false){
			if (self.isAnimating === false) {
            	self.slideshowAction(false);
			};
            // slideshow starts again after delay
            self.startInterval(false);
        } else {
            self.killInterval();
        }
		
    });

	if (jQuery('body').hasClass('mobile')) {
		var swipeThreshold = 250;
		var killVertical = false;
	} else {
		var swipeThreshold = 100;
		var killVertical = true;
	};
	
	this.elWrapper.bind('TARGET:Swipe:onSwipeLeft', function(e) {
		self.isAnimating = false;
		
		if (!self.isSwipeAnimating) {
			//self.__clickNavNext();
			self.nextArrowAction(function(){
    			self.isSwipeAnimating = false;
			});
		}
	});

	this.elWrapper.bind('TARGET:Swipe:onSwipeRight', function(e) {
		self.isAnimating = false;
		
		if (!self.isSwipeAnimating) {
			//self.__clickNavPrev();
			self.prevArrowAction(function(){
    			self.isSwipeAnimating = false;
			});
		}
	});

	if (TARGET.Config.hasTouch) {	    
		//uses jquery.touchSwipe.min.js plugin
		this.elWrapper.swipe({
			swipeLeft:function(event, distance, duration, fingerCount) {
			    
    			self.killInterval();
    			self.isAnimating = false;
    			
				if (!self.isSwipeAnimating) {
					self.nextArrowAction(function(){
    					self.isSwipeAnimating = false;
					});
				}
			},
			swipeRight:function(event, distance, duration, fingerCount) {
    			self.killInterval();
    			self.isAnimating = false;
    			
				if (!self._isAnimating) {
					self.prevArrowAction(function(){
    					self.isSwipeAnimating = false;
					});
				}
			},
			fingers:$.fn.swipe.fingers.ALL 
		});
	}

	
	// show appropriate arrow when hovering over pagination anchor
	if (Modernizr.csstransitions) {
		this.elPaginationWrapper.find('a').hover(function(e){
			var index = $(this).parent().index();
			if(TARGET.Util.isMobile() === false){
				if(self.numCurrPanel > index) {
					self.elArrows.find('.previous span.visible-btn').css('background-color', '#505050');
				} else if (self.numCurrPanel < index) {
					self.elArrows.find('.next span.visible-btn').css('background-color', '#505050');
				}	
			}
		}, function(e){
	        self.elArrows.find('a span.visible-btn').removeAttr('style');
	    });
	};
    
    // make images clickable since swipe plugin has trouble with anchors wrapping images
    this.elWrapper.find('img').on('click', function(e){
        e.preventDefault();
        
        var link = $(this).parent().parent().find('a').eq(0);
        window.location = link.attr('href');
    });
	this.elHeadlines.parent().not(':first').addClass('inactive');
	
	$('.gallery-items').removeClass('invisible');
	
};
TARGET.HomepageCarousel.prototype = {
	startInterval: function(loopOnce){
        var self = this,
        text = this.accessLabelText[1];
        
        this.elPlayPauseBtn.addClass('paused').attr('title',text).children('.accessLabel').text(text);     
           
        this.interval = window.setInterval(function() { 
        
            self.isAnimating = true;
            
            self.slideshowAction(loopOnce);
        },
        this.options.numDelay);
    },
    killInterval: function(){
        var text = this.accessLabelText[0];
        this.elPlayPauseBtn.removeClass('paused').attr('title',text).children('.accessLabel').text(text);    
                   
        this.isAnimating = false;
        window.clearInterval(this.interval); 
    },
    setIsAnimating: function(){
	  	this.isAnimating = false;  
    },
	prevArrowAction: function(callback){	
        this.numPrevPanel = this.numCurrPanel;
        	 
		if(this.numCurrPanel > 0) {
			this.numCurrPanel--;
		} else {
			this.numCurrPanel = this.numPanels-1;
		}
		
		this.pagination.updatePagination(this.numCurrPanel);
		
        this.numMarginOut = this.numOffset;
        this.numMarginIn = this.numOffsetNegative;	
        
		this.pageSlideAction(false, false, callback);
	},
	nextArrowAction: function(callback){
        this.numPrevPanel = this.numCurrPanel;
        		   
		if(this.numCurrPanel < this.numPanels-1) {
			this.numCurrPanel++;
		} else {
			this.numCurrPanel = 0;
		}
			
		this.pagination.updatePagination(this.numCurrPanel);
		
        this.numMarginOut = this.numOffsetNegative;
        this.numMarginIn = this.numOffset;		
        		
		this.pageSlideAction(false, false, callback);
	},
    paginationClickAction: function(index){
		var self = this;
        this.numPrevPanel = this.numCurrPanel;
        
        this.numCurrPanel = index;
        
        if(this.numCurrPanel > this.numPrevPanel){
            this.numMarginOut = this.numOffsetNegative;
            this.numMarginIn = this.numOffset;		
        }
        else {
            this.numMarginOut = this.numOffset;
            this.numMarginIn = this.numOffsetNegative;	
        }        	
        this.pageSlideAction(false, false, function(){
			self.setIsAnimating();
		});
        this.pagination.updatePagination(this.numCurrPanel);
    },
	slideshowAction: function(loopOnce){
		var self = this;
        this.numPrevPanel = this.numCurrPanel;
        
        if(this.numCurrPanel < this.numPanels-1){
            this.numCurrPanel++;
        } else {
            this.numCurrPanel = 0;
            
            if(loopOnce == 1){
                this.killInterval();      
            }                
        }

		if(this.numCurrPanel > this.numPrevPanel){
            this.numMarginOut = this.numOffsetNegative;
            this.numMarginIn = this.numOffset;		
        }
        else {
            this.numMarginOut = this.numOffset;
            this.numMarginIn = this.numOffsetNegative;	
        }

        this.pagination.updatePagination(this.numCurrPanel);
        this.pageSlideAction(true, true, function(){
			self.setIsAnimating();
		});
		this.pagination.updatePagination(this.numCurrPanel);
    },
	pageSlideAction: function(isAuto, noFocus, callback){
        var self = this;
        
        var elPrevPage = this.elPanels.filter(":visible"),
        elNewPage = this.elPanels.eq(this.numCurrPanel);
		
		this.isAnimating = true;
		
        elPrevPage.animate({'top' : this.numMarginOut }, 
                            this.numAnimTime, 
                            'easeInQuart',
                            function(){ 
                                 $(this).addClass('inactive').css('top','');               
                            });
                         
        elNewPage.css({'top':this.numMarginIn}).removeClass('inactive')
                     .delay(400).animate({ 'top': '0px' }, 
                     						this.numAnimTime, 
                     						'easeOutQuart', 
                     						function(){ 
												// focus on current tile if pagination anchor or arrow was clicked
                     							if(TARGET.Util.isMobile() === false && noFocus !== true) {
	                     							self.elPanels.eq(self.numCurrPanel).focus(); 
												}
												if (typeof callback === "function") {
													callback.call(this);
												};
                     						});
	},
	updateArrows: function(){
	   this.elArrows.filter('.previous').attr('title','Go to panel '+(this.numCurrPanel+1)+' of '+this.numPanels);
	   
	   this.elArrows.filter('.next').attr('title','Go to panel '+(this.numPrevPanel+1)+' of '+this.numPanels);
	}
};
/* ShowHideWidget.js */
/*
ShowHideWidget Class
4/26/12
MS

DEPENDENCIES:
jQuery
    
PURPOSE:
Provides functionality for:
- Accordions 
- Single-panel drop-down lists
    
TODO:
* Test all in IE
* Accordion: Make sure there are no bugs with expand/close all
* Single-panel: Fix bug for tabbing off--fails when you tab backwards
    
*/
if (TARGET == null || typeof (TARGET) != "object") { var TARGET = new Object(); }

TARGET.ShowHideWidget = function (target, options) {
    var self = this;

    // ------------------------------------------------------------
    // DEFAULTS
    // ------------------------------------------------------------
    this.options = {};

    if (typeof options == 'object') {
        $.extend(this.options, options);
    }

    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------ 
    this.elWrapper = target;
    this.elTriggers = this.elWrapper.find('.showhide-trigger');
    this.elTargets = this.elWrapper.children('.showhide-content');
    this.elTargetLinks = this.elTargets.find('a');
    this.elTriggerAll = this.elWrapper.find('.showhide-trigger-all');

    this.elTriggerSpans = $('span.accessLabel');
    this.elTriggerArrows = $('span.arrow');

    this.elToFocus;

    // ------------------------------------------------------------
    // INITIAL SETUP
    // ------------------------------------------------------------ 
    this.isAccordion = this.elWrapper.hasClass('accordion') ? true : false;

    if (this.isAccordion) {
        // vertically align arrows
        this.elTriggerArrows.each(function () {
            var posTop = ($(this).parent().parent().height() - $(this).height()) / 2;
            $(this).css('top', posTop);
        });
    }

    this.keyboardAutocompleteReset();
    // ------------------------------------------------------------
    // EVENT HANDLERS
    // ------------------------------------------------------------  
    this.elWrapper.on('keydown', '.showhide-content a', function (e) {
        if (e.which == '38') {
            // arrow up
            e.preventDefault();
            $(this).parent().prev().find('a').focus();
        } else if (e.which == '40') {
            // arrow down
            e.preventDefault();
            $(this).parent().next().find('a').focus();
        } else if (e.which == '9') {
            e.preventDefault();
            self.elTriggers.trigger('click').focus();
        } else if (self.keyboardBypass(e.which)) {

        } else {
            if (self.autocompleteTimeout !== null) {
                clearTimeout(self.autocompleteTimeout);
                self.autocompleteTimeout = null;
            }
            self.autocompleteTimeout = setTimeout(function () {
                self.keyboardAutocompleteReset();
            }, 1000);
            self.keyboardAutocomplete(e);
        }
    });

    this.elTriggers.bind('click keydown', function (e) {
        if (e.type == 'click' || e.which == '40') {
            e.preventDefault();

            if (self.isAccordion) {
                self.elToFocus = $(this).parent().next().children().first();
                self.elToFocus.attr('tabIndex', '-1');
            } else {
                self.elToFocus = $(this).parent().next().find('a:first');
            }

            if ($(this).hasClass('active')) {
                self.closePanel($(this));
            } else {
                self.openPanel($(this));
            }
        }
    });

    if (this.isAccordion == false) {
        // close single-panel when clicking elsewhere on page
        $(document).bind('click', function (e) {
            if (self.elWrapper.has(e.target).length == 0)
                self.closePanel(self.elWrapper.find(self.elTriggers));
        });
        this.elTargets.find('a:last').bind('blur', function () {
            self.closePanel(self.elWrapper.find(self.elTriggers));
        });
    }
    else {
        this.elTriggers.first().addClass('active');
        this.arrOpenAccordionItems = [$('.accordion').find('.active').attr('href')];

        this.elTargets.filter(':not(:first)').hide();

        this.elTriggerAll.bind('click', function (e) {
            e.preventDefault();
            self.triggerAllAction($(this));
        });
    }
};
TARGET.ShowHideWidget.prototype = {
    openPanel: function (elTrigger) {

        elTrigger.addClass('active');
        elTrigger.find(this.elTriggerSpans).text(': minimize panel');

        elTrigger.parent().next().addClass('active').css({ 'display': 'block', 'visibility': 'visible' }).find(this.elToFocus).focus();

        if (this.isAccordion) {
            if (this.elTargets.filter(':not(.active)').length == 0) {
                this.updateElTriggerAll('collapse');
            }
        }
    },
    closePanel: function (elTrigger) {
        elTrigger.removeClass('active');
        elTrigger.find(this.elTriggerSpans).text(': expand panel');

        elTrigger.parent().next().removeClass('active').css({ 'display': 'none', 'visibility': 'hidden' });

        if (this.isAccordion) {
            if (this.elTargets.filter('.active').length == 0) {
                this.updateElTriggerAll('expand');
            }
        }
    },
    triggerAllAction: function (elTrigger) {
        var self = this;
        if (elTrigger.hasClass('expand')) {
            this.elTriggers.each(function () {
                self.openPanel($(this));
            });
        }
        else {
            this.elTriggers.each(function () {
                self.closePanel($(this));
            });
        }
    },
    updateElTriggerAll: function (label) {
        var updatedText = label + ' all';

        this.elTriggerAll.text(updatedText)
                         .attr('title', updatedText + ' panels')
                         .toggleClass('expand');
    },
    _keyboardBypassKeys: {
        8: 1,  // backspace
        13: 1, // enter
        16: 1, // shift
        17: 1, // ctl
        18: 1, // alt
        27: 1, // esc
        33: 1, // page up
        34: 1, // page down
        35: 1, // end
        36: 1, // home
        37: 1, // arrow left
        39: 1, // arrow right
        45: 1, // insert
        46: 1, // delete
        91: 1  // windows key
    },
    keyboardBypass: function (keycode) {
        if (keycode in this._keyboardBypassKeys) {
            return true;
        } else {
            return false;
        }
    },
    keyboardAutocomplete: function (e) {
        var self = this;
        this._keyBuffer.push(String.fromCharCode(e.which));
        var keyBufferString = this._keyBuffer.join('').toString();
        var results = this.findElementByStrMatch(keyBufferString, this.elWrapper.find('.showhide-content a'));
        jQuery(results).eq(0).focus();
    },
    findElementByStrMatch: function (str, collection) {
        var matches = [];
        for (var n = 0; n < collection.length; n++) {
            var element = jQuery(collection[n]);
            var elementStr = element.text().toUpperCase();
            if (str === elementStr.substr(0, str.length)) {
                matches.push(collection[n]);
            }
        }
        return matches;
    },
    keyboardAutocompleteReset: function () {
        this._keyBuffer = new Array();
        this._isAutocompleting = false;
        clearTimeout(this.autocompleteTimeout);
        this.autocompleteTimeout = null;
    }
};
/* AjaxShowHideWidget.js */
/*
AjaxShowHideWidget Class
sub-class of ShowHideWidget
7/6/12
JF

DEPENDENCIES:
jQuery, ShowHideWidget
    
PURPOSE:
Provides functionality for:
- Add ajax functionality to ShowHideWidget
    
TODO:
-
    
*/
if (TARGET == null || typeof (TARGET) != "object") { var TARGET = new Object(); }

TARGET.AjaxShowHideWidget = function (target, options) {
    var self = this;

    // Parent constructor    
    TARGET.ShowHideWidget.call(this, target, options);

    // ------------------------------------------------------------
    // PROPERTIES
    // ------------------------------------------------------------
    this.defaultSelectTextNode = this.elTriggers.contents().eq(0);
    this.defaultSelectText = this.defaultSelectTextNode.text();

    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------
    this.elLinks = this.elTargets.find('a');
    this.eventPicker = $('.event-picker');
    this.eventPickerHeadline = this.eventPicker.find('h3');

    // ------------------------------------------------------------
    // INITIAL SETUP
    // ------------------------------------------------------------
    this.defaultSelectTextNode.wrap('<span class="showhide-active-text" />');
    this.activeTextElement = this.elTriggers.find('.showhide-active-text');
    this.isEventPicker = this.eventPicker.length == 0 ? false : true;

    this.responseWrapperTemplate = $('<div class="ajax-showhide-response-wrapper"></div>');
    if (this.isEventPicker == false) {
        this.elWrapper.after(this.responseWrapperTemplate);
        this.responseWrapper = $('.ajax-showhide-response-wrapper');
        this.responseWrapper.hide();
    }
    else {
        this.responseWrapper = $('#event-content');
    }
    // ------------------------------------------------------------
    // EVENT HANDLERS
    // ------------------------------------------------------------
    this.elLinks.bind('click', function (e) {
        e.preventDefault();

        var selectedLink = $(this),
		activeText = selectedLink.text();

        self.activeTextElement.text(activeText);
        if (self.isEventPicker) {
            self.responseWrapper.empty();
        }
        else {
            self.responseWrapper.empty().hide();
        }
        self.getData(selectedLink);
        self.closePanel(self.elTriggers);

        // any cleanup needed
    });
};
TARGET.AjaxShowHideWidget.prototype = Object.create(TARGET.ShowHideWidget.prototype);

TARGET.AjaxShowHideWidget.prototype.getData = function (selectedLink) {
    var self = this,
	endpoint = selectedLink.attr('href'),
	ajaxSettings = {
	    url: endpoint,
	    success: function (data, textStatus, jqXHR) {
	        // if we got back data, inject it into the response container
	        if (data !== "") {
	            self.injectResponse(TARGET.Util.parseJSON(data));
	        };
	    }
	};
    $.ajax(ajaxSettings);
};

TARGET.AjaxShowHideWidget.prototype.injectResponse = function (data) {
    var self = this,
		linkList = $('<ul class="linklist no-bullets"></ul>');

    //this.elLinkAllItems.show();
    this.eventPickerHeadline.hide();

    if (this.isEventPicker) {
        $.each(data, function (index, responseItem) {
            self.responseWrapper.append('<li><h4>' + responseItem.Title + '</h4><div class="event-info"><div><img src="' + responseItem.Image + '" alt="" /><h5>' + responseItem.Heading + '</h5><p>' + responseItem.BodyText + '</p><p class="link"><a href="' + responseItem.Link + '" title="Link opens in a new window" target="_blank">' + responseItem.LinkText + '<span class="offscreen"> opens in a new window.</span></a></p></div><p class="price">' + responseItem.Price + '</p></div><div class="clear"></div></li>');
        });
    }
    else {
        $.each(data, function (index, responseItem) {
            linkList.append('<li><a href="' + responseItem.Alias + '">' + responseItem.Name + '</a></li>');
        });

        self.responseWrapper.append(linkList);
    }
    self.showList();
};

TARGET.AjaxShowHideWidget.prototype.showList = function () {
    var self = this;

    // animate and show the response container
    self.responseWrapper.slideDown(1000, 'easeOutQuad', function () {
        self.responseWrapper.focus();
    });
};

/* Tiles.js */
/*
    Tile Controller
    5/23/12
    MS

    DEPENDENCIES:
    jQuery, TARGET.Tile
    
    PURPOSE:
    Singleton that controls tiles as a group
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = new Object(); }

TARGET.TileController = (function(){
    var _instance;
    
    function init(){
        return {
            /* these will be created by the CMS. 
            so we can hard code the wrapper */
            tiles: $('.tile'),
            pinned: false,
            activeTile: null,
            supportsTransitions: Modernizr.csstransitions,
            
            kickoff: function(){
                var self = this;
                
                // sorting array so tiles can animate in at random on homepage
                var randomTiles = this.tiles.get();
                randomTiles.sort(function(){
                    return Math.random()*10 > 5 ? 1 : -1;
                });
                
                $.each(randomTiles, function(i,el){
                    var _this = $(el);
                    new TARGET.Tile(_this);
                    
                    if(TARGET.Util.isMobile() == false && $('body').hasClass('home')){ 
                        var tileMask = _this.children('.mask');
                        // hide tiles on desktop so they can animate in on page load
                        tileMask.css({ 'top':'-138px'});  
                                              
                        self.animateIn(tileMask,i);
                    }
                });

                $(document).on('mousedown keydown', function(event){
                	// clicking document deactivates tile
					if(event.type == 'mousedown') {						
						if (self.activeTile !== null && self.activeTile.length > 0 && self.tiles.find(event.target).length == 0) {
								self.activeTile.removeClass('active').find('a').attr('tabIndex','-1');
								self.activeTile = null;
								self.pinned = false;
						};
					}
                });
                
            },
            animateIn: function(tileMask, index){
                window.setTimeout(function(){
                    tileMask.delay(100 * (index + 1)).animate({'height':'138px','top':0 }, 300, 'easeOutQuad');
                });
            }
        };
    };
    return {
        getInstance: function(){
            if(!_instance)
                _instance = init();
            return _instance;
        }
    };
})();


/*
    Tile Class
    5/23/12
    MS

    DEPENDENCIES:
    jQuery, TARGET.TileController
    
    PURPOSE:
    Individual tile UI functionality & CSS3 Fallback
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = {}; }

TARGET.Tile = function(target,options) {
    var self = this;

    // ------------------------------------------------------------
    // DEFAULTS
    // ------------------------------------------------------------
    this.options = {};

    if(typeof options == 'object') {
        $.extend(this.options, options);
    }
    // ------------------------------------------------------------
    // ELEMENT REFERENCES
    // ------------------------------------------------------------
    this.target = target;    
    this.tileInner = this.target.find('.tile-inner');
    this.front = this.target.find('.front-inner'); 
    this.frontAccessLabel = this.front.find('.accessLabel');  
    this.back = this.target.find('.back'); 
    this.backInner = this.back.find('.back-inner');
    this.backGoLink = this.back.find('a:not(.accessLabel)');
    this.backAccessLabel = this.back.find('.accessLabel');
    
    // ------------------------------------------------------------
    // VARS
    // ------------------------------------------------------------
    this.tileController = TARGET.TileController.getInstance();
    
    // ------------------------------------------------------------
    // INITIAL SETUP
    // ------------------------------------------------------------
    this.init();

    // ------------------------------------------------------------
    // EVENT HANDLERS
    // ------------------------------------------------------------
    this.target.on('mouseenter mouseleave mousedown keydown',function(event){   
	    	
        self.interactionEvents(event);
    });
    // Screen reader controls
    this.frontAccessLabel.on('click',function(e){
    	e.preventDefault();
    	
    	self.target.addClass('active');
    	
    	self.showTileArea(self.backInner);
    	self.backInner.find('h4').focus();
    	self.hideTileArea(self.front);
    });
    this.backAccessLabel.on('click',function(e){
    	e.preventDefault();
    	
    	if(self.target.hasClass('active'))
	    	self.target.removeClass('active');
	    	
    	self.showTileArea(self.front);
    	self.front.find('h3').focus();
    	
    	self.hideTileArea(self.backInner);  
    });
};

TARGET.Tile.prototype = {
    
    init: function(){
        // hiding back panel with class="hidden" on a delay caused too many bugs…
        // instead taking 'go' links out of tabIndex when tile is hidden
        this.target.find('a').attr('tabIndex','-1');
        this.hideTileArea(this.backInner);
    },
    interactionEvents: function(event){
        var self = this,
        	target = $(event.currentTarget);       
    	
    	if(event.target.tagName == 'SPAN'){event.stopPropagation();}
        // no hover/focus on mobile   
        if(TARGET.Util.isMobile() == false){
            if(event.type == 'mouseenter'){
                
                target.find('a:not(.accessLabel)').attr('tabIndex',0);
                
                (this.tileController.supportsTransitions == 1) ?
                    target.addClass('active')
                    : this.mouseoverFocusShim();
                         
                clearTimeout(this.tileBackMouseLeaveTimeout);
                this.showTileArea(this.backInner); 
                
                this.tileFrontMouseEnterTimeout = window.setTimeout(function(){
	                self.hideTileArea(self.front);
                },200);               
            }
            if(event.type == 'mouseleave'){
 
                // if this tile is not pinned, hide it.                                        
                if(!target.is(this.tileController.activeTile)){
                    
                   (this.tileController.supportsTransitions == 1) ?
                        target.removeClass('active')   
                        : this.mouseoutBlurShim();
                        
                    target.find('a').attr('tabIndex','-1');
                    
                    clearTimeout(this.tileFrontMouseEnterTimeout);
                    this.showTileArea(this.front);
                    
	             	this.tileBackMouseLeaveTimeout = window.setTimeout(function(){
		             	self.hideTileArea(self.backInner);
	             	},200);                                  
                } 
            }
        }
        // use mouse or enter key
        if(event.type == 'mousedown' || (event.type == 'keydown' && event.keyCode == 13) ){
        
            // prevent form submit in IE
          	if(event.keyCode == 13 && event.target.tagName !== 'A'){ event.preventDefault(); }      	
          	
          	
          	if(event.target.tagName == 'SPAN' || (event.target.tagName == 'A' && $(event.target).hasClass('tileLink') )){	    		
	    		return false;
	    	}  
	    	     	
            // if this tile is not the active one, 
            // hide activeTile (if not null) and show this one.
            if(!target.is(this.tileController.activeTile)){
                // if there is a pinned tile, unpin it
                if(this.tileController.pinned == true){
                    var lastActiveTile = this.tileController.activeTile;
                    
	                (this.tileController.supportsTransitions == 1) ?
	                    lastActiveTile.removeClass('active')
	                    : lastActiveTile.find('.tile-inner').animate({'top':'0'}, 250);
	                
                    lastActiveTile.find('a').attr('tabIndex','-1');
                    this.showTileArea(lastActiveTile.find('.front-inner'));
                }
                
                (this.tileController.supportsTransitions == 1) ?
                    target.addClass('active')
                    : this.mouseoverFocusShim(); 
                    
                this.backGoLink.attr('tabIndex',0);
                
                this.tileController.activeTile = target;
                this.tileController.pinned = true;
                
                clearTimeout(this.tileBackMouseDownTimeout);
                this.showTileArea(this.backInner);
                
             	this.tileFrontMouseDownTimeout = window.setTimeout(function(){
	                self.hideTileArea(self.front);
                },200);               
            }
            // if this tile is pinned, unpin it.
            else if(target.is(this.tileController.activeTile)){
            
            	(this.tileController.supportsTransitions == 1) ?
                    target.removeClass('active')   
                    : this.mouseoutBlurShim();
                        
                target.find('a').attr('tabIndex','-1');
                    
                this.tileController.activeTile = null;
                this.tileController.pinned = false;
             	
             	clearTimeout(this.tileFrontMouseDownTimeout);             	
                this.showTileArea(this.front);
                
             	this.tileBackMouseDownTimeout = window.setTimeout(function(){
	             	self.hideTileArea(self.backInner);
             	},200);   
            }
        }
    },
    showTileArea: function(target){
	    target.css({'display':'block', 'visibility':'visible'});
    },
    hideTileArea: function(target){
	    target.css({'display':'none', 'visibility':'hidden'});
    },
    mouseoverFocusShim: function(){
        this.tileInner.animate({'top':'-138px'}, 250);
    },
    mouseoutBlurShim: function(){       
        this.tileInner.animate({'top':'0'}, 250);
    }
};

/* Navigation.js */
/*
Navigation
7/1/12
MS / JF

DEPENDENCIES:
jQuery

PURPOSE:
Singleton that controls main navigation UI & behavior
*/
if (TARGET === null || typeof(TARGET) !== "object") { var TARGET = new Object(); }

TARGET.Navigation = (function(){
    var _instance;
    
    function init(){
        return {
            //
            // Globals
            //
            navHeightNums       :   {open:'124px',          closed:'124px', 
                                     mobileOpen: '380px',   mobileClosed: '80px'},
            mainTopNums         :   {open:'190px',          closed:'0px',
                                     mobileOpen: '0px',     mobileClosed: '0px'},
            numFadeSpeed        :   400,
            numNavDelay         :   50,
            elHeader            :   $('#global-header'),
            elMainContent       :   $('#main-content, #global-footer'),
            elNavPrimary        :   $('ul#nav-primary'),
            elNavUtility        :   $('ul#nav-utility'),
            elSubNavs           :   $('nav.nav-secondary'),
            elMobileMenuTrigger :   $('div#menuBtn'),
            elTriggers          :   $('a.nav-item-primary'),
            elHomeListItem      :   $('#nav-home'),
            navClicked          :   false,
            device              :   {phone: false, tablet: false},
			isAnimating			:   false,
			
            kickoff: function(){
	
                //
                // Initialize some dynamic global vars
                //
                this.elTriggerListItems = this.elNavPrimary.children('li');
                this.elSubNavLinks = this.elSubNavs.find('li > a');
                this.elNavPrimaryParent = this.elNavPrimary.parent();
                this.elHeader.isOpen = false;
                
                this.searchWidget = TARGET.MobileSearchWidget.getInstance();

                //
                // Initialize mobile
                //
                this.mobileAdjustments();    
                
                // Have current top-level page expanded for mobile
                if (TARGET.Util.isMobile() === true) {
                	this.openCurrentPageMobile();
                };
                   
                //
                // Setup Actions
                //
                this.setCurrentNavItem();
                
                //
                // Initialize Events
                //
                this.initEventHandlers();
                this.resetStyle();
            },
            checkDevice: function() {
                //this.device = TARGET.JSMediaQueries.getMatches();
            },
            initEventHandlers: function() {
                // Define self for future this reference
                var self = this;
                
                // Check for mobile
                var isMobile = TARGET.Util.isMobile();
                
                //
                // List Items
                //
                
                    // Click & Keydown 
                    this.elTriggerListItems.bind('click keydown', function(e){
                        if(e.type == 'click' || (e.type == 'keydown' && e.keyCode == 13)) {
                    
                            if($(e.target).is($(e.currentTarget).find('a.nav-item-primary, span.defaultText, span.updateLabel'))) {
                                e.preventDefault();
							}
                                               
                            var isKeyboard = e.keyCode == 13 ? true : false;

                            self.navItemClickAction(e.target, $(this), isKeyboard);
                        }
                    })
                    // Hover
                    .hover(function(e){
                        if(TARGET.Util.isMobile() === false) {
                            self.navItemMouseOverAction($(this));
                        }
                    }, function(e){
                        if(TARGET.Util.isMobile() === false) {
                            self.navItemMouseOutAction($(this));
                        }
                    });
                
                //
                // Mobile Menu Button
                //
                
                    // Click
                    this.elMobileMenuTrigger.click(function(e){
                        e.preventDefault();
                        if(TARGET.Util.isMobile() === true) {
                            self.mobileMenuBtnClickAction();
						}
                    });

                //
                // Document
                //
                
                    // Click
                    $(document).click(function(e){
                        if(TARGET.Util.isMobile() == false){
                            // check if click target is descendant of primary nav...hide menu if it's not
                            if(self.elNavPrimary.has(e.target).length === 0){                                    
                                self.closeDrawer(false);
                                self.navClicked = false;
                            }
                        }
                    })
                    // Keydown
                    .keydown(function(e){
                        if(e.keyCode == 27){
                            self.closeDrawer(false);
                            self.navClicked = false;
                        }
                    });
                
                //
                // Window
                //
                	// Resize
                    this.bindResizeEvent();

            },
			bindResizeEvent: function(){
				var self = this;
				
				jQuery(window).resize(function(e){
					if (Modernizr.touch) {
						e.preventDefault();
					} else {
						self.mobileAdjustments();
					};
				});
			},
			isInTransition: function(object) {
				var self = this;
				self.isAnimating = true;
				object.on('webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd', function (e) {
					self.isAnimating = false;
					//object.off('webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd');
				});
			},
            navItemClickAction: function(clickTarget, elNavListItem, isKeyboard){
                // Define self for future this reference
                var self = this;
                
                //
                // Mobile
                //
                if(TARGET.Util.isMobile() === true) {
                    // Follow link if home nav item
                    if(elNavListItem.attr('id') == 'nav-home'){
                        window.location = elNavListItem.children('a').attr('href');
                        return;
                    }
                    // Open subnav if primary nav item
                    if($(clickTarget).is('.nav-item-primary') || $(clickTarget).parent().is('.nav-item-primary')) {
                        this.mobileListItemClick(elNavListItem);
                    }
                }
                //
                // Desktop
                //
                else {
                    // open drawer & pin
                    if(this.navClicked === false && !$(clickTarget).is(this.elSubNavLinks)) {
                        this.navClicked = true;

                        elNavListItem.addClass('active');
                        this.openDrawer(elNavListItem, isKeyboard, false);
                        this.updateListItemAccessLabel(elNavListItem, ' collapse');
                    }
                    // close drawer & unpin
                    else if(elNavListItem.hasClass('active') && $(clickTarget).hasClass('defaultText')){
                        this.closeDrawer(false);
                        this.navClicked = false;

                        this.updateListItemAccessLabel(elNavListItem, ' expand');
                    }
                    else if(this.elHeader.isOpen === true && !$(clickTarget).is(this.elSubNavLinks)){
                        // close from 2nd keyboard enter
                        if(elNavListItem.hasClass('active')) {
                            this.closeDrawer(false);
                            this.navClicked = false;

                            this.updateListItemAccessLabel(elNavListItem, ' expand');
                        }
                        // swap subnavs while pinned
                        else {
                            var oldActive = $('.active');
                            oldActive.removeClass('active');
                            this.hideSubnav(oldActive.find('nav'));
                            this.updateListItemAccessLabel(oldActive, ' expand');
                            
                            var active = elNavListItem;
                            active.addClass('active');
                            this.showSubnav(active.find('nav'));    
                            
                            this.updateListItemAccessLabel(elNavListItem, ' collapse');                    
                        }
                    }
                }
            },
            mobileListItemClick: function(trigger, straightToSubnav){
                var triggerListItem = $(trigger);

                // hide all except trigger & slide up & show child subnav
                this.elTriggersNotActive = this.elTriggerListItems.not(triggerListItem);
                
                if(triggerListItem.hasClass('active')){
                    if(straightToSubnav !== true) {
                        this.mobileCloseSubnav(triggerListItem, true);
                    }
                }
                else {
                    this.mobileOpenSubnav(triggerListItem);
                }
            },            
            mobileMenuBtnClickAction: function(){
                // Define self for future this reference
                var self = this;
                
                if(this.searchWidget.isOpen === true){
	                this.searchWidget.closeSearchWidget();
                }
                if(this.elHeader.isOpen === true){
                
                    this.elMobileMenuTrigger.removeClass('active');
                    
                    this.closeDrawer(true);
                    
                    if(this.subnavIsOpen === true){
                    	setTimeout(function(){
	                        self.mobileCloseSubnav($('li.active > a'));
                        },500);
                    }
                        
                    this.navClicked = false;
                }
                // swap subnavs while pinned
                else {
                    
                    this.elMobileMenuTrigger.addClass('active');
                    
                    var activeListItem = this.elTriggerListItems.find('a.nav-item-primary.current').parent();
		            activeListItem.addClass('active');
                    this.openDrawer(activeListItem, null, true);
                    this.navClicked = true;
                    
                    //this.updateListItemAccessLabel(elNavListItem, 'Close ');                  
                }
            },
            mobileOpenSubnav: function(triggerListItem){
				if (TARGET.Util.isMobile()) {
					this.triggerText = triggerListItem.find('.defaultText');

	                triggerListItem.addClass('active').children('a.nav-item-primary').siblings('nav').show();

	                this.elTriggerListItems.removeClass('inactive');
	                this.elTriggersNotActive.addClass('inactive');

	                this.elNavUtility.hide();

	                this.subnavIsOpen = true;
				};
            },
            mobileCloseSubnav: function(triggerListItem, backToPrimary){
                if (backToPrimary) {
                    this.elTriggerListItems.filter('.active').removeClass('active').children('a.nav-item-primary').siblings('nav').hide();
                    this.elTriggersNotActive.removeClass('inactive');
                    this.elNavUtility.show();
                } else {
					this.elTriggerListItems.filter('.active').children('a.nav-item-primary').siblings('nav').hide();
				};
                
                this.subnavIsOpen = false;
            },
            updateListItemAccessLabel: function(elListItem, message){
                elListItem.find('.accessLabel').text(message);
            },
            navItemMouseOverAction: function(elNavListItem){
                // TODO: kill mouseover if you click. 
                if(this.navClicked === false) {
                    this.openDrawer(elNavListItem, null, false);
				}
            },
            navItemMouseOutAction: function(elNavListItem){
                // define self for future this reference
                var self = this;
                
                // if we aren't pinned and we're on desktop
                if(this.navClicked === false){
                    var elSubNavItem = elNavListItem.children("nav");
                    
                    clearTimeout(self.elHeader.openTimeout);
                    
                    self.hideSubnav(elSubNavItem);
                    
                    this.closeDrawer(TARGET.Util.isMobile());
                }
            },
            openDrawer: function(elNavItem, isKeyboard, isMobile){
                // define self for future this reference
                var self = this;
    
                // set 
                var elSubNavItem = elNavItem.children("nav"),
                activeNavItem = $('nav#nav-main #nav-primary > li.active');
                
                // there is an active item
                if (activeNavItem.length > 0) {
                    this.elTriggersNotActive = this.elTriggerListItems.not(activeNavItem);
                    this.mobileOpenSubnav(activeNavItem);
                };
                
                // set the transform dimensions based on device
                var heightNum = isMobile ? self.navHeightNums.mobileOpen : self.mainTopNums.open;
                
                //
                // Mobile
                //
                if(isMobile){
                	
                    this.resetStyle();
                    this.elHeader.addClass('open');
                    this.elHeader.openTimeout = setTimeout(function() {
                        self.elHeader.isOpen = true;
                        self.showSubnav(elSubNavItem, isKeyboard);
						
						self.elTriggerListItems.removeClass('inactive');
						if(activeNavItem.length > 0) {
			                self.elTriggersNotActive.addClass('inactive');
						}
                    }, self.numNavDelay);
                //
                // Desktop
                //
                } else {
					self.isAnimating = true;
                    this.elMainContent.stop(true,false).animate({'top': heightNum}, self.numFadeSpeed, function(){ 
						self.isAnimating = false;

                        self.elHeader.openTimeout = setTimeout(function() {
							if (self.isAnimating === false) {
								self.elHeader.isOpen = true;
	                            self.showSubnav(elSubNavItem, isKeyboard);
							};
                        }, self.numNavDelay);
                    });
                }
            },
            closeDrawer: function(isMobile){
                var active = this.elNavPrimary.find('li.active');
                var heightNum = isMobile ? this.navHeightNums.mobileClosed : this.mainTopNums.closed;
                //
                // Mobile
                //
                if(isMobile) {
                    // reset dynamically applied css
                    this.resetStyle();
                    
                    this.elHeader.isOpen = false;
                    //this.hideSubnav(active.find('nav'));
                //
                // Desktop
                //
                } else {
					self.isAnimating = true;
                    this.elMainContent.stop(true,false).animate({'top': heightNum}, self.numFadeSpeed, function(){
						self.isAnimating = false;
					});
                    this.elHeader.isOpen = false;
                    this.hideSubnav(active.find('nav'));
                    active.removeClass('active');
                }
            },
            showSubnav: function(elSubnav, isKeyboard){
				var self = this;
				
				self.isAnimating = true;
                elSubnav.stop(true, true).fadeIn(this.numFadeSpeed, function(){
					self.isAnimating = false;
				});
                if(isKeyboard === true){
                    //elSubnav.find('a').first().focus();
                }
            },
            hideSubnav: function(elSubNav){
				var self = this;
				
				self.isAnimating = true;
                elSubNav.stop(true,true).fadeOut(100, function(){
					self.isAnimating = false;
				});
            },
            setCurrentNavItem: function(){
                var location = window.location.pathname;
                var urlFragments = location.split('/');
                
                var currentNavItem = $('#nav-'+urlFragments[1]).find(this.elTriggers);
                currentNavItem.eq(0).addClass('current');
            },
            resetStyle: function(){
                this.elHeader.removeClass('open');
                this.elHeader.removeAttr('style');
                this.elMainContent.removeAttr('style');
            },
            clearOpenConditions: function(){
                this.elHeader.isOpen = false;
                this.navClicked = false;
                this.elMobileMenuTrigger.removeClass('active');
            },
            setPosition: function(isMobile, position){
                var self = this;
                
				if (Modernizr.touch) {
					$(window).unbind('resize');
				};
                
                // Mobile
                if (isMobile === true) {
					
                    // open
                    if (position == 'open') {
                        this.elHeader.addClass('open');
                        this.elHeader.isOpen = true;
						this.isInTransition(this.elHeader);
                        this.elMainContent.css('top',this.mainTopNums.mobileOpen);
                        this.elHeader.css('height',this.navHeightNums.mobileOpen);
                    // closed
                    } else if (position == 'closed') {
                        this.elHeader.removeClass('open');
                        this.elHeader.isOpen = false;
						this.isInTransition(this.elHeader);
                        this.elMainContent.css('top',this.mainTopNums.mobileClosed);
                        this.elHeader.css('height',this.navHeightNums.mobileClosed);
                    };
					
                // Desktop
                } else {
                    
                    this.elNavUtility.filter(':hidden').show();
                    
                    // open
                    if (position == 'open') {
                        // this.elHeader.addClass('open');
                        this.elHeader.isOpen = true;
						this.isInTransition(this.elHeader);
                        this.elHeader.css('height',this.navHeightNums.open);
                        this.elMainContent.css('top',this.mainTopNums.open);
                    // closed
                    } else if (position == 'closed') {
                        this.elHeader.removeClass('open');
                        this.elHeader.isOpen = false;
						this.isInTransition(this.elHeader);
                        this.elMainContent.css('top',this.mainTopNums.closed);
                        this.elHeader.css('height',this.navHeightNums.closed);
                    };
                };
                
				if (Modernizr.touch) {
					// rebind resize event
	                this.bindResizeEvent();
				}
                
            },
            mobileAdjustments: function(){
                // detect mobile
                var isMobile = TARGET.Util.isMobile();

                // reset dynamically applied css
                this.resetStyle();
                
                //
                // Mobile
                //
                if(isMobile === true) {

                    // allow tabbing to home link
                    this.elHomeListItem.attr('tabIndex',0);
                    
                    //
                    // Nav is open
                    //
                    if(this.elHeader.isOpen) {
                        
                        // try to set the active menu to the current page
                        if(this.openActivePageMobile()){
                            // set css for mobile nav open postion
                            this.setPosition(isMobile, 'open');
                        } else {
                            // set css for mobile nav closed postion
                            this.setPosition(isMobile, 'closed');
                        };
                        
                    //
                    // Nav is closed
                    //
                    } else {
                        this.openCurrentPageMobile();
                        if(this.searchWidget.isOpen === false){
	                        // set css for mobile nav closed postion
	                        this.setPosition(isMobile, 'closed');
	                    }
                    }   
                //
                // Desktop
                //
                } else {
    
                    // don't allow tabbing to home link
                    this.elHomeListItem.attr('tabIndex',-1);
                    
                    //
                    // Nav is open
                    //
                    if(this.elHeader.isOpen) {
    
                        // If the root menu is open, close for desktop
                        // Root menu open
                        if (this.elTriggerListItems.filter('.active').length < 1) {
                            this.clearOpenConditions();

                            // set css for nav closed postion
                            this.setPosition(isMobile, 'closed');
                        // Other menu open
                        } else {
                            // set css for nav open postion
                            this.setPosition(isMobile, 'open');
                        };
                        
                    //
                    // Nav is closed
                    //
                    } else {
                        // set css for nav closed postion
                        this.setPosition(isMobile, 'closed');
                    }
                }
            },
            openActivePageMobile: function(){
                // get active list item
                var activeListItem = $('nav#nav-main #nav-primary > li.active');
				
                // did we find the active nav item?
                if (activeListItem.length > 0) {
                    // set the non-active nav items
                    this.elTriggersNotActive = this.elTriggerListItems.not(activeListItem);
                    // set the active nav pane to the current page
                    this.mobileOpenSubnav(activeListItem);
                    
                    return true;
                }
                
                return false;
            },
            openCurrentPageMobile: function(){
                // attempt to get the top level nav item from the href attribute of nav links (more specific if it works)
                var topListItem = $('nav#nav-main nav.nav-secondary a[href="'+window.location.pathname+'"]').parents('nav.nav-secondary').parent('li');

                // did the first try get any results?
                if (topListItem.length === 0) {
                    // get the top level nav item from nav list item id
                    var location = window.location.pathname;
                    var urlFragments = location.split('/');
                    var topListItem = $('nav#nav-main #nav-primary li#nav-'+urlFragments[1]);
                };
                
                // did we ever find the top level nav item?
                if (topListItem.length > 0) {
                    // set the non-active nav items
                    this.elTriggersNotActive = this.elTriggerListItems.not(topListItem);
                    // set the active nav pane to the current page
                    this.mobileOpenSubnav(topListItem);
					this.subnavIsOpen = true;
					
					topListItem.addClass('inactive').children('a.nav-item-primary').siblings('nav').hide();
					
					return true;
                } else {
					return false;
				}
            }
        };
    };
    return {
        getInstance: function(){
            if(!_instance) {
				_instance = init();
			}
            return _instance;
        }
    };
})();

/* SendToFriend.js */
/*
    Send to Friend Controller
    6/28/12
    JF

    DEPENDENCIES:
    jQuery, jQuery Validator
    
    PURPOSE:
    Singleton that controls the send to friend form
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = new Object(); }

TARGET.SendToFriend = (function(){
    var _instance;
    
    function kickoff(){
        return {    
			initialize: function(options) {
				var self = this;
				this.options = options;
				
				this.elTrigger = this.options.trigger;
				this.elForm = $('form.send-to-friend');
				this.elResponse = $('<div class="response"></div>');
				this.elLoading = $('<div class="loading"></div>');
				this.elRetryTrigger = this.elForm.find('a.retry');
				this.formFields = {};
				this.formData = null;
				this.validationRules = {
					txtToName: "required",
					txtFromName: "required",
					txtToEmail: {
						required: true,
						email: true
					},
					txtFromEmail: {
						required: true,
						email: true
					}
				};
				
				this.dummySuccess = '[{"status":"success"}]';
				this.dummyError = '[{"status":"error"}]';
				this.dummyStatus = null;
				this.dummyState = false;
				if (this.dummyState) {
					this.dummyStatus = this.dummySuccess;
				} else {
					this.dummyStatus = this.dummyError;
				};
				
				//self.elForm.css('height', 'auto');
				self.resetFormClass();
				
				this.mapHiddenFields();
				this.eventHandlers();
			},
			resetFormClass: function() {
				this.elForm.removeClass('success').removeClass('error');
				
			},
			eventHandlers: function() {
				var self = this;
				
				this.elTrigger.bind('click', function(e) {
					e.preventDefault();
					self.getCurrentPage(e);
					self.formContents = self.elForm.html();
					self.loadValidation();
					self.launchOverlay();
				});
				
				this.elRetryTrigger.live('click', function(e) {
					e.preventDefault();
					
					self.dummyStatus = self.dummySuccess;
					
					self.elForm.empty();
					self.ajaxSubmit(self.elForm);
				});
				
				this.elForm.ajaxStart(function(){
				   self.elForm.append(self.elLoading);
				});
				this.elForm.ajaxStop(function(){
				   self.elForm.find('div.loading').remove();
				});
			},
			mapHiddenFields: function() {
				this.formFields.urlLink = this.elForm.find('input[name=urlLink]');
			},
			getCurrentPage: function(e) {
				if (this.elTrigger.attr('href') == "#") {
					this.shareUrl = window.location.origin+window.location.pathname;
				} else {
					this.shareUrl = this.elTrigger.attr('href');
				};
				this.formFields.urlLink.attr('value', this.shareUrl);
			},
			loadValidation: function() {
				var self = this;
				
				this.elForm.show().validate({
					debug: true,
					submitHandler: function(form) {
						self.formData = $(form).serialize();
						self.ajaxSubmit($(form));
					},
					rules: self.validationRules
				});
			},
			ajaxSubmit: function(form) {
				var self = this;
				
				self.resetFormClass();
				
				$.ajax({
					url: form.attr('action'),
					data: this.formData,
					type: "POST", 
					success: function(data, textStatus, jqXHR) {

						//data = self.dummyStatus;
						
						//console.log(data);
						
						//response = $.parseJSON(data);
						//self.getResponseTemplate(response[0].status);
						response = [{
							status: 'success'
						}];
						self.getResponseTemplate('success');
						
						
						if (self.response) {
							self.elResponse.empty().append(self.response);
							self.elForm.empty().addClass(response[0].status).append(self.elResponse);
						} else {
							//console.log(response);
						};
						
					},
					error: function(jqXHR, textStatus, errorThrown) {
						//console.log(errorThrown);
						
						/* Hard coding in success due to bugs with Send to a Friend web service */
						response = [{
							status: 'success'
						}];
						self.getResponseTemplate('success');
						
						
						if (self.response) {
							self.elResponse.empty().append(self.response);
							self.elForm.empty().addClass(response[0].status).append(self.elResponse);
						} else {
							//console.log(response);
						};
						/*response = [{
							status: 'error'
						}];
						self.getResponseTemplate("error");
						
						if (self.response) {
							self.elResponse.empty().append(self.response);
							self.elForm.empty().addClass(response[0].status).append(self.elResponse);
						} else {
							//console.log(response);
						};*/
					}
				});
				
				return false;
			},
			launchOverlay: function() {
				var self = this;
				
				$.overlay.load({
					target: self.elTrigger,
					div: self.elForm,
					onClose: function(){
						self.elForm.empty().html(self.formContents);
						self.resetFormClass();
					}
				});
			},
			getResponseTemplate: function(template) {
				this.response = null;
				if (template == 'success') {
					this.response = $('<h3>thank you for sharing</h3><p><a class="close">close this window</a></p>');
				} else if (template == 'error') {
					this.response = $('<h3>oops! an error occurred</h3><p><a class="retry">retry</a> or <a class="close">close this window</a></p>');
				};
			}
        };
    };
    return {
        getInstance: function(){
            if(!_instance)
                _instance = kickoff();
            return _instance;
        }
    };
})();
/* Util.js */
/*
    Utilities
    8/24/12
    MS / JF

    DEPENDENCIES:
    jQuery
    
    PURPOSE:
    Collection of utility & object extension methods
*/
if (TARGET == null || typeof(TARGET) != "object") { var TARGET = new Object(); }

TARGET.Config = {
	isIE:  !!(navigator.userAgent.indexOf('MSIE') >= 0),
	isIE7: !!(navigator.userAgent.indexOf('MSIE 7') >= 0),
	isIE8: !!(navigator.userAgent.indexOf('MSIE 8') >= 0),
	isIE9: !!(navigator.userAgent.indexOf('MSIE 9') >= 0),
	isIDevice: (navigator.platform.indexOf('iPhone')>=0 || navigator.platform.indexOf('iPad')>=0) ? true : false,
	isIPhone: (navigator.userAgent.match(/iPhone/i) !== null) ? true : false,
	isIPad: (navigator.userAgent.match(/iPad/i) !== null) ? true : false
};

TARGET.Util = {

    _isMobile: null,
    isMobile: function () {
        var self = this;
    	
        if (this.getQueryParameterByName('nmob') == 1) {
            this._isMobile = false;
        } else if ($(window).width() > 688) {
            this._isMobile = false;
        } else if (this.supportsMediaQueries() && $('body.investors').length == 0) {
            this._isMobile = true;
        } else {
            this._isMobile = false;
        }
        return this._isMobile;
    },
    getQueryParameterByName: function (name) {

        var match = RegExp('[?&]' + name + '=([^&]*)')
	                    .exec(window.location.search);

        return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
    },
    getSubdomain: function () {
        var hostnameParts = window.location.hostname.split('.');

        if (hostnameParts[0] != 'target' && hostnameParts[0] != 'www') {
            return hostnameParts[0];
        };
        return false;
    },
    setBodyClass: function () {
        var _body = $('body');

        if (this.isMobile() == true) {
            _window.bind('load', TARGET.Util.scrollFunc);

            _body.removeClass('desktop').addClass('mobile');
        } else {
            _body.addClass('desktop').removeClass('mobile');
        }
    },
    scrollFunc: function () {
        setTimeout(function () {
            window.scrollTo(0, 1);
        }, 100);
    },
    accessLabelFunc: function () {
        $('.skip-links').find('a').bind('focus blur click',
	        function (e) {
	            if (e.type == 'focus') { $(this).css({ 'left': 0, 'top': 0 }); }
	            if (e.type == 'blur') { $(this).css({ 'left': '-999999px', 'top': '-999999px' }); }
	            if (e.type == 'click') {
	                e.preventDefault();

	                var target = $(this).hasClass('navJump') ? $('#nav-about > a') : $($(this).attr('href')).attr('tabIndex', '-1');

	                target.focus();
	            }
	        }
	    );
    },
    linkPopup: function (urls) {
        this.urls = urls;
        urls.click(function (e) {
            e.preventDefault();
            var el = $(e.target);
            var link = el.attr('href');
            window.open(link, "Share", "menubar=no,status=yes,toolbar=no,height=400,width=800,resizable=yes");
        });
    },
    smoothScroll: function (e, getTargetById, targetOverride, callback) {
        e.preventDefault();

        var element = $(e.currentTarget);
        var elementHref = element.attr("href");
        var targetName = elementHref.split('#', 2);
        var destination = null;

        if (targetOverride) {
            var target = targetOverride;
        } else {
            if (getTargetById) {
                var target = $('#' + targetName[1]);
            } else {
                var target = $('a[name=' + targetName[1] + ']');
            };
        };

        if (targetName[1] == "top") {
            destination = 0;
        } else if (target.offset() != null) {
            destination = target.offset().top;
        };

        if (destination !== null) {
            $("html:not(:animated),body:not(:animated)").animate({
                scrollTop: destination
            }, 1000, 'easeInOutCubic', function () {
                if (typeof callback == 'function') {
                    callback.call(this);
                };
            });
        }
        return false;
    },
    parseJSON: function (data) {
        var cleanedData = jQuery.parseJSON(data);
        if (!cleanedData) {
            cleanedData = data;
        }
        return cleanedData;
    },
    strpos: function (haystack, needle, offset) {
        var i = (haystack + '').indexOf(needle, (offset || 0));
        return i === -1 ? false : i;
    },
    supportsMediaQueries: function () {
        return Modernizr.mq('only all');
    },
    trimTilde: function (value) {
        if ((value + '').indexOf("~", 0) === 0) {
            value = value.substr(1);
        };
        return value;
    },
    facebookTrackInit: function () {
        // track Facebook likes
        FB.Event.subscribe('edge.create', function (targetUrl) {
            _gaq.push(['_trackSocial', 'facebook', 'like', targetUrl]);
            t2._gaq.push(['_trackSocial', 'facebook', 'like', targetUrl]);
        });
    },
    twitterTrackInit: function(intent_event) {
        if (intent_event) {
            var opt_target;
            if (intent_event.target && intent_event.target.nodeName == 'IFRAME') {
                opt_target = this.extractParamFromUri(intent_event.target.src, 'url');
            }
            // track Twitter shares
            _gaq.push(['_trackSocial', 'twitter', 'tweet', opt_target]);
            t2._gaq.push(['_trackSocial', 'twitter', 'tweet', opt_target]);
        }
    },
    extractParamFromUri: function(uri, paramName) {
        if (!uri) {
            return;
        }
        var regex = new RegExp('[\\?&#]' + paramName + '=([^&#]*)');
        var params = regex.exec(uri);
        if (params != null) {
            return unescape(params[1]);
        }
        return;
    }
};

$.extend($.expr[':'], {
    'containsi': function (elem, i, match, array) {
        return (elem.textContent || elem.innerText || '').toLowerCase()
    .indexOf((match[3] || "").toLowerCase()) >= 0;
    }
});
// Array.indexOf polyfill
if (!Array.prototype.indexOf)
{
  Array.prototype.indexOf = function(elt /*, from*/)
  {
    var len = this.length;

    var from = Number(arguments[1]) || 0;
    from = (from < 0)
         ? Math.ceil(from)
         : Math.floor(from);
    if (from < 0)
      from += len;

    for (; from < len; from++)
    {
      if (from in this &&
          this[from] === elt)
        return from;
    }
    return -1;
  };
}
Array.prototype.remove = function(){
    var what, a= arguments, L= a.length, ax;
    while(L && this.length){
        what= a[--L];
        while((ax= this.indexOf(what))!= -1){
            this.splice(ax, 1);
        }
    }
    return this;
};

/* main.js */
if (TARGET === null || typeof (TARGET) !== "object") { var TARGET = new Object(); }

$(document).ready(function () {
    $('body').removeClass('no-js');

    TARGET.Config.hasTouch = Modernizr.touch;

    TARGET.Util.setBodyClass();

    TARGET.Navigation.getInstance().kickoff();

    TARGET.TileController.getInstance().kickoff();

    var bodySearchForm = $('.searchWrapper');
    if (bodySearchForm.length > 0) {
        var inputField = bodySearchForm.find('input#search-body'),
        submitBtn = bodySearchForm.find('input.submit');

        submitBtn.bind('click', function (e) {
            e.preventDefault();
            var value = inputField.val();
            window.location = '/search-results?q=' + value + '&start=0&num=10';
        });
    }
    var careersSearchSubmit = $('#ctl00_MainContentPlaceholder_uxCareerSearchSubmit');
    if (careersSearchSubmit.length > 0) {
        careersSearchSubmit.on('click', function (e) {
            var searchQuery = $(this).prev().val();
            _gaq.push(['_trackEvent', 'Careers', 'Search', searchQuery]);
            t2._gaq.push(['_trackEvent', 'Careers', 'Search', searchQuery]);
        });
    }
    // Recruiting Events Page
    var recruitingEvents = $('.recruiting-events-widget');
    if (recruitingEvents.length > 0) {
        new TARGET.RecruitingEvents.getInstance().kickoff();
    }
    // showHideWidgets include both multi-panel accordions & single-panel drop-downs
    var showHideWidgets = $('.showhide-widget');
    if (showHideWidgets.length > 0) {
        showHideWidgets.each(function () {
            new TARGET.ShowHideWidget($(this));
        });
    }
    var ajaxShowHideWidgets = $('.ajax-showhide-widget');
    if (ajaxShowHideWidgets.length > 0) {
        ajaxShowHideWidgets.each(function () {
            new TARGET.AjaxShowHideWidget($(this));
        });
    }

    if ($('.homepage-carousel').length > 0) {
        new TARGET.HomepageCarousel();
    }

    var imageCarousel = $('.image-carousel');
    if (imageCarousel.length > 0) {
        if (imageCarousel.hasClass('fade')) {
            new TARGET.ImageCarousel({ transition: 'fade' });
        } else {
            new TARGET.ImageCarousel({ transition: 'slide' });
        };
    }

    var inlineVideo = $('.inline-video');
    if (inlineVideo.length > 0) {
        inlineVideo.each(function () {
            new TARGET.InlineVideoWidget($(this));
        });
    }

    if ($('#discoverTarget').length > 0) {

        $('nav.arrows').children('a').on('mouseenter mouseleave focusin focusout', function (e) {
            if (e.type == 'mouseenter' || e.type == 'mouseout')
                e.preventDefault();

            var target = $(e.currentTarget).children('.visible-btn');

            if (e.type == 'mouseenter' || e.type == 'focusin')
                target.stop().animate({ 'opacity': 1 }, 200).children().show();

            else if (e.type == 'mouseleave' || e.type == 'focusout')
                target.stop().animate({ 'opacity': 0 }, 200).children().hide();
        }).children().css('opacity', 0).children().hide();
    }

    if ($('.grid-column-widget').length > 0) {
        $('.grid-column-widget').find('article > div:last-child').columnize({ columns: 3 });
    }
    if ($('.grants-recipients').length > 0) {
        new TARGET.GrantsRecipients();
    }
    if ($('.history.about').length > 0) {
        $('.primaryColumn').after('<div id="history_timeline"></div>');

        // instantiate overlay & feed it div#history_timeline
        TARGET.FlashOverlay.getInstance().initialize({
            shellSWF: "/_ui/swf/corporateTimeline/swf/Shell.swf",
            containerId: "history_timeline",
            overlayLinkClass: "overlayLink",
            width: "870",
            height: "630",
            templateHeight: "660",
            flashOptions: {
                app: "/_ui/swf/corporateTimeline/swf/Application.swf",
                config: "/_ui/swf/corporateTimeline/xml/config_en.xml",
                languageStr: "en"
            },
            openLinkSelector: "body.history.about .gallery a.redBtn",
            flashButtonText: "start exploring (flash)",
            noFlashButtonText: "start exploring"
        });
    }
    if ($('.history-text.about').length > 0) {
        TARGET.HistoryTimelineText.getInstance().initialize();
    };

    if ($('.careers.culture').length > 0) {
        $('.primaryColumn').after('<div id="culture_flash"></div>');

        // instantiate overlay & feed it div#culture_flash
        TARGET.FlashOverlay.getInstance().initialize({
            shellSWF: "/_ui/swf/wherewework/swf/tcwww_loader.swf",
            containerId: "culture_flash",
            overlayLinkClass: "overlayLink",
            width: "860",
            height: "482",
            templateHeight: "512",
            flashOptions: {
                xmlFile: "/_ui/swf/wherewework/xml/configuration.xml"
            },
            openLinkSelector: "body.careers.culture .gallery a.redBtn",
            flashButtonText: "launch the tour (flash)",
            noFlashButtonText: "launch the tour"
        });
    };

    if ($('.careers.dc-locations').length > 0) {
        TMAPS.init();
        TMAPS.addPins(TMAPS.distributionCenterLocations);

        $('.distCenterListColumns').columnize({ columns: 5 });
    };

    if ($('body.goals-reporting').length > 0) {

        var $elTabControl;
        var $elCollectionOfControls;
        var $elOptionCollection;
        var $elTabContentDivs = $('.tab-content');
        var activeTabControlId;
        var strLinkHash = window.location.hash.substr(1);

        function switchTab(tabId) {
            //clear all tabs of current class 
            $($elCollectionOfControls).each(function (index) {
                $($elCollectionOfControls[index]).removeClass('current');
            });
            //set all content divs to invisible
            $($elTabContentDivs).each(function (index) {
                $($elTabContentDivs[index]).addClass('element-invisible');
            });
            //show selected tab as current
            $('#' + tabId).addClass('current');
            //show corresponding content div
            $('#content-' + tabId).removeClass('element-invisible');
        }

        if ($(document.body).hasClass('desktop')) {
            $elTabControl = $('#tab-navigation-goals-progress li a');
            $elCollectionOfControls = $('#tab-navigation-goals-progress li');

            //via click
            $elTabControl.on('click', function (e) {
                e.preventDefault();
                activeTabControlId = $(this).parent()[0].id;

                //set active tab
                switchTab(activeTabControlId);
            });

            //via hashtag
            if (strLinkHash) {
                ($elTabControl).each(function (id) {

                    if (strLinkHash === $elTabControl[id].id) {
                        activeTabControlId = $(this).parent()[0].id;

                        //set active tab                        
                        switchTab(activeTabControlId);
                    }
                });
            }

        } else if ($(document.body).hasClass('mobile')) {
            $elCollectionOfControls = $('#select-navigation-goals-progress');

            $elCollectionOfControls.change(function () {
                $elTabContentDivs.addClass('element-invisible');
                $elTabContentDivs.eq(this.selectedIndex - 1).removeClass('element-invisible');
            });
        }
    };
    if ($('.sponsorship-form').length > 0) {
        // checkBoxWidgets
        var checkBoxWidgets = $('.checkbox-widget');
        if (checkBoxWidgets.length > 0) {
            checkBoxWidgets.each(function () {
                new CheckBoxWidget($(this));
            });
        }
        var sponsorshipFormWrapper = $('#sponsorship-form-wrapper'),
            successWrapper = $('#success'),
            errorWrapper = $('#error');

        var formInputs = sponsorshipFormWrapper.find('input, textarea'),
            submitButton = sponsorshipFormWrapper.find('#submit'),
            emailField = sponsorshipFormWrapper.find('.email'),
            errorMessage = sponsorshipFormWrapper.find('p.error');

        sponsorshipFormWrapper.find('.date').datepicker();

        var requiredInputs = sponsorshipFormWrapper.find('input[type=text], textarea');
        requiredInputs.on('change', function () {
            var empty = false;
            formInputs.each(function () {
                if ($(this).val() == '' || $(this).hasClass('placeholder')) {
                    empty = true;
                }
                else {
                    $(this).css('border-color', 'white');
                }
            });
            if (empty || !validateEmail(emailField.val())) {
                $('.submit').addClass('disabled');
            } else {
                $('.submit').removeClass('disabled');
            }

        }).placeholder();

        function validateEmail($email) {
            var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
            if (!emailReg.test($email)) {
                return false;
            } else {
                return true;
            }
        }
        submitButton.on('click', function (e) {
            e.preventDefault();

            if ($(this).hasClass('disabled')) {

                if (!validateEmail(emailField.val())) {
                    emailField.css('border-color', 'red');
                }
                requiredInputs.filter(function () { return ($(this).val() == ''); }).css('border-color', 'red');

                errorMessage.addClass('visible');
            }
            else {
                errorMessage.removeClass('visible');

                var serializedForm = formInputs.serializeArray(),
                    requestData = {};

                $.each(serializedForm, function (index, input) {
                    // append multiple checkboxes
                    if(requestData.hasOwnProperty(input.name)){
                        requestData[input.name] += ', '+input.value;
                    }
                    else {
                        requestData[input.name] = input.value;
                    }
                });

                $.ajax({
                    type: 'POST',
                    url: '/sponsorship/request',
                    data: requestData,
                    dataType: "json",
                    success: function () {
                        sponsorshipFormWrapper.hide();
                        successWrapper.css({ 'display': 'block', 'visibility': 'visible' });
                    },
                    error: function (data) {
                        if (data.status === 404) {
                            sponsorshipFormWrapper.hide();
                        }
                        errorWrapper.css({ 'display': 'block', 'visibility': 'visible' }).find('#error-msg').text(data.statusText);
                    }
                });
            }
        });
    }
    if ($('.no-csstransitions').length > 0) {
        var nugget = $('.nugget');
        nugget.css('opacity', 0).parent().css('padding-left', '15px');

        $('.ribbon a').bind('mouseover mouseout focusin focusout', function (e) {
            if (e.type == 'mouseover' || e.type == 'focusin') {
                nugget.stop(true, false).animate({ 'opacity': 1 }, 100, 'easeOutQuad').parent().stop(true, false).animate({ 'padding-left': '35px' }, 200, 'easeOutQuad');
            } else {
                nugget.stop(true, false).animate({ 'opacity': 0 }, 100, 'easeOutQuad').parent().stop(true, false).animate({ 'padding-left': '15px' }, 200, 'easeOutQuad');
            }
        });
    }


    $('input[type=text], input[type=search]').placeholder();

    var shareLinks = $('.share-this').find('a:not(.email, .twitter)');
    if (shareLinks.length > 0) {
        TARGET.Util.linkPopup(shareLinks);
    }

    var sendToFriendTriggers = $('.share-this a.email');
    if (sendToFriendTriggers.length > 0) {
        sendToFriendTriggers.each(function () {
            TARGET.SendToFriend.getInstance().initialize({
                trigger: $(this)
            });
        });
    }
    $('a.back-to-top').bind('click', function (e) {
        TARGET.Util.smoothScroll(e, true, null);
    });
    $('#where-we-work-map a').bind('click', function (e) {
        TARGET.Util.smoothScroll(e, true, null);
    });
    $('.explore-goals').find('ul a').bind('click', function (e) {
        TARGET.Util.smoothScroll(e, true, null);
    });
    if ($('.btttest').length > 0) {
        new TARGET.BackToTopController.getInstance().kickoff({
            injectionContainerSelector: '.btt-test-container',
            injectionItemSelector: 'article',
            injectionInterval: 4
        });
    }

    TARGET.MobileSearchWidget.getInstance().kickoff();

    TARGET.Util.accessLabelFunc();

    var siteMessage = $('#site-message');
    if (siteMessage.length > 0) {
        siteMessage.find('a.close').bind('click', function (e) {
            e.preventDefault();
            $.ajax({
                url: '/SetSession/DisplayAlert/false',
                success: function (data) {
                    siteMessage.animate({ 'height': 0 }, 500, 'easeOutQuart', function () { $(this).remove(); });
                }
            });
        });
    }

});

var _window = $(window);

_window.bind('resize', function () {
    TARGET.Util.setBodyClass();
});

/* TargetEverestVideoPlayer.js */
 
if(typeof TARGET == "undefined") TARGET = {};

if(typeof log == "undefined") {
	function log(str) { try { console.log(str); } catch(e) {} }
}

TARGET.EverestVideoPlayer = function(containerId, width, height, playerUrl, name, options) {
	if(typeof TARGET.EverestVideoPlayer.instances == "undefined")
		TARGET.EverestVideoPlayer.instances = [];
		
	this.videoPlayerId = TARGET.EverestVideoPlayer.instances.length;
	TARGET.EverestVideoPlayer.instances.push(this);
		
	this.containerId_ = containerId;
	this.flashId_ = "flashVideoPlayer" + this.videoPlayerId;
	
	this.flashPlayer_ = null;
	this.name = "TARGET.EverestVideoPlayer.instances["+this.videoPlayerId+"]";
	this.playerUrl_ = playerUrl || null;
	this.expressInstallUrl_ = null;

	this.flashParams_ = [
		{"name": "allowScriptAccess", "value": "always"},
		{"name": "allowFullScreen",   "value": "true"},
		{"name": "wmode",             "value": "window"}
	];
	this.flashVars_ = [];
	
	this.width_ = width || 558;
	this.height_ = height || 322;
	this.version_ = "9.0.115";
	
	this.movieLoadTimeout_ = 2000;
	this.retryInterval_ = 50;
	this.flashHasLoaded_ = false;
	this.isSWFReady = false;
	this.currentStream = null;
	
	//set flashvars from options
	if(typeof options == "object"){
		var item;
		for(item in options){
			this.addFlashVar(item, options[item]);
		}
	}
	
	//register callback method and id of this instance
	this.addFlashVar("objectName", this.name);
	this.addFlashVar("readyCallback", this.name+".onSWFReady");
	this.createFlashPlayer();
	if(options && options["source"]) this.currentStream = options;
};

TARGET.EverestVideoPlayer.prototype.onSWFReady = function() {
	
	if(this.isSWFReady == true){
		return;
	}
	
	this.isSWFReady = true;
	if(this.currentStream){
		try { 
			if(this.flashPlayer_ == null) this.flashPlayer_ = this.getFlashPlayer();
			this.flashPlayer_.source(this.currentStream);
			log("success");	
		}			
		catch(e) {
			log("error " + e);
		}
	}
};

TARGET.EverestVideoPlayer.prototype.setFlashId = function(flashId) {
	this.flashId_ = flashId;
};

TARGET.EverestVideoPlayer.prototype.setPlayerUrl = function(playerUrl) {
	this.playerUrl_ = playerUrl;
};

TARGET.EverestVideoPlayer.prototype.setVersion = function(version) {
	this.version_ = version;
};

TARGET.EverestVideoPlayer.prototype.setExpressInstallUrl = function(expressInstallUrl) {
	this.expressInstallUrl_ = expressInstallUrl;
};

TARGET.EverestVideoPlayer.prototype.addParameter = function(name, value) {
	var found = false;
	for(var i = 0; !found && i < this.flashParams_.length; ++i) {
		if(name == this.flashParams_[i].name) {
			this.flashParams_[i].value = value;
			found = true;
		}
	}
	if(!found) 
		this.flashParams_.push({"name": name, "value": value});
};

TARGET.EverestVideoPlayer.prototype.addFlashVar = function(name, value) {
	this.flashVars_.push({"name": name, "value": value});
};

TARGET.EverestVideoPlayer.prototype.movieIsLoaded = function() {
	
	log("movieIsLoaded :: " + this.flashHasLoaded_ + " : " + this.flashPlayer_ + " : " + this.flashPlayer_.PercentLoaded())
	
	if (this.flashHasLoaded_)
		return true;
	
	try {
		// First make sure the movie's defined. Browsers treat this 
		// differently, so return false on error.
		if (this.flashPlayer_ && this.flashPlayer_.PercentLoaded()) {
			// If it is, check how much of it is loaded.
			if (this.flashPlayer_.PercentLoaded() == 100) {
				this.flashHasLoaded_ = true;
				return true;
			} 
			else {
				return false;
			}
		} 
		else {
			// If the movie isn't defined, it's not loaded.
			return false;
		}
	}
	catch(err){
		log("movieIsLoaded: error" + err);
		return false;
	}
}

TARGET.EverestVideoPlayer.prototype.playVideo = function(options) {
	this.currentStream = options;
	this.flashPlayer_ = this.getFlashPlayer();
	if(this.flashPlayer_ == null) {
		this.createFlashPlayer();
		this.flashPlayer_ = this.getFlashPlayer();
		log("success");	
	}else if(this.isSWFReady){
		this.flashPlayer_.source(options);
	}else{
		this.currentStream = options;
	}
};

TARGET.EverestVideoPlayer.prototype.pause = function() {
	this.flashPlayer_ = this.getFlashPlayer();
	if(this.flashPlayer_ != null) this.flashPlayer_.pause();
}

TARGET.EverestVideoPlayer.prototype.play = function() {
	this.flashPlayer_ = this.getFlashPlayer();
	if(this.flashPlayer_ != null) this.flashPlayer_.playVideo();
}

TARGET.EverestVideoPlayer.prototype.stop = function() {
	this.flashPlayer_ = this.getFlashPlayer();
	if(this.flashPlayer_ != null) this.flashPlayer_.stopVideo();
}

TARGET.EverestVideoPlayer.prototype.close = function() {
	this.flashPlayer_ = this.getFlashPlayer();
	if(this.flashPlayer_ != null) this.flashPlayer_.close();
}

TARGET.EverestVideoPlayer.prototype.getFlashPlayer = function() {
	var r = null;
	var o = document.getElementById(this.flashId_);
	if (o) {
		var n = o.getElementsByTagName("object")[0];
		
		if(!n || (n && typeof(o.SetVariable) != "undefined")) {
	    	r = o;
		} else if (typeof(n.SetVariable) != "undefined") {
			r = n;
		}
	}
	return r;
};

TARGET.EverestVideoPlayer.prototype.createFlashPlayer = function(defaultVideo) {	
	if(typeof swfobject != "undefined") {
		var fv = new Object(); var fp = new Object();
		
		for(var i = 0; i < this.flashVars_.length; ++i) 
			fv[this.flashVars_[i].name] = this.flashVars_[i].value;
		
		if(typeof defaultVideo != "undefined")
			fv["defaultVideo"] = escape(defaultVideo);
		
		if(this.width_ >= 0) fv["width"] = this.width_;
		if(this.height_ >= 0) fv["height"] = this.height_;
		
		for(var i = 0; i < this.flashParams_.length; ++i)
			fp[this.flashParams_[i].name] = this.flashParams_[i].value;
		
		try {
			swfobject.embedSWF(this.playerUrl_, this.containerId_, this.width_, this.height_, this.version_, this.expressInstallUrl_, 
				/* FlashVars */ fv, /* Parameters */ fp, 
				{id:this.flashId_, name:this.flashId_});
			log("player created");
			return true;
		}
		catch(e) {
			log("error " + e);
			return false;
		}
	}
	else if(typeof SWFObject != "undefined") {
		var so = new SWFObject(this.playerUrl_, this.flashId_, this.width_, this.height_, this.version_);
		for(var i = 0; i < this.flashParams_.length; ++i)
			so.addParam(this.flashParams_[i].name, this.flashParams_[i].value);
		
		if(typeof defaultVideo != "undefined") 
			so.addVariable("defaultVideo", escape(defaultVideo));
		
		for(var i = 0; i < this.flashVars_.length; ++i)
			so.addVariable(this.flashVars_[i].name, this.flashVars_[i].value);
			
		if(this.width_ >= 0) so.addVariable("width", this.width_);
		if(this.height_ >= 0) so.addVariable("height", this.height_);
		
		try {
			if(so.write(this.containerId_)) {
				log("player created");
				return true;
			}
			else {
				return false;
			}
		
		}
		catch(e) {
			log("error " + e);
			return false;
		} 
	}
};
/* modernizr.custom.js */
/* Modernizr 2.6.1 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-fontface-backgroundsize-borderradius-boxshadow-opacity-rgba-textshadow-cssanimations-csscolumns-generatedcontent-cssgradients-csstransforms-csstransitions-video-input-inputtypes-svg-touch-shiv-mq-cssclasses-teststyles-testprop-testallprops-prefixes-domprefixes-load
 */
;window.Modernizr=function(a,b,c){function C(a){j.cssText=a}function D(a,b){return C(n.join(a+";")+(b||""))}function E(a,b){return typeof a===b}function F(a,b){return!!~(""+a).indexOf(b)}function G(a,b){for(var d in a){var e=a[d];if(!F(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function H(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:E(f,"function")?f.bind(d||b):f}return!1}function I(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+p.join(d+" ")+d).split(" ");return E(b,"string")||E(b,"undefined")?G(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),H(e,b,c))}function J(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)u[c[d]]=c[d]in k;return u.list&&(u.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),u}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),e=k.type!=="text",e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0,g.removeChild(k)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=k.checkValidity&&k.checkValidity()===!1:e=k.value!=l)),t[a[d]]=!!e;return t}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.6.1",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={svg:"http://www.w3.org/2000/svg"},s={},t={},u={},v=[],w=v.slice,x,y=function(a,c,d,e){var f,i,j,k=b.createElement("div"),l=b.body,m=l?l:b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),k.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),k.id=h,(l?k:m).innerHTML+=f,m.appendChild(k),l||(m.style.background="",g.appendChild(m)),i=c(k,a),l?k.parentNode.removeChild(k):m.parentNode.removeChild(m),!!i},z=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b).matches;var d;return y("@media "+b+" { #"+h+" { position: absolute; } }",function(b){d=(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle)["position"]=="absolute"}),d},A={}.hasOwnProperty,B;!E(A,"undefined")&&!E(A.call,"undefined")?B=function(a,b){return A.call(a,b)}:B=function(a,b){return b in a&&E(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=w.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(w.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(w.call(arguments)))};return e}),s.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:y(["@media (",n.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c},s.rgba=function(){return C("background-color:rgba(150,255,150,.5)"),F(j.backgroundColor,"rgba")},s.backgroundsize=function(){return I("backgroundSize")},s.borderradius=function(){return I("borderRadius")},s.boxshadow=function(){return I("boxShadow")},s.textshadow=function(){return b.createElement("div").style.textShadow===""},s.opacity=function(){return D("opacity:.55"),/^0.55$/.test(j.opacity)},s.cssanimations=function(){return I("animationName")},s.csscolumns=function(){return I("columnCount")},s.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return C((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),F(j.backgroundImage,"gradient")},s.csstransforms=function(){return!!I("transform")},s.csstransitions=function(){return I("transition")},s.fontface=function(){var a;return y('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&g.indexOf(d.split(" ")[0])===0}),a},s.generatedcontent=function(){var a;return y(['#modernizr:after{content:"',l,'";visibility:hidden}'].join(""),function(b){a=b.offsetHeight>=1}),a},s.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(d){}return c},s.svg=function(){return!!b.createElementNS&&!!b.createElementNS(r.svg,"svg").createSVGRect};for(var K in s)B(s,K)&&(x=K.toLowerCase(),e[x]=s[K](),v.push((e[x]?"":"no-")+x));return e.input||J(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)B(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},C(""),i=k=null,function(a,b){function k(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function l(){var a=r.elements;return typeof a=="string"?a.split(" "):a}function m(a){var b=i[a[g]];return b||(b={},h++,a[g]=h,i[h]=b),b}function n(a,c,f){c||(c=b);if(j)return c.createElement(a);f||(f=m(c));var g;return f.cache[a]?g=f.cache[a].cloneNode():e.test(a)?g=(f.cache[a]=f.createElem(a)).cloneNode():g=f.createElem(a),g.canHaveChildren&&!d.test(a)?f.frag.appendChild(g):g}function o(a,c){a||(a=b);if(j)return a.createDocumentFragment();c=c||m(a);var d=c.frag.cloneNode(),e=0,f=l(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function p(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?n(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function q(a){a||(a=b);var c=m(a);return r.shivCSS&&!f&&!c.hasCSS&&(c.hasCSS=!!k(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),j||p(a,c),a}var c=a.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,e=/^<|^(?:a|b|button|code|div|fieldset|form|h1|h2|h3|h4|h5|h6|i|iframe|img|input|label|li|link|ol|option|p|param|q|script|select|span|strong|style|table|tbody|td|textarea|tfoot|th|thead|tr|ul)$/i,f,g="_html5shiv",h=0,i={},j;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",f="hidden"in a,j=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){f=!0,j=!0}})();var r={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,supportsUnknownElements:j,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:q,createElement:n,createDocumentFragment:o};a.html5=r,q(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.mq=z,e.testProp=function(a){return G([a])},e.testAllProps=I,e.testStyles=y,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+v.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};
/* jquery.touchSwipe.min.js */
(function(e){var o="left",n="right",d="up",v="down",c="in",w="out",l="none",r="auto",k="swipe",s="pinch",x="tap",i="doubletap",b="longtap",A="horizontal",t="vertical",h="all",q=10,f="start",j="move",g="end",p="cancel",a="ontouchstart" in window,y="TouchSwipe";var m={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,triggerOnTouchEnd:true,triggerOnTouchLeave:false,allowPageScroll:"auto",fallbackToMouseEvents:true,excludedElements:"button, input, select, textarea, a, .noSwipe"};e.fn.swipe=function(D){var C=e(this),B=C.data(y);if(B&&typeof D==="string"){if(B[D]){return B[D].apply(this,Array.prototype.slice.call(arguments,1))}else{e.error("Method "+D+" does not exist on jQuery.swipe")}}else{if(!B&&(typeof D==="object"||!D)){return u.apply(this,arguments)}}return C};e.fn.swipe.defaults=m;e.fn.swipe.phases={PHASE_START:f,PHASE_MOVE:j,PHASE_END:g,PHASE_CANCEL:p};e.fn.swipe.directions={LEFT:o,RIGHT:n,UP:d,DOWN:v,IN:c,OUT:w};e.fn.swipe.pageScroll={NONE:l,HORIZONTAL:A,VERTICAL:t,AUTO:r};e.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:h};function u(B){if(B&&(B.allowPageScroll===undefined&&(B.swipe!==undefined||B.swipeStatus!==undefined))){B.allowPageScroll=l}if(B.click!==undefined&&B.tap===undefined){B.tap=B.click}if(!B){B={}}B=e.extend({},e.fn.swipe.defaults,B);return this.each(function(){var D=e(this);var C=D.data(y);if(!C){C=new z(this,B);D.data(y,C)}})}function z(a0,aq){var av=(a||!aq.fallbackToMouseEvents),G=av?"touchstart":"mousedown",au=av?"touchmove":"mousemove",R=av?"touchend":"mouseup",P=av?null:"mouseleave",az="touchcancel";var ac=0,aL=null,Y=0,aX=0,aV=0,D=1,am=0,aF=0,J=null;var aN=e(a0);var W="start";var T=0;var aM=null;var Q=0,aY=0,a1=0,aa=0,K=0;var aS=null;try{aN.bind(G,aJ);aN.bind(az,a5)}catch(ag){e.error("events not supported "+G+","+az+" on jQuery.swipe")}this.enable=function(){aN.bind(G,aJ);aN.bind(az,a5);return aN};this.disable=function(){aG();return aN};this.destroy=function(){aG();aN.data(y,null);return aN};this.option=function(a8,a7){if(aq[a8]!==undefined){if(a7===undefined){return aq[a8]}else{aq[a8]=a7}}else{e.error("Option "+a8+" does not exist on jQuery.swipe.options")}};function aJ(a9){if(ax()){return}if(e(a9.target).closest(aq.excludedElements,aN).length>0){return}var ba=a9.originalEvent?a9.originalEvent:a9;var a8,a7=a?ba.touches[0]:ba;W=f;if(a){T=ba.touches.length}else{a9.preventDefault()}ac=0;aL=null;aF=null;Y=0;aX=0;aV=0;D=1;am=0;aM=af();J=X();O();if(!a||(T===aq.fingers||aq.fingers===h)||aT()){ae(0,a7);Q=ao();if(T==2){ae(1,ba.touches[1]);aX=aV=ap(aM[0].start,aM[1].start)}if(aq.swipeStatus||aq.pinchStatus){a8=L(ba,W)}}else{a8=false}if(a8===false){W=p;L(ba,W);return a8}else{ak(true)}}function aZ(ba){var bd=ba.originalEvent?ba.originalEvent:ba;if(W===g||W===p||ai()){return}var a9,a8=a?bd.touches[0]:bd;var bb=aD(a8);aY=ao();if(a){T=bd.touches.length}W=j;if(T==2){if(aX==0){ae(1,bd.touches[1]);aX=aV=ap(aM[0].start,aM[1].start)}else{aD(bd.touches[1]);aV=ap(aM[0].end,aM[1].end);aF=an(aM[0].end,aM[1].end)}D=a3(aX,aV);am=Math.abs(aX-aV)}if((T===aq.fingers||aq.fingers===h)||!a||aT()){aL=aH(bb.start,bb.end);ah(ba,aL);ac=aO(bb.start,bb.end);Y=aI();aE(aL,ac);if(aq.swipeStatus||aq.pinchStatus){a9=L(bd,W)}if(!aq.triggerOnTouchEnd||aq.triggerOnTouchLeave){var a7=true;if(aq.triggerOnTouchLeave){var bc=aU(this);a7=B(bb.end,bc)}if(!aq.triggerOnTouchEnd&&a7){W=ay(j)}else{if(aq.triggerOnTouchLeave&&!a7){W=ay(g)}}if(W==p||W==g){L(bd,W)}}}else{W=p;L(bd,W)}if(a9===false){W=p;L(bd,W)}}function I(a7){var a8=a7.originalEvent;if(a){if(a8.touches.length>0){C();return true}}if(ai()){T=aa}a7.preventDefault();aY=ao();Y=aI();if(a6()){W=p;L(a8,W)}else{if(aq.triggerOnTouchEnd||(aq.triggerOnTouchEnd==false&&W===j)){W=g;L(a8,W)}else{if(!aq.triggerOnTouchEnd&&a2()){W=g;aB(a8,W,x)}else{if(W===j){W=p;L(a8,W)}}}}ak(false)}function a5(){T=0;aY=0;Q=0;aX=0;aV=0;D=1;O();ak(false)}function H(a7){var a8=a7.originalEvent;if(aq.triggerOnTouchLeave){W=ay(g);L(a8,W)}}function aG(){aN.unbind(G,aJ);aN.unbind(az,a5);aN.unbind(au,aZ);aN.unbind(R,I);if(P){aN.unbind(P,H)}ak(false)}function ay(bb){var ba=bb;var a9=aw();var a8=aj();var a7=a6();if(!a9||a7){ba=p}else{if(a8&&bb==j&&(!aq.triggerOnTouchEnd||aq.triggerOnTouchLeave)){ba=g}else{if(!a8&&bb==g&&aq.triggerOnTouchLeave){ba=p}}}return ba}function L(a9,a7){var a8=undefined;if(F()||S()){a8=aB(a9,a7,k)}else{if((M()||aT())&&a8!==false){a8=aB(a9,a7,s)}}if(aC()&&a8!==false){a8=aB(a9,a7,i)}else{if(al()&&a8!==false){a8=aB(a9,a7,b)}else{if(ad()&&a8!==false){a8=aB(a9,a7,x)}}}if(a7===p){a5(a9)}if(a7===g){if(a){if(a9.touches.length==0){a5(a9)}}else{a5(a9)}}return a8}function aB(ba,a7,a9){var a8=undefined;if(a9==k){aN.trigger("swipeStatus",[a7,aL||null,ac||0,Y||0,T]);if(aq.swipeStatus){a8=aq.swipeStatus.call(aN,ba,a7,aL||null,ac||0,Y||0,T);if(a8===false){return false}}if(a7==g&&aR()){aN.trigger("swipe",[aL,ac,Y,T]);if(aq.swipe){a8=aq.swipe.call(aN,ba,aL,ac,Y,T);if(a8===false){return false}}switch(aL){case o:aN.trigger("swipeLeft",[aL,ac,Y,T]);if(aq.swipeLeft){a8=aq.swipeLeft.call(aN,ba,aL,ac,Y,T)}break;case n:aN.trigger("swipeRight",[aL,ac,Y,T]);if(aq.swipeRight){a8=aq.swipeRight.call(aN,ba,aL,ac,Y,T)}break;case d:aN.trigger("swipeUp",[aL,ac,Y,T]);if(aq.swipeUp){a8=aq.swipeUp.call(aN,ba,aL,ac,Y,T)}break;case v:aN.trigger("swipeDown",[aL,ac,Y,T]);if(aq.swipeDown){a8=aq.swipeDown.call(aN,ba,aL,ac,Y,T)}break}}}if(a9==s){aN.trigger("pinchStatus",[a7,aF||null,am||0,Y||0,T,D]);if(aq.pinchStatus){a8=aq.pinchStatus.call(aN,ba,a7,aF||null,am||0,Y||0,T,D);if(a8===false){return false}}if(a7==g&&a4()){switch(aF){case c:aN.trigger("pinchIn",[aF||null,am||0,Y||0,T,D]);if(aq.pinchIn){a8=aq.pinchIn.call(aN,ba,aF||null,am||0,Y||0,T,D)}break;case w:aN.trigger("pinchOut",[aF||null,am||0,Y||0,T,D]);if(aq.pinchOut){a8=aq.pinchOut.call(aN,ba,aF||null,am||0,Y||0,T,D)}break}}}if(a9==x){if(a7===p||a7===g){clearTimeout(aS);if(V()&&!E()){K=ao();aS=setTimeout(e.proxy(function(){K=null;aN.trigger("tap",[ba.target]);if(aq.tap){a8=aq.tap.call(aN,ba,ba.target)}},this),aq.doubleTapThreshold)}else{K=null;aN.trigger("tap",[ba.target]);if(aq.tap){a8=aq.tap.call(aN,ba,ba.target)}}}}else{if(a9==i){if(a7===p||a7===g){clearTimeout(aS);K=null;aN.trigger("doubletap",[ba.target]);if(aq.doubleTap){a8=aq.doubleTap.call(aN,ba,ba.target)}}}else{if(a9==b){if(a7===p||a7===g){clearTimeout(aS);K=null;aN.trigger("longtap",[ba.target]);if(aq.longTap){a8=aq.longTap.call(aN,ba,ba.target)}}}}}return a8}function aj(){var a7=true;if(aq.threshold!==null){a7=ac>=aq.threshold}return a7}function a6(){var a7=false;if(aq.cancelThreshold!==null&&aL!==null){a7=(aP(aL)-ac)>=aq.cancelThreshold}return a7}function ab(){if(aq.pinchThreshold!==null){return am>=aq.pinchThreshold}return true}function aw(){var a7;if(aq.maxTimeThreshold){if(Y>=aq.maxTimeThreshold){a7=false}else{a7=true}}else{a7=true}return a7}function ah(a7,a8){if(aq.allowPageScroll===l||aT()){a7.preventDefault()}else{var a9=aq.allowPageScroll===r;switch(a8){case o:if((aq.swipeLeft&&a9)||(!a9&&aq.allowPageScroll!=A)){a7.preventDefault()}break;case n:if((aq.swipeRight&&a9)||(!a9&&aq.allowPageScroll!=A)){a7.preventDefault()}break;case d:if((aq.swipeUp&&a9)||(!a9&&aq.allowPageScroll!=t)){a7.preventDefault()}break;case v:if((aq.swipeDown&&a9)||(!a9&&aq.allowPageScroll!=t)){a7.preventDefault()}break}}}function a4(){var a8=aK();var a7=U();var a9=ab();return a8&&a7&&a9}function aT(){return !!(aq.pinchStatus||aq.pinchIn||aq.pinchOut)}function M(){return !!(a4()&&aT())}function aR(){var ba=aw();var bc=aj();var a9=aK();var a7=U();var a8=a6();var bb=!a8&&a7&&a9&&bc&&ba;return bb}function S(){return !!(aq.swipe||aq.swipeStatus||aq.swipeLeft||aq.swipeRight||aq.swipeUp||aq.swipeDown)}function F(){return !!(aR()&&S())}function aK(){return((T===aq.fingers||aq.fingers===h)||!a)}function U(){return aM[0].end.x!==0}function a2(){return !!(aq.tap)}function V(){return !!(aq.doubleTap)}function aQ(){return !!(aq.longTap)}function N(){if(K==null){return false}var a7=ao();return(V()&&((a7-K)<=aq.doubleTapThreshold))}function E(){return N()}function at(){return((T===1||!a)&&(isNaN(ac)||ac===0))}function aW(){return((Y>aq.longTapThreshold)&&(ac<q))}function ad(){return !!(at()&&a2())}function aC(){return !!(N()&&V())}function al(){return !!(aW()&&aQ())}function C(){a1=ao();aa=event.touches.length+1}function O(){a1=0;aa=0}function ai(){var a7=false;if(a1){var a8=ao()-a1;if(a8<=aq.fingerReleaseThreshold){a7=true}}return a7}function ax(){return !!(aN.data(y+"_intouch")===true)}function ak(a7){if(a7===true){aN.bind(au,aZ);aN.bind(R,I);if(P){aN.bind(P,H)}}else{aN.unbind(au,aZ,false);aN.unbind(R,I,false);if(P){aN.unbind(P,H,false)}}aN.data(y+"_intouch",a7===true)}function ae(a8,a7){var a9=a7.identifier!==undefined?a7.identifier:0;aM[a8].identifier=a9;aM[a8].start.x=aM[a8].end.x=a7.pageX||a7.clientX;aM[a8].start.y=aM[a8].end.y=a7.pageY||a7.clientY;return aM[a8]}function aD(a7){var a9=a7.identifier!==undefined?a7.identifier:0;var a8=Z(a9);a8.end.x=a7.pageX||a7.clientX;a8.end.y=a7.pageY||a7.clientY;return a8}function Z(a8){for(var a7=0;a7<aM.length;a7++){if(aM[a7].identifier==a8){return aM[a7]}}}function af(){var a7=[];for(var a8=0;a8<=5;a8++){a7.push({start:{x:0,y:0},end:{x:0,y:0},identifier:0})}return a7}function aE(a7,a8){a8=Math.max(a8,aP(a7));J[a7].distance=a8}function aP(a7){return J[a7].distance}function X(){var a7={};a7[o]=ar(o);a7[n]=ar(n);a7[d]=ar(d);a7[v]=ar(v);return a7}function ar(a7){return{direction:a7,distance:0}}function aI(){return aY-Q}function ap(ba,a9){var a8=Math.abs(ba.x-a9.x);var a7=Math.abs(ba.y-a9.y);return Math.round(Math.sqrt(a8*a8+a7*a7))}function a3(a7,a8){var a9=(a8/a7)*1;return a9.toFixed(2)}function an(){if(D<1){return w}else{return c}}function aO(a8,a7){return Math.round(Math.sqrt(Math.pow(a7.x-a8.x,2)+Math.pow(a7.y-a8.y,2)))}function aA(ba,a8){var a7=ba.x-a8.x;var bc=a8.y-ba.y;var a9=Math.atan2(bc,a7);var bb=Math.round(a9*180/Math.PI);if(bb<0){bb=360-Math.abs(bb)}return bb}function aH(a8,a7){var a9=aA(a8,a7);if((a9<=45)&&(a9>=0)){return o}else{if((a9<=360)&&(a9>=315)){return o}else{if((a9>=135)&&(a9<=225)){return n}else{if((a9>45)&&(a9<135)){return v}else{return d}}}}}function ao(){var a7=new Date();return a7.getTime()}function aU(a7){a7=e(a7);var a9=a7.offset();var a8={left:a9.left,right:a9.left+a7.outerWidth(),top:a9.top,bottom:a9.top+a7.outerHeight()};return a8}function B(a7,a8){return(a7.x>a8.left&&a7.x<a8.right&&a7.y>a8.top&&a7.y<a8.bottom)}}})(jQuery);
/* jquery-ui-1.10.3.custom.min.js */
/*! jQuery UI - v1.10.3 - 2013-08-02
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.datepicker.js
* Copyright 2013 jQuery Foundation and other contributors Licensed MIT */

(function(e,t){function i(t,i){var a,n,r,o=t.nodeName.toLowerCase();return"area"===o?(a=t.parentNode,n=a.name,t.href&&n&&"map"===a.nodeName.toLowerCase()?(r=e("img[usemap=#"+n+"]")[0],!!r&&s(r)):!1):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var a=0,n=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var s,a,n=e(this[0]);n.length&&n[0]!==document;){if(s=n.css("position"),("absolute"===s||"relative"===s||"fixed"===s)&&(a=parseInt(n.css("zIndex"),10),!isNaN(a)&&0!==a))return a;n=n.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})},removeUniqueId:function(){return this.each(function(){n.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var s=e.attr(t,"tabindex"),a=isNaN(s);return(a||s>=0)&&i(t,!a)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,s){function a(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===s?["Left","Right"]:["Top","Bottom"],r=s.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+s]=function(i){return i===t?o["inner"+s].call(this):this.each(function(){e(this).css(r,a(this,i)+"px")})},e.fn["outer"+s]=function(t,i){return"number"!=typeof t?o["outer"+s].call(this,t):this.each(function(){e(this).css(r,a(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,s){var a,n=e.ui[t].prototype;for(a in s)n.plugins[a]=n.plugins[a]||[],n.plugins[a].push([i,s[a]])},call:function(e,t,i){var s,a=e.plugins[t];if(a&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(s=0;a.length>s;s++)e.options[a[s][0]]&&a[s][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",a=!1;return t[s]>0?!0:(t[s]=1,a=t[s]>0,t[s]=0,a)}})})(jQuery);(function(t,e){function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.dpDiv=s(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function s(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(i,"mouseout",function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",function(){t.datepicker._isDisabledDatepicker(a.inline?e.parent()[0]:a.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))})}function n(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}t.extend(t.ui,{datepicker:{version:"1.10.3"}});var a,r="datepicker";t.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return n(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,a;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),a=this._newInst(t(e),n),a.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,a):n&&this._inlineDatepicker(e,a)},_newInst:function(e,i){var n=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?s(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),t.data(e,r,i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,a,r=this._get(i,"appendText"),o=this._get(i,"isRTL");i.append&&i.append.remove(),r&&(i.append=t("<span class='"+this._appendClass+"'>"+r+"</span>"),e[o?"before":"after"](i.append)),e.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(a?t("<img/>").attr({src:a,alt:n,title:n}):n)),e[o?"before":"after"](i.trigger),i.trigger.click(function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,a=new Date(2009,11,20),r=this._get(t,"dateFormat");r.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},a.setMonth(e(this._get(t,r.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(e(this._get(t,r.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),t.input.attr("size",this._formatDate(t,a).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,r,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,a,o){var h,l,c,u,d,p=this._dialogInst;return p||(this.uuid+=1,h="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+h+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},t.data(this._dialogInput[0],r,p)),n(p.settings,a||{}),i=i&&i.constructor===Date?this._formatDate(p,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(l=document.documentElement.clientWidth,c=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+u,c/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],r,p),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,r);s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,r),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty())},_enableDatepicker:function(e){var i,s,n=t(e),a=t.data(e,r);n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),a=t.data(e,r);n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,r)}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(i,s,a){var r,o,h,l,c=this._getInst(i);return 2===arguments.length&&"string"==typeof s?"defaults"===s?t.extend({},t.datepicker._defaults):c?"all"===s?t.extend({},c.settings):this._get(c,s):null:(r=s||{},"string"==typeof s&&(r={},r[s]=a),c&&(this._curInst===c&&this._hideDatepicker(),o=this._getDateDatepicker(i,!0),h=this._getMinMaxDate(c,"min"),l=this._getMinMaxDate(c,"max"),n(c.settings,r),null!==h&&r.dateFormat!==e&&r.minDate===e&&(c.settings.minDate=this._formatDate(c,h)),null!==l&&r.dateFormat!==e&&r.maxDate===e&&(c.settings.maxDate=this._formatDate(c,l)),"disabled"in r&&(r.disabled?this._disableDatepicker(i):this._enableDatepicker(i)),this._attachments(t(i),c),this._autoSize(c),this._setDate(c,o),this._updateAlternate(c),this._updateDatepicker(c)),e)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,a=t.datepicker._getInst(e.target),r=!0,o=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),r=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",a.dpDiv),n[0]&&t.datepicker._selectDay(e.target,a.selectedMonth,a.selectedYear,n[0]),i=t.datepicker._get(a,"onSelect"),i?(s=t.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(a,"stepBigMonths"):-t.datepicker._get(a,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(a,"stepBigMonths"):+t.datepicker._get(a,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),r=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),r=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,o?1:-1,"D"),r=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(a,"stepBigMonths"):-t.datepicker._get(a,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),r=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,o?-1:1,"D"),r=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(a,"stepBigMonths"):+t.datepicker._get(a,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),r=e.ctrlKey||e.metaKey;break;default:r=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):r=!1;r&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(i){var s,n,a=t.datepicker._getInst(i.target);return t.datepicker._get(a,"constrainInput")?(s=t.datepicker._possibleChars(t.datepicker._get(a,"dateFormat")),n=String.fromCharCode(null==i.charCode?i.keyCode:i.charCode),i.ctrlKey||i.metaKey||" ">n||!s||s.indexOf(n)>-1):e},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var i,s,a,r,o,h,l;i=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==i&&(t.datepicker._curInst.dpDiv.stop(!0,!0),i&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),s=t.datepicker._get(i,"beforeShow"),a=s?s.apply(e,[e,i]):{},a!==!1&&(n(i.settings,a),i.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(i),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return r|="fixed"===t(this).css("position"),!r}),o={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(i),o=t.datepicker._checkOffset(i,o,r),i.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),i.inline||(h=t.datepicker._get(i,"showAnim"),l=t.datepicker._get(i,"duration"),i.dpDiv.zIndex(t(e).zIndex()+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[h]?i.dpDiv.show(h,t.datepicker._get(i,"showOptions"),l):i.dpDiv[h||"show"](h?l:null),t.datepicker._shouldFocusInput(i)&&i.input.focus(),t.datepicker._curInst=i))}},_updateDatepicker:function(e){this.maxRows=4,a=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i,s=this._getNumberOfMonths(e),n=s[1],r=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",r*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),a=e.dpDiv.outerHeight(),r=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-r:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+o?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+a>l&&l>a?Math.abs(a+o):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,a,o=this._curInst;!o||e&&o!==t.data(e,r)||this._datepickerShowing&&(i=this._get(o,"showAnim"),s=this._get(o,"duration"),n=function(){t.datepicker._tidyDialog(o)},t.effects&&(t.effects.effect[i]||t.effects[i])?o.dpDiv.hide(i,t.datepicker._get(o,"showOptions"),s,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===s?this._get(a,"showCurrentAtPos"):0),s),this._updateDatepicker(a))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),a=this._getInst(n[0]);a["selected"+("M"===s?"Month":"Year")]=a["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(e,i,s,n){var a,r=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(r[0])||(a=this._getInst(r[0]),a.selectedDay=a.currentDay=t("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(e,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),s=this._get(a,"onSelect"),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,a=this._get(e,"altField");a&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(a).each(function(){t(this).val(n)}))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(i,s,n){if(null==i||null==s)throw"Invalid arguments";if(s="object"==typeof s?""+s:s+"",""===s)return null;var a,r,o,h,l=0,c=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),d=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,p=(n?n.dayNames:null)||this._defaults.dayNames,f=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,m=(n?n.monthNames:null)||this._defaults.monthNames,g=-1,v=-1,_=-1,b=-1,y=!1,x=function(t){var e=i.length>a+1&&i.charAt(a+1)===t;return e&&a++,e},k=function(t){var e=x(t),i="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n=RegExp("^\\d{1,"+i+"}"),a=s.substring(l).match(n);if(!a)throw"Missing number at position "+l;return l+=a[0].length,parseInt(a[0],10)},w=function(i,n,a){var r=-1,o=t.map(x(i)?a:n,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(o,function(t,i){var n=i[1];return s.substr(l,n.length).toLowerCase()===n.toLowerCase()?(r=i[0],l+=n.length,!1):e}),-1!==r)return r+1;throw"Unknown name at position "+l},D=function(){if(s.charAt(l)!==i.charAt(a))throw"Unexpected literal at position "+l;l++};for(a=0;i.length>a;a++)if(y)"'"!==i.charAt(a)||x("'")?D():y=!1;else switch(i.charAt(a)){case"d":_=k("d");break;case"D":w("D",d,p);break;case"o":b=k("o");break;case"m":v=k("m");break;case"M":v=w("M",f,m);break;case"y":g=k("y");break;case"@":h=new Date(k("@")),g=h.getFullYear(),v=h.getMonth()+1,_=h.getDate();break;case"!":h=new Date((k("!")-this._ticksTo1970)/1e4),g=h.getFullYear(),v=h.getMonth()+1,_=h.getDate();break;case"'":x("'")?D():y=!0;break;default:D()}if(s.length>l&&(o=s.substr(l),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=g?0:-100)),b>-1)for(v=1,_=b;;){if(r=this._getDaysInMonth(g,v-1),r>=_)break;v++,_-=r}if(h=this._daylightSavingAdjust(new Date(g,v-1,_)),h.getFullYear()!==g||h.getMonth()+1!==v||h.getDate()!==_)throw"Invalid date";return h},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,r=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,o=(i?i.monthNames:null)||this._defaults.monthNames,h=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},l=function(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return h(t)?s[e]:i[e]},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,a);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),r,o);break;case"y":u+=h("y")?e.getFullYear():(10>e.getYear()%100?"0":"")+e.getYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,i){return t.settings[i]!==e?t.settings[i]:this._defaults[i]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),a=n,r=this._getFormatConfig(t);try{a=this.parseDate(i,s,r)||n}catch(o){s=e?"":s}t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),t.currentDay=s?a.getDate():0,t.currentMonth=s?a.getMonth():0,t.currentYear=s?a.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},a=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,a=n.getFullYear(),r=n.getMonth(),o=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":o+=parseInt(l[1],10);break;case"w":case"W":o+=7*parseInt(l[1],10);break;case"m":case"M":r+=parseInt(l[1],10),o=Math.min(o,t.datepicker._getDaysInMonth(a,r));break;case"y":case"Y":a+=parseInt(l[1],10),o=Math.min(o,t.datepicker._getDaysInMonth(a,r))}l=h.exec(i)}return new Date(a,r,o)},r=null==i||""===i?s:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return r=r&&"Invalid Date"==""+r?s:r,r&&(r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0)),this._daylightSavingAdjust(r)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,a=t.selectedYear,r=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=r.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=r.getMonth(),t.drawYear=t.selectedYear=t.currentYear=r.getFullYear(),n===t.selectedMonth&&a===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,a,r,o,h,l,c,u,d,p,f,m,g,v,_,b,y,x,k,w,D,T,C,M,S,N,I,P,A,z,H,E,F,O,W,j,R=new Date,L=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),Y=this._get(t,"isRTL"),B=this._get(t,"showButtonPanel"),J=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),Q=this._getNumberOfMonths(t),V=this._get(t,"showCurrentAtPos"),U=this._get(t,"stepMonths"),q=1!==Q[0]||1!==Q[1],X=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),G=this._getMinMaxDate(t,"min"),$=this._getMinMaxDate(t,"max"),Z=t.drawMonth-V,te=t.drawYear;if(0>Z&&(Z+=12,te--),$)for(e=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-Q[0]*Q[1]+1,$.getDate())),e=G&&G>e?G:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)Z--,0>Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-U,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":J?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+U,1)),this._getFormatConfig(t)):n,a=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":J?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",r=this._get(t,"currentText"),o=this._get(t,"gotoCurrent")&&t.currentDay?X:L,r=K?this.formatDate(r,o,this._getFormatConfig(t)):r,h=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=B?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(t,o)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+r+"</button>":"")+(Y?"":h)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),m=this._get(t,"monthNamesShort"),g=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),_=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;Q[0]>k;k++){for(w="",this.maxRows=4,D=0;Q[1]>D;D++){if(T=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),C=" ui-corner-all",M="",q){if(M+="<div class='ui-datepicker-group",Q[1]>1)switch(D){case 0:M+=" ui-datepicker-group-first",C=" ui-corner-"+(Y?"right":"left");break;case Q[1]-1:M+=" ui-datepicker-group-last",C=" ui-corner-"+(Y?"left":"right");break;default:M+=" ui-datepicker-group-middle",C=""}M+="'>"}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+C+"'>"+(/all|left/.test(C)&&0===k?Y?a:s:"")+(/all|right/.test(C)&&0===k?Y?s:a:"")+this._generateMonthYearHeader(t,Z,te,G,$,k>0||D>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",S=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",x=0;7>x;x++)N=(x+c)%7,S+="<th"+((x+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[N]+"'>"+p[N]+"</span></th>";for(M+=S+"</tr></thead><tbody>",I=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,I)),P=(this._getFirstDayOfMonth(te,Z)-c+7)%7,A=Math.ceil((P+I)/7),z=q?this.maxRows>A?this.maxRows:A:A,this.maxRows=z,H=this._daylightSavingAdjust(new Date(te,Z,1-P)),E=0;z>E;E++){for(M+="<tr>",F=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(H)+"</td>":"",x=0;7>x;x++)O=g?g.apply(t.input?t.input[0]:null,[H]):[!0,""],W=H.getMonth()!==Z,j=W&&!_||!O[0]||G&&G>H||$&&H>$,F+="<td class='"+((x+c+6)%7>=5?" ui-datepicker-week-end":"")+(W?" ui-datepicker-other-month":"")+(H.getTime()===T.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===H.getTime()&&b.getTime()===T.getTime()?" "+this._dayOverClass:"")+(j?" "+this._unselectableClass+" ui-state-disabled":"")+(W&&!v?"":" "+O[1]+(H.getTime()===X.getTime()?" "+this._currentClass:"")+(H.getTime()===L.getTime()?" ui-datepicker-today":""))+"'"+(W&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(j?"":" data-handler='selectDay' data-event='click' data-month='"+H.getMonth()+"' data-year='"+H.getFullYear()+"'")+">"+(W&&!v?"&#xa0;":j?"<span class='ui-state-default'>"+H.getDate()+"</span>":"<a class='ui-state-default"+(H.getTime()===L.getTime()?" ui-state-highlight":"")+(H.getTime()===X.getTime()?" ui-state-active":"")+(W?" ui-priority-secondary":"")+"' href='#'>"+H.getDate()+"</a>")+"</td>",H.setDate(H.getDate()+1),H=this._daylightSavingAdjust(H);M+=F+"</tr>"}Z++,Z>11&&(Z=0,te++),M+="</tbody></table>"+(q?"</div>"+(Q[0]>0&&D===Q[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),w+=M}y+=w}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,a,r,o){var h,l,c,u,d,p,f,m,g=this._get(t,"changeMonth"),v=this._get(t,"changeYear"),_=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(a||!g)y+="<span class='ui-datepicker-month'>"+r[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+o[c]+"</option>");y+="</select>"}if(_||(b+=y+(!a&&g&&v?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);
return isNaN(e)?d:e},f=p(u[0]),m=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),_&&(b+=(!a&&g&&v?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.drawYear+("Y"===i?e:0),n=t.drawMonth+("M"===i?e:0),a=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),r=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,a)));t.selectedDay=r.getDate(),t.drawMonth=t.selectedMonth=r.getMonth(),t.drawYear=t.selectedYear=r.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),a=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(t,a)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),a=this._getMinMaxDate(t,"max"),r=null,o=null,h=this._get(t,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),r=parseInt(i[0],10),o=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(r+=s),i[1].match(/[+\-].*/)&&(o+=s)),(!n||e.getTime()>=n.getTime())&&(!a||e.getTime()<=a.getTime())&&(!r||e.getFullYear()>=r)&&(!o||o>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new i,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.10.3"})(jQuery);
/* jquery-plugins-combined.js */
/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1
 * to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 * 
 * Open source under the BSD License. 
 * 
 * Copyright © 2008 George McGinley Smith
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
*/
/*
 *
 * TERMS OF USE - EASING EQUATIONS
 * 
 * Open source under the BSD License. 
 * 
 * Copyright © 2001 Robert Penner
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
 */
// t: current time, b: begInnIng value, c: change In value, d: duration
jQuery.easing['jswing'] = jQuery.easing['swing'];

jQuery.extend( jQuery.easing,
{
	def: 'easeOutQuad',
	swing: function (x, t, b, c, d) {
		//alert(jQuery.easing.default);
		return jQuery.easing[jQuery.easing.def](x, t, b, c, d);
	},
	easeInQuad: function (x, t, b, c, d) {
		return c*(t/=d)*t + b;
	},
	easeOutQuad: function (x, t, b, c, d) {
		return -c *(t/=d)*(t-2) + b;
	},
	easeInOutQuad: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t + b;
		return -c/2 * ((--t)*(t-2) - 1) + b;
	},
	easeInCubic: function (x, t, b, c, d) {
		return c*(t/=d)*t*t + b;
	},
	easeOutCubic: function (x, t, b, c, d) {
		return c*((t=t/d-1)*t*t + 1) + b;
	},
	easeInOutCubic: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t + b;
		return c/2*((t-=2)*t*t + 2) + b;
	},
	easeInQuart: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t + b;
	},
	easeOutQuart: function (x, t, b, c, d) {
		return -c * ((t=t/d-1)*t*t*t - 1) + b;
	},
	easeInOutQuart: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
		return -c/2 * ((t-=2)*t*t*t - 2) + b;
	},
	easeInQuint: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t*t + b;
	},
	easeOutQuint: function (x, t, b, c, d) {
		return c*((t=t/d-1)*t*t*t*t + 1) + b;
	},
	easeInOutQuint: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
		return c/2*((t-=2)*t*t*t*t + 2) + b;
	},
	easeInSine: function (x, t, b, c, d) {
		return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
	},
	easeOutSine: function (x, t, b, c, d) {
		return c * Math.sin(t/d * (Math.PI/2)) + b;
	},
	easeInOutSine: function (x, t, b, c, d) {
		return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
	},
	easeInExpo: function (x, t, b, c, d) {
		return (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;
	},
	easeOutExpo: function (x, t, b, c, d) {
		return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
	},
	easeInOutExpo: function (x, t, b, c, d) {
		if (t==0) return b;
		if (t==d) return b+c;
		if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;
		return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;
	},
	easeInCirc: function (x, t, b, c, d) {
		return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;
	},
	easeOutCirc: function (x, t, b, c, d) {
		return c * Math.sqrt(1 - (t=t/d-1)*t) + b;
	},
	easeInOutCirc: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;
		return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;
	},
	easeInElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
	},
	easeOutElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;
	},
	easeInOutElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
		return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;
	},
	easeInBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		return c*(t/=d)*t*((s+1)*t - s) + b;
	},
	easeOutBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
	},
	easeInOutBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158; 
		if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
		return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
	},
	easeInBounce: function (x, t, b, c, d) {
		return c - jQuery.easing.easeOutBounce (x, d-t, 0, c, d) + b;
	},
	easeOutBounce: function (x, t, b, c, d) {
		if ((t/=d) < (1/2.75)) {
			return c*(7.5625*t*t) + b;
		} else if (t < (2/2.75)) {
			return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
		} else if (t < (2.5/2.75)) {
			return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
		} else {
			return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
		}
	},
	easeInOutBounce: function (x, t, b, c, d) {
		if (t < d/2) return jQuery.easing.easeInBounce (x, t*2, 0, c, d) * .5 + b;
		return jQuery.easing.easeOutBounce (x, t*2-d, 0, c, d) * .5 + c*.5 + b;
	}
});
 
 
 // version 1.5.0
// http://welcome.totheinter.net/columnizer-jquery-plugin/
// created by: Adam Wulf @adamwulf, adam.wulf@gmail.com
// edited by: Marcy Sutton @marcysutton @popagency (removed inline CSS)

(function($){

 $.fn.columnize = function(options) {


	var defaults = {
		// default width of columns
		width: 400,
		// optional # of columns instead of width
		columns : false,
		// true to build columns once regardless of window resize
		// false to rebuild when content box changes bounds
		buildOnce : false,
		// an object with options if the text should overflow
		// it's container if it can't fit within a specified height
		overflow : false,
		// this function is called after content is columnized
		doneFunc : function(){},
		// if the content should be columnized into a 
		// container node other than it's own node
		target : false,
		// re-columnizing when images reload might make things
		// run slow. so flip this to true if it's causing delays
		ignoreImageLoading : true,
		// should columns float left or right
		columnFloat : "left",
		// ensure the last column is never the tallest column
		lastNeverTallest : false,
		// (int) the minimum number of characters to jump when splitting
		// text nodes. smaller numbers will result in higher accuracy
		// column widths, but will take slightly longer
		accuracy : false
	};
	var options = $.extend(defaults, options);
	
	if(typeof(options.width) == "string"){
		options.width = parseInt(options.width);
		if(isNaN(options.width)){
			options.width = defaults.width;
		}
	}

    return this.each(function() {
	    var $inBox = options.target ? $(options.target) : $(this);
		var maxHeight = $(this).height();
		var $cache = $('<div></div>'); // this is where we'll put the real content
		var lastWidth = 0;
		var columnizing = false;
		
		var adjustment = 0;
		
		$cache.append($(this).contents().clone(true));
	    
	    // images loading after dom load
	    // can screw up the column heights,
	    // so recolumnize after images load
	    if(!options.ignoreImageLoading && !options.target){
	    	if(!$inBox.data("imageLoaded")){
		    	$inBox.data("imageLoaded", true);
		    	if($(this).find("img").length > 0){
		    		// only bother if there are
		    		// actually images...
			    	var func = function($inBox,$cache){ return function(){
				    	if(!$inBox.data("firstImageLoaded")){
				    		$inBox.data("firstImageLoaded", "true");
					    	$inBox.empty().append($cache.children().clone(true));
					    	$inBox.columnize(options);
				    	}
			    	}}($(this), $cache);
				    $(this).find("img").one("load", func);
				    $(this).find("img").one("abort", func);
				    return;
		    	}
	    	}
	    }
	    
		$inBox.empty();
		
		columnizeIt();
		
		if(!options.buildOnce){
			$(window).resize(function() {
				if(!options.buildOnce && $.browser.msie){
					if($inBox.data("timeout")){
						clearTimeout($inBox.data("timeout"));
					}
					$inBox.data("timeout", setTimeout(columnizeIt, 200));
				}else if(!options.buildOnce){
					columnizeIt();
				}else{
					// don't rebuild
				}
			});
		}
		
		/**
		 * return a node that has a height
		 * less than or equal to height
		 *
		 * @param putInHere, a dom element
		 * @$pullOutHere, a jQuery element
		 */
		function columnize($putInHere, $pullOutHere, $parentColumn, height){
			while($parentColumn.height() < height &&
				  $pullOutHere[0].childNodes.length){
				$putInHere.append($pullOutHere[0].childNodes[0]);
			}
			if($putInHere[0].childNodes.length == 0) return;
			
			// now we're too tall, undo the last one
			var kids = $putInHere[0].childNodes;
			var lastKid = kids[kids.length-1];
			$putInHere[0].removeChild(lastKid);
			var $item = $(lastKid);
			
			
			if($item[0].nodeType == 3){
				// it's a text node, split it up
				var oText = $item[0].nodeValue;
				var counter2 = options.width / 18;
				if(options.accuracy)
				counter2 = options.accuracy;
				var columnText;
				var latestTextNode = null;
				while($parentColumn.height() < height && oText.length){
					if (oText.indexOf(' ', counter2) != '-1') {
						columnText = oText.substring(0, oText.indexOf(' ', counter2));
					} else {
						columnText = oText;
					}
					latestTextNode = document.createTextNode(columnText);
					$putInHere.append(latestTextNode);
					
					if(oText.length > counter2){
						oText = oText.substring(oText.indexOf(' ', counter2));
					}else{
						oText = "";
					}
				}
				if($parentColumn.height() >= height && latestTextNode != null){
					// too tall :(
					$putInHere[0].removeChild(latestTextNode);
					oText = latestTextNode.nodeValue + oText;
				}
				if(oText.length){
					$item[0].nodeValue = oText;
				}else{
					return false; // we ate the whole text node, move on to the next node
				}
			}
			
			if($pullOutHere.children().length){
				$pullOutHere.prepend($item);
			}else{
				$pullOutHere.append($item);
			}
			
			return $item[0].nodeType == 3;
		}
		
		function split($putInHere, $pullOutHere, $parentColumn, height){
			if($pullOutHere.children().length){
				$cloneMe = $pullOutHere.children(":first");
				$clone = $cloneMe.clone(true);
				if($clone.prop("nodeType") == 1 && !$clone.hasClass("dontend")){ 
					$putInHere.append($clone);
					if($clone.is("img") && $parentColumn.height() < height + 20){
						$cloneMe.remove();
					}else if(!$cloneMe.hasClass("dontsplit") && $parentColumn.height() < height + 20){
						$cloneMe.remove();
					}else if($clone.is("img") || $cloneMe.hasClass("dontsplit")){
						$clone.remove();
					}else{
						$clone.empty();
						if(!columnize($clone, $cloneMe, $parentColumn, height)){
							if($cloneMe.children().length){
								split($clone, $cloneMe, $parentColumn, height);
							}
						}
						if($clone.get(0).childNodes.length == 0){
							// it was split, but nothing is in it :(
							$clone.remove();
						}
					}
				}
			}
		}
		
		
		function singleColumnizeIt() {
			if ($inBox.data("columnized") && $inBox.children().length == 1) {
				return;
			}
			$inBox.data("columnized", true);
			$inBox.data("columnizing", true);
			
			$inBox.empty();
			$inBox.append($("<div class='first last column' style='width:100%; float: " + options.columnFloat + ";'></div>")); //"
			$col = $inBox.children().eq($inBox.children().length-1);
			$destroyable = $cache.clone(true);
			if(options.overflow){
				targetHeight = options.overflow.height;
				columnize($col, $destroyable, $col, targetHeight);
				// make sure that the last item in the column isn't a "dontend"
				if(!$destroyable.contents().find(":first-child").hasClass("dontend")){
					split($col, $destroyable, $col, targetHeight);
				}
				
				while(checkDontEndColumn($col.children(":last").length && $col.children(":last").get(0))){
					var $lastKid = $col.children(":last");
					$lastKid.remove();
					$destroyable.prepend($lastKid);
				}

				var html = "";
				var div = document.createElement('DIV');
				while($destroyable[0].childNodes.length > 0){
					var kid = $destroyable[0].childNodes[0];
					for(var i=0;i<kid.attributes.length;i++){
						if(kid.attributes[i].nodeName.indexOf("jQuery") == 0){
							kid.removeAttribute(kid.attributes[i].nodeName);
						}
					}
					div.innerHTML = "";
					div.appendChild($destroyable[0].childNodes[0]);
					html += div.innerHTML;
				}
				var overflow = $(options.overflow.id)[0];
				overflow.innerHTML = html;

			}else{
				$col.append($destroyable);
			}
			$inBox.data("columnizing", false);
			
			if(options.overflow){
				options.overflow.doneFunc();
			}
			
		}
		
		function checkDontEndColumn(dom){
			if(dom.nodeType != 1) return false;
			if($(dom).hasClass("dontend")) return true;
			if(dom.childNodes.length == 0) return false;
			return checkDontEndColumn(dom.childNodes[dom.childNodes.length-1]);
		}
		
		function columnizeIt() {
			if(lastWidth == $inBox.width()) return;
			lastWidth = $inBox.width();
			
			var numCols = Math.round($inBox.width() / options.width);
			if(options.columns) numCols = options.columns;
//			if ($inBox.data("columnized") && numCols == $inBox.children().length) {
//				return;
//			}
			if(numCols <= 1){
				return singleColumnizeIt();
			}
			if($inBox.data("columnizing")) return;
			$inBox.data("columnized", true);
			$inBox.data("columnizing", true);
			
			$inBox.empty();
			$inBox.append($("<div style='width:" + (Math.floor(100 / numCols))+ "%; float: " + options.columnFloat + ";'></div>")); //"
			$col = $inBox.children(":last");
			$col.append($cache.clone());
			maxHeight = $col.height();
			$inBox.empty();
			
			var targetHeight = maxHeight / numCols;
			var firstTime = true;
			var maxLoops = 3;
			var scrollHorizontally = false;
			if(options.overflow){
				maxLoops = 1;
				targetHeight = options.overflow.height;
			}else if(options.height && options.width){
				maxLoops = 1;
				targetHeight = options.height;
				scrollHorizontally = true;
			}
			
			for(var loopCount=0;loopCount<maxLoops;loopCount++){
				$inBox.empty();
				var $destroyable;
				try{
					$destroyable = $cache.clone(true);
				}catch(e){
					// jquery in ie6 can't clone with true
					$destroyable = $cache.clone();
				}
				$destroyable.css("visibility", "hidden");
				// create the columns
				for (var i = 0; i < numCols; i++) {
					/* create column */
					var className = (i == 0) ? "first column" : "column";
					var className = (i == numCols - 1) ? ("last " + className) : className;
					$inBox.append($("<div class='" + className + "'></div>")); //"
				}
				
				// fill all but the last column (unless overflowing)
				var i = 0;
				while(i < numCols - (options.overflow ? 0 : 1) || scrollHorizontally && $destroyable.contents().length){
					if($inBox.children().length <= i){
						// we ran out of columns, make another
						$inBox.append($("<div class='" + className + "'></div>")); //"
					}
					var $col = $inBox.children().eq(i);
					columnize($col, $destroyable, $col, targetHeight);
					// make sure that the last item in the column isn't a "dontend"
					if(!$destroyable.contents().find(":first-child").hasClass("dontend")){
						split($col, $destroyable, $col, targetHeight);
					}else{
//						alert("not splitting a dontend");
					}
					
					while(checkDontEndColumn($col.children(":last").length && $col.children(":last").get(0))){
						var $lastKid = $col.children(":last");
						$lastKid.remove();
						$destroyable.prepend($lastKid);
					}
					i++;
				}
				if(options.overflow && !scrollHorizontally){
					var IE6 = false /*@cc_on || @_jscript_version < 5.7 @*/;
					var IE7 = (document.all) && (navigator.appVersion.indexOf("MSIE 7.") != -1);
					if(IE6 || IE7){
						var html = "";
						var div = document.createElement('DIV');
						while($destroyable[0].childNodes.length > 0){
							var kid = $destroyable[0].childNodes[0];
							for(var i=0;i<kid.attributes.length;i++){
								if(kid.attributes[i].nodeName.indexOf("jQuery") == 0){
									kid.removeAttribute(kid.attributes[i].nodeName);
								}
							}
							div.innerHTML = "";
							div.appendChild($destroyable[0].childNodes[0]);
							html += div.innerHTML;
						}
						var overflow = $(options.overflow.id)[0];
						overflow.innerHTML = html;
					}else{
						$(options.overflow.id).empty().append($destroyable.contents().clone(true));
					}
				}else if(!scrollHorizontally){
					// the last column in the series
					$col = $inBox.children().eq($inBox.children().length-1);
					while($destroyable.contents().length) $col.append($destroyable.contents(":first"));
					var afterH = $col.height();
					var diff = afterH - targetHeight;
					var totalH = 0;
					var min = 10000000;
					var max = 0;
					var lastIsMax = false;
					$inBox.children().each(function($inBox){ return function($item){
						var h = $inBox.children().eq($item).height();
						lastIsMax = false;
						totalH += h;
						if(h > max) {
							max = h;
							lastIsMax = true;
						}
						if(h < min) min = h;
					}}($inBox));

					var avgH = totalH / numCols;
					if(options.lastNeverTallest && lastIsMax){
						// the last column is the tallest
						// so allow columns to be taller
						// and retry
						adjustment += 30;
						if(adjustment < 100){
							targetHeight = targetHeight + 30;
							if(loopCount == maxLoops-1) maxLoops++;
						}else{
							debugger;
							loopCount = maxLoops;
						}
					}else if(max - min > 30){
						// too much variation, try again
						targetHeight = avgH + 30;
					}else if(Math.abs(avgH-targetHeight) > 20){
						// too much variation, try again
						targetHeight = avgH;
					}else {
						// solid, we're done
						loopCount = maxLoops;
					}
				}else{
					// it's scrolling horizontally, fix the width/classes of the columns
					$inBox.children().each(function(i){
						$col = $inBox.children().eq(i);
						$col.width(options.width + "px");
						if(i==0){
							$col.addClass("first");
						}else if(i==$inBox.children().length-1){
							$col.addClass("last");
						}else{
							$col.removeClass("first");
							$col.removeClass("last");
						}
					});
					$inBox.width($inBox.children().length * options.width + "px");
				}
				$inBox.append($("<br style='clear:both;'>"));
			}
			$inBox.find('.column').find(':first.removeiffirst').remove();
			$inBox.find('.column').find(':last.removeiflast').remove();
			$inBox.data("columnizing", false);

			if(options.overflow){
				options.overflow.doneFunc();
			}
			options.doneFunc();
		}
    });
 };
})(jQuery);



 /*! http://mths.be/placeholder v2.0.7 by @mathias */
;(function(f,h,$){var a='placeholder' in h.createElement('input'),d='placeholder' in h.createElement('textarea'),i=$.fn,c=$.valHooks,k,j;if(a&&d){j=i.placeholder=function(){return this};j.input=j.textarea=true}else{j=i.placeholder=function(){var l=this;l.filter((a?'textarea':':input')+'[placeholder]').not('.placeholder').bind({'focus.placeholder':b,'blur.placeholder':e}).data('placeholder-enabled',true).trigger('blur.placeholder');return l};j.input=a;j.textarea=d;k={get:function(m){var l=$(m);return l.data('placeholder-enabled')&&l.hasClass('placeholder')?'':m.value},set:function(m,n){var l=$(m);if(!l.data('placeholder-enabled')){return m.value=n}if(n==''){m.value=n;if(m!=h.activeElement){e.call(m)}}else{if(l.hasClass('placeholder')){b.call(m,true,n)||(m.value=n)}else{m.value=n}}return l}};a||(c.input=k);d||(c.textarea=k);$(function(){$(h).delegate('form','submit.placeholder',function(){var l=$('.placeholder',this).each(b);setTimeout(function(){l.each(e)},10)})});$(f).bind('beforeunload.placeholder',function(){$('.placeholder').each(function(){this.value=''})})}function g(m){var l={},n=/^jQuery\d+$/;$.each(m.attributes,function(p,o){if(o.specified&&!n.test(o.name)){l[o.name]=o.value}});return l}function b(m,n){var l=this,o=$(l);if(l.value==o.attr('placeholder')&&o.hasClass('placeholder')){if(o.data('placeholder-password')){o=o.hide().next().show().attr('id',o.removeAttr('id').data('placeholder-id'));if(m===true){return o[0].value=n}o.focus()}else{l.value='';o.removeClass('placeholder');l==h.activeElement&&l.select()}}}function e(){var q,l=this,p=$(l),m=p,o=this.id;if(l.value==''){if(l.type=='password'){if(!p.data('placeholder-textinput')){try{q=p.clone().attr({type:'text'})}catch(n){q=$('<input>').attr($.extend(g(this),{type:'text'}))}q.removeAttr('name').data({'placeholder-password':true,'placeholder-id':o}).bind('focus.placeholder',b);p.data({'placeholder-textinput':q,'placeholder-id':o}).before(q)}p=p.removeAttr('id').hide().prev().attr('id',o).show()}p.addClass('placeholder');p[0].value=p.attr('placeholder')}else{p.removeClass('placeholder')}}}(this,document,jQuery));

/* JSON.js */
if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());

/* Store.js */
/* Copyright (c) 2010-2012 Marcus Westin */
(function(){function u(){try{return r in t&&t[r]}catch(e){return!1}}function a(){try{return i in t&&t[i]&&t[i][t.location.hostname]}catch(e){return!1}}var e={},t=window,n=t.document,r="localStorage",i="globalStorage",s="__storejs__",o;e.disabled=!1,e.set=function(e,t){},e.get=function(e){},e.remove=function(e){},e.clear=function(){},e.transact=function(t,n,r){var i=e.get(t);r==null&&(r=n,n=null),typeof i=="undefined"&&(i=n||{}),r(i),e.set(t,i)},e.getAll=function(){},e.serialize=function(e){return JSON.stringify(e)},e.deserialize=function(e){return typeof e!="string"?undefined:JSON.parse(e)};if(u())o=t[r],e.set=function(t,n){if(n===undefined)return e.remove(t);o.setItem(t,e.serialize(n))},e.get=function(t){return e.deserialize(o.getItem(t))},e.remove=function(e){o.removeItem(e)},e.clear=function(){o.clear()},e.getAll=function(){var t={};for(var n=0;n<o.length;++n){var r=o.key(n);t[r]=e.get(r)}return t};else if(a())o=t[i][t.location.hostname],e.set=function(t,n){if(n===undefined)return e.remove(t);o[t]=e.serialize(n)},e.get=function(t){return e.deserialize(o[t]&&o[t].value)},e.remove=function(e){delete o[e]},e.clear=function(){for(var e in o)delete o[e]},e.getAll=function(){var t={};for(var n=0;n<o.length;++n){var r=o.key(n);t[r]=e.get(r)}return t};else if(n.documentElement.addBehavior){var f,l;try{l=new ActiveXObject("htmlfile"),l.open(),l.write('<script>document.w=window</script><iframe src="/favicon.ico"></frame>'),l.close(),f=l.w.frames[0].document,o=f.createElement("div")}catch(c){o=n.createElement("div"),f=n.body}function h(t){return function(){var n=Array.prototype.slice.call(arguments,0);n.unshift(o),f.appendChild(o),o.addBehavior("#default#userData"),o.load(r);var i=t.apply(e,n);return f.removeChild(o),i}}function p(e){return"_"+e}e.set=h(function(t,n,i){n=p(n);if(i===undefined)return e.remove(n);t.setAttribute(n,e.serialize(i)),t.save(r)}),e.get=h(function(t,n){return n=p(n),e.deserialize(t.getAttribute(n))}),e.remove=h(function(e,t){t=p(t),e.removeAttribute(t),e.save(r)}),e.clear=h(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(r);for(var n=0,i;i=t[n];n++)e.removeAttribute(i.name);e.save(r)}),e.getAll=h(function(t){var n=t.XMLDocument.documentElement.attributes;t.load(r);var i={};for(var s=0,o;o=n[s];++s)i[o]=e.get(o);return i})}try{e.set(s,s),e.get(s)!=s&&(e.disabled=!0),e.remove(s)}catch(c){e.disabled=!0}e.enabled=!e.disabled,typeof module!="undefined"&&typeof module!="function"?module.exports=e:typeof define=="function"&&define.amd?define(e):this.store=e})();

/*! Overthrow v.0.1.0. An overflow:auto polyfill for responsive design. (c) 2012: Scott Jehl, Filament Group, Inc. http://filamentgroup.github.com/Overthrow/license.txt */
(function( w, undefined ){
	
	var doc = w.document,
		docElem = doc.documentElement,
		classtext = "overthrow-enabled",
	
		// Touch events are used in the polyfill, and thus are a prerequisite
		canBeFilledWithPoly = "ontouchmove" in doc,
		
		// The following attempts to determine whether the browser has native overflow support
		// so we can enable it but not polyfill
		overflowProbablyAlreadyWorks = 
			// Features-first. iOS5 overflow scrolling property check - no UA needed here. thanks Apple :)
			"WebkitOverflowScrolling" in docElem.style ||
			// Touch events aren't supported and screen width is greater than X
			// ...basically, this is a loose "desktop browser" check. 
			// It may wrongly opt-in very large tablets with no touch support.
			( !canBeFilledWithPoly && w.screen.width > 1200 ) ||
			// Hang on to your hats.
			// Whitelist some popular, overflow-supporting mobile browsers for now and the future
			// These browsers are known to get overlow support right, but give us no way of detecting it.
			(function(){
				var ua = w.navigator.userAgent,
					// Webkit crosses platforms, and the browsers on our list run at least version 534
					webkit = ua.match( /AppleWebKit\/([0-9]+)/ ),
					wkversion = webkit && webkit[1],
					wkLte534 = webkit && wkversion >= 534;
					
				return (
					/* Android 3+ with webkit gte 534
					~: Mozilla/5.0 (Linux; U; Android 3.0; en-us; Xoom Build/HRI39) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13 */
					ua.match( /Android ([0-9]+)/ ) && RegExp.$1 >= 3 && wkLte534 ||
					/* Blackberry 7+ with webkit gte 534
					~: Mozilla/5.0 (BlackBerry; U; BlackBerry 9900; en-US) AppleWebKit/534.11+ (KHTML, like Gecko) Version/7.0.0 Mobile Safari/534.11+ */
					ua.match( / Version\/([0-9]+)/ ) && RegExp.$1 >= 0 && w.blackberry && wkLte534 ||
					/* Blackberry Playbook with webkit gte 534
					~: Mozilla/5.0 (PlayBook; U; RIM Tablet OS 1.0.0; en-US) AppleWebKit/534.8+ (KHTML, like Gecko) Version/0.0.1 Safari/534.8+ */   
					ua.indexOf( /PlayBook/ ) > -1 && RegExp.$1 >= 0 && wkLte534 ||
					/* Firefox Mobile (Fennec) 4 and up
					~: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:2.1.1) Gecko/ Firefox/4.0.2pre Fennec/4.0. */
					ua.match( /Fennec\/([0-9]+)/ ) && RegExp.$1 >= 4 ||
					/* WebOS 3 and up (TouchPad too)
					~: Mozilla/5.0 (hp-tablet; Linux; hpwOS/3.0.0; U; en-US) AppleWebKit/534.6 (KHTML, like Gecko) wOSBrowser/233.48 Safari/534.6 TouchPad/1.0 */
					ua.match( /wOSBrowser\/([0-9]+)/ ) && RegExp.$1 >= 233 && wkLte534 ||
					/* Nokia Browser N8
					~: Mozilla/5.0 (Symbian/3; Series60/5.2 NokiaN8-00/012.002; Profile/MIDP-2.1 Configuration/CLDC-1.1 ) AppleWebKit/533.4 (KHTML, like Gecko) NokiaBrowser/7.3.0 Mobile Safari/533.4 3gpp-gba 
					~: Note: the N9 doesn't have native overflow with one-finger touch. wtf */
					ua.match( /NokiaBrowser\/([0-9\.]+)/ ) && parseFloat(RegExp.$1) === 7.3 && webkit && wkversion >= 533
				);
			})(),
			
		// Easing can use any of Robert Penner's equations (http://www.robertpenner.com/easing_terms_of_use.html). By default, overthrow includes ease-out-cubic
		// arguments: t = current iteration, b = initial value, c = end value, d = total iterations
		// use w.overthrow.easing to provide a custom function externally, or pass an easing function as a callback to the toss method
		defaultEasing = function (t, b, c, d) {
			return c*((t=t/d-1)*t*t + 1) + b;
		},	
			
		enabled = false,
		
		// Keeper of intervals
		timeKeeper,
				
		/* toss scrolls and element with easing
		
		// elem is the element to scroll
		// options hash:
			* left is the desired horizontal scroll. Default is "+0". For relative distances, pass a string with "+" or "-" in front.
			* top is the desired vertical scroll. Default is "+0". For relative distances, pass a string with "+" or "-" in front.
			* duration is the number of milliseconds the throw will take. Default is 100.
			* easing is an optional custom easing function. Default is w.overthrow.easing. Must follow the easing function signature 
		*/
		toss = function( elem, options ){
			var i = 0,
				sLeft = elem.scrollLeft,
				sTop = elem.scrollTop,
				// Toss defaults
				o = {
					top: "+0",
					left: "+0",
					duration: 100,
					easing: w.overthrow.easing
				},
				endLeft, endTop;
			
			// Mixin based on predefined defaults
			if( options ){
				for( var j in o ){
					if( options[ j ] !== undefined ){
						o[ j ] = options[ j ];
					}
				}
			}
			
			// Convert relative values to ints
			// First the left val
			if( typeof o.left === "string" ){
				o.left = parseFloat( o.left );
				endLeft = o.left + sLeft;
			}
			else {
				endLeft = o.left;
				o.left = o.left - sLeft;
			}
			// Then the top val
			if( typeof o.top === "string" ){
				o.top = parseFloat( o.top );
				endTop = o.top + sTop;
			}
			else {
				endTop = o.top;
				o.top = o.top - sTop;
			}

			timeKeeper = setInterval(function(){					
				if( i++ < o.duration ){
					elem.scrollLeft = o.easing( i, sLeft, o.left, o.duration );
					elem.scrollTop = o.easing( i, sTop, o.top, o.duration );
				}
				else{
					if( endLeft !== elem.scrollLeft ){
						elem.scrollLeft = endLeft;
					}
					if( endTop !== elem.scrollTop ){
						elem.scrollTop = endTop;
					}
					intercept();
				}
			}, 1 );
			
			// Return the values, post-mixin, with end values specified
			return { top: endTop, left: endLeft, duration: o.duration, easing: o.easing };
		},
		
		// find closest overthrow (elem or a parent)
		closest = function( target, ascend ){
			return !ascend && target.className && target.className.indexOf( "overthrow" ) > -1 && target || closest( target.parentNode );
		},
				
		// Intercept any throw in progress
		intercept = function(){
			clearInterval( timeKeeper );
		},
			
		// Enable and potentially polyfill overflow
		enable = function(){
				
			// If it's on, 
			if( enabled ){
				return;
			}
			// It's on.
			enabled = true;
				
			// If overflowProbablyAlreadyWorks or at least the element canBeFilledWithPoly, add a class to cue CSS that assumes overflow scrolling will work (setting height on elements and such)
			if( overflowProbablyAlreadyWorks || canBeFilledWithPoly ){
				docElem.className += " " + classtext;
			}
				
			// Destroy everything later. If you want to.
			w.overthrow.forget = function(){
				// Strip the class name from docElem
				docElem.className = docElem.className.replace( classtext, "" );
				// Remove touch binding (check for method support since this part isn't qualified by touch support like the rest)
				if( doc.removeEventListener ){
					doc.removeEventListener( "touchstart", start, false );
				}
				// reset easing to default
				w.overthrow.easing = defaultEasing;
				
				// Let 'em know
				enabled = false;
			};
	
			// If overflowProbablyAlreadyWorks or it doesn't look like the browser canBeFilledWithPoly, our job is done here. Exit viewport left.
			if( overflowProbablyAlreadyWorks || !canBeFilledWithPoly ){
				return;
			}

			// Fill 'er up!
			// From here down, all logic is associated with touch scroll handling
				// elem references the overthrow element in use
			var elem,
				
				// The last several Y values are kept here
				lastTops = [],
		
				// The last several X values are kept here
				lastLefts = [],
				
				// lastDown will be true if the last scroll direction was down, false if it was up
				lastDown,
				
				// lastRight will be true if the last scroll direction was right, false if it was left
				lastRight,
				
				// For a new gesture, or change in direction, reset the values from last scroll
				resetVertTracking = function(){
					lastTops = [];
					lastDown = null;
				},
				
				resetHorTracking = function(){
					lastLefts = [];
					lastRight = null;
				},
				
				// After releasing touchend, throw the overthrow element, depending on momentum
				finishScroll = function(){
					// Come up with a distance and duration based on how 
					// Multipliers are tweaked to a comfortable balance across platforms
					var top = ( lastTops[ 0 ] - lastTops[ lastTops.length -1 ] ) * 8,
						left = ( lastLefts[ 0 ] - lastLefts[ lastLefts.length -1 ] ) * 8,
						duration = Math.max( Math.abs( left ), Math.abs( top ) ) / 8;
					
					// Make top and left relative-style strings (positive vals need "+" prefix)
					top = ( top > 0 ? "+" : "" ) + top;
					left = ( left > 0 ? "+" : "" ) + left;
					
					// Make sure there's a significant amount of throw involved, otherwise, just stay still
					if( !isNaN( duration ) && duration > 0 && ( Math.abs( left ) > 80 || Math.abs( top ) > 80 ) ){
						toss( elem, { left: left, top: top, duration: duration } );
					}
				},
			
				// On webkit, touch events hardly trickle through textareas and inputs
				// Disabling CSS pointer events makes sure they do, but it also makes the controls innaccessible
				// Toggling pointer events at the right moments seems to do the trick
				// Thanks Thomas Bachem http://stackoverflow.com/a/5798681 for the following
				inputs,
				setPointers = function( val ){
					inputs = elem.querySelectorAll( "textarea, input" );
					for( var i = 0, il = inputs.length; i < il; i++ ) {
						inputs[ i ].style.pointerEvents = val;
					}
				},
				
				// For nested overthrows, changeScrollTarget restarts a touch event cycle on a parent or child overthrow
				changeScrollTarget = function( startEvent, ascend ){
					if( doc.createEvent ){
						var newTarget = ( !ascend || ascend === undefined ) && elem.parentNode || elem.touchchild || elem,
							tEnd;
								
						if( newTarget !== elem ){
							tEnd = doc.createEvent( "HTMLEvents" );
							tEnd.initEvent( "touchend", true, true );
							elem.dispatchEvent( tEnd );
							newTarget.touchchild = elem;
							elem = newTarget;
							newTarget.dispatchEvent( startEvent );
						}
					}
				},
				
				// Touchstart handler
				// On touchstart, touchmove and touchend are freshly bound, and all three share a bunch of vars set by touchstart
				// Touchend unbinds them again, until next time
				start = function( e ){
					
					// Stop any throw in progress
					intercept();
					
					// Reset the distance and direction tracking
					resetVertTracking();
					resetHorTracking();
						
					elem = closest( e.target );
						
					if( !elem || elem === docElem || e.touches.length > 1 ){
						return;
					}			

					setPointers( "none" );
					var touchStartE = e,
						scrollT = elem.scrollTop,
						scrollL = elem.scrollLeft,
						height = elem.offsetHeight,
						width = elem.offsetWidth,
						startY = e.touches[ 0 ].pageY,
						startX = e.touches[ 0 ].pageX,
						scrollHeight = elem.scrollHeight,
						scrollWidth = elem.scrollWidth,
					
						// Touchmove handler
						move = function( e ){
						
							var ty = scrollT + startY - e.touches[ 0 ].pageY,
								tx = scrollL + startX - e.touches[ 0 ].pageX,
								down = ty >= ( lastTops.length ? lastTops[ 0 ] : 0 ),
								right = tx >= ( lastLefts.length ? lastLefts[ 0 ] : 0 );
								
							// If there's room to scroll the current container, prevent the default window scroll
							if( ( ty > 0 && ty < scrollHeight - height ) || ( tx > 0 && tx < scrollWidth - width ) ){
								e.preventDefault();
							}
							// This bubbling is dumb. Needs a rethink.
							else {
								changeScrollTarget( touchStartE );
							}
							
							// If down and lastDown are inequal, the y scroll has changed direction. Reset tracking.
							if( lastDown && down !== lastDown ){
								resetVertTracking();
							}
							
							// If right and lastRight are inequal, the x scroll has changed direction. Reset tracking.
							if( lastRight && right !== lastRight ){
								resetHorTracking();
							}
							
							// remember the last direction in which we were headed
							lastDown = down;
							lastRight = right;							
							
							// set the container's scroll
							elem.scrollTop = ty;
							elem.scrollLeft = tx;
						
							lastTops.unshift( ty );
							lastLefts.unshift( tx );
						
							if( lastTops.length > 3 ){
								lastTops.pop();
							}
							if( lastLefts.length > 3 ){
								lastLefts.pop();
							}
						},
					
						// Touchend handler
						end = function( e ){
							// Apply momentum based easing for a graceful finish
							finishScroll();	
							// Bring the pointers back
							setPointers( "auto" );
							setTimeout( function(){
								setPointers( "none" );
							}, 450 );
							elem.removeEventListener( "touchmove", move, false );
							elem.removeEventListener( "touchend", end, false );
						};
					
					elem.addEventListener( "touchmove", move, false );
					elem.addEventListener( "touchend", end, false );
				};
				
			// Bind to touch, handle move and end within
			doc.addEventListener( "touchstart", start, false );
		};
		
	// Expose overthrow API
	w.overthrow = {
		set: enable,
		forget: function(){},
		easing: defaultEasing,
		toss: toss,
		intercept: intercept,
		closest: closest,
		support: overflowProbablyAlreadyWorks ? "native" : canBeFilledWithPoly && "polyfilled" || "none"
	};
	
	// Auto-init
	enable();
		
})( this );
/* jquery.validate.min.js */
/**
 * jQuery Validation Plugin 1.9.0
 *
 * http://bassistance.de/jquery-plugins/jquery-plugin-validation/
 * http://docs.jquery.com/Plugins/Validation
 *
 * Copyright (c) 2006 - 2011 Jörn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(c){c.extend(c.fn,{validate:function(a){if(this.length){var b=c.data(this[0],"validator");if(b)return b;this.attr("novalidate","novalidate");b=new c.validator(a,this[0]);c.data(this[0],"validator",b);if(b.settings.onsubmit){a=this.find("input, button");a.filter(".cancel").click(function(){b.cancelSubmit=true});b.settings.submitHandler&&a.filter(":submit").click(function(){b.submitButton=this});this.submit(function(d){function e(){if(b.settings.submitHandler){if(b.submitButton)var f=c("<input type='hidden'/>").attr("name",
b.submitButton.name).val(b.submitButton.value).appendTo(b.currentForm);b.settings.submitHandler.call(b,b.currentForm);b.submitButton&&f.remove();return false}return true}b.settings.debug&&d.preventDefault();if(b.cancelSubmit){b.cancelSubmit=false;return e()}if(b.form()){if(b.pendingRequest){b.formSubmitted=true;return false}return e()}else{b.focusInvalid();return false}})}return b}else a&&a.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing")},valid:function(){if(c(this[0]).is("form"))return this.validate().form();
else{var a=true,b=c(this[0].form).validate();this.each(function(){a&=b.element(this)});return a}},removeAttrs:function(a){var b={},d=this;c.each(a.split(/\s/),function(e,f){b[f]=d.attr(f);d.removeAttr(f)});return b},rules:function(a,b){var d=this[0];if(a){var e=c.data(d.form,"validator").settings,f=e.rules,g=c.validator.staticRules(d);switch(a){case "add":c.extend(g,c.validator.normalizeRule(b));f[d.name]=g;if(b.messages)e.messages[d.name]=c.extend(e.messages[d.name],b.messages);break;case "remove":if(!b){delete f[d.name];
return g}var h={};c.each(b.split(/\s/),function(j,i){h[i]=g[i];delete g[i]});return h}}d=c.validator.normalizeRules(c.extend({},c.validator.metadataRules(d),c.validator.classRules(d),c.validator.attributeRules(d),c.validator.staticRules(d)),d);if(d.required){e=d.required;delete d.required;d=c.extend({required:e},d)}return d}});c.extend(c.expr[":"],{blank:function(a){return!c.trim(""+a.value)},filled:function(a){return!!c.trim(""+a.value)},unchecked:function(a){return!a.checked}});c.validator=function(a,
b){this.settings=c.extend(true,{},c.validator.defaults,a);this.currentForm=b;this.init()};c.validator.format=function(a,b){if(arguments.length==1)return function(){var d=c.makeArray(arguments);d.unshift(a);return c.validator.format.apply(this,d)};if(arguments.length>2&&b.constructor!=Array)b=c.makeArray(arguments).slice(1);if(b.constructor!=Array)b=[b];c.each(b,function(d,e){a=a.replace(RegExp("\\{"+d+"\\}","g"),e)});return a};c.extend(c.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",
validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:c([]),errorLabelContainer:c([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(a){this.lastActive=a;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(a)).hide()}},onfocusout:function(a){if(!this.checkable(a)&&(a.name in this.submitted||!this.optional(a)))this.element(a)},
onkeyup:function(a){if(a.name in this.submitted||a==this.lastElement)this.element(a)},onclick:function(a){if(a.name in this.submitted)this.element(a);else a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(a,b,d){a.type==="radio"?this.findByName(a.name).addClass(b).removeClass(d):c(a).addClass(b).removeClass(d)},unhighlight:function(a,b,d){a.type==="radio"?this.findByName(a.name).removeClass(b).addClass(d):c(a).removeClass(b).addClass(d)}},setDefaults:function(a){c.extend(c.validator.defaults,
a)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:c.validator.format("Please enter no more than {0} characters."),
minlength:c.validator.format("Please enter at least {0} characters."),rangelength:c.validator.format("Please enter a value between {0} and {1} characters long."),range:c.validator.format("Please enter a value between {0} and {1}."),max:c.validator.format("Please enter a value less than or equal to {0}."),min:c.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){function a(e){var f=c.data(this[0].form,"validator"),g="on"+e.type.replace(/^validate/,
"");f.settings[g]&&f.settings[g].call(f,this[0],e)}this.labelContainer=c(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||c(this.currentForm);this.containers=c(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var b=this.groups={};c.each(this.settings.groups,function(e,f){c.each(f.split(/\s/),function(g,h){b[h]=e})});var d=
this.settings.rules;c.each(d,function(e,f){d[e]=c.validator.normalizeRule(f)});c(this.currentForm).validateDelegate("[type='text'], [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",a).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",
a);this.settings.invalidHandler&&c(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){this.checkForm();c.extend(this.submitted,this.errorMap);this.invalid=c.extend({},this.errorMap);this.valid()||c(this.currentForm).triggerHandler("invalid-form",[this]);this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(a){this.lastElement=
a=this.validationTargetFor(this.clean(a));this.prepareElement(a);this.currentElements=c(a);var b=this.check(a);if(b)delete this.invalid[a.name];else this.invalid[a.name]=true;if(!this.numberOfInvalids())this.toHide=this.toHide.add(this.containers);this.showErrors();return b},showErrors:function(a){if(a){c.extend(this.errorMap,a);this.errorList=[];for(var b in a)this.errorList.push({message:a[b],element:this.findByName(b)[0]});this.successList=c.grep(this.successList,function(d){return!(d.name in a)})}this.settings.showErrors?
this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){c.fn.resetForm&&c(this.currentForm).resetForm();this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(a){var b=0,d;for(d in a)b++;return b},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==
0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{c(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(a){}},findLastActive:function(){var a=this.lastActive;return a&&c.grep(this.errorList,function(b){return b.element.name==a.name}).length==1&&a},elements:function(){var a=this,b={};return c(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&
a.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!a.objectLength(c(this).rules()))return false;return b[this.name]=true})},clean:function(a){return c(a)[0]},errors:function(){return c(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=c([]);this.toHide=c([]);this.currentElements=c([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},
prepareElement:function(a){this.reset();this.toHide=this.errorsFor(a)},check:function(a){a=this.validationTargetFor(this.clean(a));var b=c(a).rules(),d=false,e;for(e in b){var f={method:e,parameters:b[e]};try{var g=c.validator.methods[e].call(this,a.value.replace(/\r/g,""),a,f.parameters);if(g=="dependency-mismatch")d=true;else{d=false;if(g=="pending"){this.toHide=this.toHide.not(this.errorsFor(a));return}if(!g){this.formatAndAdd(a,f);return false}}}catch(h){this.settings.debug&&window.console&&console.log("exception occured when checking element "+
a.id+", check the '"+f.method+"' method",h);throw h;}}if(!d){this.objectLength(b)&&this.successList.push(a);return true}},customMetaMessage:function(a,b){if(c.metadata){var d=this.settings.meta?c(a).metadata()[this.settings.meta]:c(a).metadata();return d&&d.messages&&d.messages[b]}},customMessage:function(a,b){var d=this.settings.messages[a];return d&&(d.constructor==String?d:d[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(arguments[a]!==undefined)return arguments[a]},defaultMessage:function(a,
b){return this.findDefined(this.customMessage(a.name,b),this.customMetaMessage(a,b),!this.settings.ignoreTitle&&a.title||undefined,c.validator.messages[b],"<strong>Warning: No message defined for "+a.name+"</strong>")},formatAndAdd:function(a,b){var d=this.defaultMessage(a,b.method),e=/\$?\{(\d+)\}/g;if(typeof d=="function")d=d.call(this,b.parameters,a);else if(e.test(d))d=jQuery.format(d.replace(e,"{$1}"),b.parameters);this.errorList.push({message:d,element:a});this.errorMap[a.name]=d;this.submitted[a.name]=
d},addWrapper:function(a){if(this.settings.wrapper)a=a.add(a.parent(this.settings.wrapper));return a},defaultShowErrors:function(){for(var a=0;this.errorList[a];a++){var b=this.errorList[a];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass);this.showLabel(b.element,b.message)}if(this.errorList.length)this.toShow=this.toShow.add(this.containers);if(this.settings.success)for(a=0;this.successList[a];a++)this.showLabel(this.successList[a]);
if(this.settings.unhighlight){a=0;for(b=this.validElements();b[a];a++)this.settings.unhighlight.call(this,b[a],this.settings.errorClass,this.settings.validClass)}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return c(this.errorList).map(function(){return this.element})},showLabel:function(a,b){var d=this.errorsFor(a);if(d.length){d.removeClass(this.settings.validClass).addClass(this.settings.errorClass);
d.attr("generated")&&d.html(b)}else{d=c("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(a),generated:true}).addClass(this.settings.errorClass).html(b||"");if(this.settings.wrapper)d=d.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();this.labelContainer.append(d).length||(this.settings.errorPlacement?this.settings.errorPlacement(d,c(a)):d.insertAfter(a))}if(!b&&this.settings.success){d.text("");typeof this.settings.success=="string"?d.addClass(this.settings.success):this.settings.success(d)}this.toShow=
this.toShow.add(d)},errorsFor:function(a){var b=this.idOrName(a);return this.errors().filter(function(){return c(this).attr("for")==b})},idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},validationTargetFor:function(a){if(this.checkable(a))a=this.findByName(a.name).not(this.settings.ignore)[0];return a},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(a){var b=this.currentForm;return c(document.getElementsByName(a)).map(function(d,
e){return e.form==b&&e.name==a&&e||null})},getLength:function(a,b){switch(b.nodeName.toLowerCase()){case "select":return c("option:selected",b).length;case "input":if(this.checkable(b))return this.findByName(b.name).filter(":checked").length}return a.length},depend:function(a,b){return this.dependTypes[typeof a]?this.dependTypes[typeof a](a,b):true},dependTypes:{"boolean":function(a){return a},string:function(a,b){return!!c(a,b.form).length},"function":function(a,b){return a(b)}},optional:function(a){return!c.validator.methods.required.call(this,
c.trim(a.value),a)&&"dependency-mismatch"},startRequest:function(a){if(!this.pending[a.name]){this.pendingRequest++;this.pending[a.name]=true}},stopRequest:function(a,b){this.pendingRequest--;if(this.pendingRequest<0)this.pendingRequest=0;delete this.pending[a.name];if(b&&this.pendingRequest==0&&this.formSubmitted&&this.form()){c(this.currentForm).submit();this.formSubmitted=false}else if(!b&&this.pendingRequest==0&&this.formSubmitted){c(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=
false}},previousValue:function(a){return c.data(a,"previousValue")||c.data(a,"previousValue",{old:null,valid:true,message:this.defaultMessage(a,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(a,b){a.constructor==String?this.classRuleSettings[a]=b:c.extend(this.classRuleSettings,
a)},classRules:function(a){var b={};(a=c(a).attr("class"))&&c.each(a.split(" "),function(){this in c.validator.classRuleSettings&&c.extend(b,c.validator.classRuleSettings[this])});return b},attributeRules:function(a){var b={};a=c(a);for(var d in c.validator.methods){var e;if(e=d==="required"&&typeof c.fn.prop==="function"?a.prop(d):a.attr(d))b[d]=e;else if(a[0].getAttribute("type")===d)b[d]=true}b.maxlength&&/-1|2147483647|524288/.test(b.maxlength)&&delete b.maxlength;return b},metadataRules:function(a){if(!c.metadata)return{};
var b=c.data(a.form,"validator").settings.meta;return b?c(a).metadata()[b]:c(a).metadata()},staticRules:function(a){var b={},d=c.data(a.form,"validator");if(d.settings.rules)b=c.validator.normalizeRule(d.settings.rules[a.name])||{};return b},normalizeRules:function(a,b){c.each(a,function(d,e){if(e===false)delete a[d];else if(e.param||e.depends){var f=true;switch(typeof e.depends){case "string":f=!!c(e.depends,b.form).length;break;case "function":f=e.depends.call(b,b)}if(f)a[d]=e.param!==undefined?
e.param:true;else delete a[d]}});c.each(a,function(d,e){a[d]=c.isFunction(e)?e(b):e});c.each(["minlength","maxlength","min","max"],function(){if(a[this])a[this]=Number(a[this])});c.each(["rangelength","range"],function(){if(a[this])a[this]=[Number(a[this][0]),Number(a[this][1])]});if(c.validator.autoCreateRanges){if(a.min&&a.max){a.range=[a.min,a.max];delete a.min;delete a.max}if(a.minlength&&a.maxlength){a.rangelength=[a.minlength,a.maxlength];delete a.minlength;delete a.maxlength}}a.messages&&delete a.messages;
return a},normalizeRule:function(a){if(typeof a=="string"){var b={};c.each(a.split(/\s/),function(){b[this]=true});a=b}return a},addMethod:function(a,b,d){c.validator.methods[a]=b;c.validator.messages[a]=d!=undefined?d:c.validator.messages[a];b.length<3&&c.validator.addClassRules(a,c.validator.normalizeRule(a))},methods:{required:function(a,b,d){if(!this.depend(d,b))return"dependency-mismatch";switch(b.nodeName.toLowerCase()){case "select":return(a=c(b).val())&&a.length>0;case "input":if(this.checkable(b))return this.getLength(a,
b)>0;default:return c.trim(a).length>0}},remote:function(a,b,d){if(this.optional(b))return"dependency-mismatch";var e=this.previousValue(b);this.settings.messages[b.name]||(this.settings.messages[b.name]={});e.originalMessage=this.settings.messages[b.name].remote;this.settings.messages[b.name].remote=e.message;d=typeof d=="string"&&{url:d}||d;if(this.pending[b.name])return"pending";if(e.old===a)return e.valid;e.old=a;var f=this;this.startRequest(b);var g={};g[b.name]=a;c.ajax(c.extend(true,{url:d,
mode:"abort",port:"validate"+b.name,dataType:"json",data:g,success:function(h){f.settings.messages[b.name].remote=e.originalMessage;var j=h===true;if(j){var i=f.formSubmitted;f.prepareElement(b);f.formSubmitted=i;f.successList.push(b);f.showErrors()}else{i={};h=h||f.defaultMessage(b,"remote");i[b.name]=e.message=c.isFunction(h)?h(a):h;f.showErrors(i)}e.valid=j;f.stopRequest(b,j)}},d));return"pending"},minlength:function(a,b,d){return this.optional(b)||this.getLength(c.trim(a),b)>=d},maxlength:function(a,
b,d){return this.optional(b)||this.getLength(c.trim(a),b)<=d},rangelength:function(a,b,d){a=this.getLength(c.trim(a),b);return this.optional(b)||a>=d[0]&&a<=d[1]},min:function(a,b,d){return this.optional(b)||a>=d},max:function(a,b,d){return this.optional(b)||a<=d},range:function(a,b,d){return this.optional(b)||a>=d[0]&&a<=d[1]},email:function(a,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)},
url:function(a,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
date:function(a,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(a))},dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)},number:function(a,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},creditcard:function(a,b){if(this.optional(b))return"dependency-mismatch";if(/[^0-9 -]+/.test(a))return false;var d=0,e=0,f=false;a=a.replace(/\D/g,"");for(var g=a.length-1;g>=
0;g--){e=a.charAt(g);e=parseInt(e,10);if(f)if((e*=2)>9)e-=9;d+=e;f=!f}return d%10==0},accept:function(a,b,d){d=typeof d=="string"?d.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||a.match(RegExp(".("+d+")$","i"))},equalTo:function(a,b,d){d=c(d).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){c(b).valid()});return a==d.val()}}});c.format=c.validator.format})(jQuery);
(function(c){var a={};if(c.ajaxPrefilter)c.ajaxPrefilter(function(d,e,f){e=d.port;if(d.mode=="abort"){a[e]&&a[e].abort();a[e]=f}});else{var b=c.ajax;c.ajax=function(d){var e=("port"in d?d:c.ajaxSettings).port;if(("mode"in d?d:c.ajaxSettings).mode=="abort"){a[e]&&a[e].abort();return a[e]=b.apply(this,arguments)}return b.apply(this,arguments)}}})(jQuery);
(function(c){!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(e){e=c.event.fix(e);e.type=b;return c.event.handle.call(this,e)}c.event.special[b]={setup:function(){this.addEventListener(a,d,true)},teardown:function(){this.removeEventListener(a,d,true)},handler:function(e){arguments[0]=c.event.fix(e);arguments[0].type=b;return c.event.handle.apply(this,arguments)}}});c.extend(c.fn,{validateDelegate:function(a,
b,d){return this.bind(b,function(e){var f=c(e.target);if(f.is(a))return d.apply(f,arguments)})}})})(jQuery);

/* OverlayMod.js */
/**
 * Show an overlay (modal/layer) on click of the matched element(s).
 * 
 * There are 3 ways to instantiate an overlay using this plugin:
 * 
 * 1. Use an anchor element with a class of `modal` or `layer` and a properly formatted `href` attribute. The plugin automatically looks for these classes.
 * 
 * 2. Calling the plugin on an element or elements and passing an `options` object.
 * 
 * 3. Using the `$.overlay.load()` method and passing in an `options` object. These cases are few but this method can come in handy when you need to open an overlay without a user clicking a target element or from another function's callback handler.
 * 
 * 
 * @example
 * <a class="modal" href="url/to/the/content-file.php">Some Text</a>
 * @title Instantiation Method #1
 * @syntax html
 * @desc Instantiation using an anchor's `href` attribute to configure options. For the fully default implementation, all that is needed is the location of the content file in the `href`.
 * The anchor's `class` can determined whether the overlay is a modal (background blocking curtain) or layer (no curtain). For modals use class="modal" and for layers, class="layer".
 * 
 * @example
 * $('.some-class').overlay({
 *      content: 'url/to/the/content-file.php',
 * });
 * @title Instantiation Method #2
 * @syntax javascript
 * @desc Instantiation using an options object. For the fully default implementation (modal by default), all that is needed is the location of the `content` file.
 * 
 * 
 * @example
 * $.overlay.load({
 *      content: 'url/to/the/content-file.php'
 * });
 * @title Instantiation Method #3
 * @syntax javascript
 * @desc Initiation an overlay using the `$.overlay.load()` method and an options object. For the fully default implementation (modal by default), all that is needed is the location of the `content` file. This loads the overlay as soon as the code is evaluated. You should wrap this in a callback to an event.
 * 
 * 
 * @example
 * <a class="layer" href="url/to/the/content-file.php?overlayId=myLayer&position=#primary&closeLink=false&validation=false">Some Text</a>
 * @title Instantiate a layer using the html-only method with more options. 
 * @syntax html
 * @desc The options will submitted via a query string in the anchor's `href` attribute:
 * - ID of `#myLayer`.
 * - positioned relative to the target's `#primary` parent element
 * - content url via `href`'s standard url
 * - No close link
 * - No form validation
 * 
 * 
 * @example
 * $('#some-button').bind('click', function() {
 *     var target = $(e.currentTarget);
 *     $.overlay.preventDuplicate(target);
 *     // some code that eventually calls $.overlay.load();
 * });
 * @syntax javascript
 * @title Use of `$.overlay.preventDuplicate()` to prevent multiple clicks on an overlay target
 * @desc Users can accidentally click more than once on an overlay button or link and receive a javascript exception that causes them to navigate to a raw html page. The Overlay framework handles this when the element uses the auto instantiation methods. But there are cases where we need to open an overlay programatically using `$.overlay.load()` (adding an item to cart for example). In these cases `$.overlay.preventDuplicate();` checks to see if the `target` param has the overlay active class. If so, an exception is thrown. The `target` param can be any DOM node, css selector or jQuery object. `target` must refer to the element that triggers the overlay.
 * 
 * 
 * 
 * @example
 * $('body').delegate('#some-overlay-id', 'overlay-before-show', function(event) {
 *     var overlay = this;
 *     // Do something...
 * });
 * @title Overlay Custom Events: `overlay-before-show`
 * @syntax javascript
 * @desc Fires on the overlay element stored in the `$.overlay.currentOverlay` property once it has been appended to the `body` element.
 * External scripts that need to bind a `submit` event to the overlay's form elements to overide the default `submit` event should use this event.
 * 
 * 
 * @example
 * $('body').delegate('#some-overlay-id', 'overlay-show', function(event) {
 *     var overlay = this;
 *     // Do something...
 * });
 * @title Overlay Custom Events: `overlay-show`
 * @syntax javascript
 * @desc Fires on the overlay element stored in the `$.overlay.currentOverlay` property once it has been animated into view or its content have been updated via ajax.
 * 
 * 
 * @example
 * $('body').delegate('#some-overlay-id', 'overlay-before-hide', function(event) {
 *     var overlay = this;
 *     // Do something...
 * });
 * @title Overlay Custom Events: `overlay-before-hide`
 * @syntax javascript
 * @desc Fires on the overlay element stored in the `$.overlay.currentOverlay` property just before it closes.
 * 
 * 
 * @example
 * $('body').bind('overlay-hide', function(event, overlayId) {
 *     if(overlayId === '#some-id') {
 *         // Do something...
 *     }
 * });
 * @title Overlay Custom Events: `overlay-hide`
 * @syntax javascript
 * @desc Fires on the `body` element once the `$.overlay.currentOverlay` property has been set to `false`.
 * The event handler receives the `id` of the removed overlay as a String (with the `#` character).
 * 
 * 
 * @example
 * $('body').delegate('#some-overlay-id', 'overlay-before-show', function(event) {
 *     $(this).find('form').bind('pausesubmit.overlay', function(event) {
 *         var form = $(this);
 *         // Do something...
 *         form.trigger('resumesubmit.overlay');
 *  	});
 * });
 * @title Overlay Custom Events: `pausesubmit.overlay`
 * @syntax javascript
 * @desc If this event is set on the overlay's `form` element, its handler will be called before the `submit` event occurs. 
 * This is useful if an external script needs to have access to the `form` on `submit` but does not need to override the default `submit` event.
 * Notice: Once your handler has finished its execution it must trigger the `resumesubmit.overlay` event on the form. This signals the default `submit` process to resume. This is needed in case the handler needs to wait for an ajax request or animation to finish.
 * External scripts need to use this in combination with the `overlay-before-show` event.
 * 
 * 
 * @example
 * // On start of a event/update
 * $.overlay.currentOverlay.trigger('overlay-loading');
 * 
 * // After the event/update is complete
 * $.overlay.currentOverlay.trigger('overlay-show');
 * @title Overlay Custom Events: `overlay-loading`
 * @syntax javascript
 * @desc Activate a loading animation and blocking curtain. By default, this is triggered during any automatic `AJAX` update inside an overlay. For any custom events/updates that the Overlay Framework does not track, use this event to inform the user that a request is happening and protect the overlay content from mouse interaction.
 * 
 * 
 * @example
 * $.overlay.currentOverlay.trigger('close.overlay', [true]);
 * @title Overlay Custom Events: `close.overlay`
 * @syntax javascript
 * @desc Force an overlay to close. Triggering this event runs the same routine as when a user clicks a close/cancel button/link. Note: An array with the first index value set to `true` must be passed as the second argument to make sure the original `target` regains focus. This is not needed if in an overlay flow.
 * 
 * 
 * @example
 * <a href="#close" class="close" title="Close this overlay to return to the previous section">Close</a>
 * @title Providing Alternate User Actions to Close an Overlay
 * @syntax html
 * @desc To give a user an alternate method to close an overlay, simply apply an `id` or `class` of `close` to a clickable element.
 * 
 * 
 * @example
 * $.overlay.load({
 * 	  content: 'url/to/the/content-file.php',
 * 	  intercept: function(response) {
 * 	      if(response.errorFields === '') {
 * 	          // No errors!
 * 	          return response;
 * 	      } else {
 * 	          return false;
 * 	      }
 * 	  }
 * });
 * @title Use of `intercept` to Validate Response Object
 * @syntax javascript
 * @desc `intercept` is a pre-callback that allows you to validate the response object before it is sent to the overlay. Use this to validate data returned from server to determine whether overlay should be shown. The response object is passed as the only argument and must be `json`. `return false` in the function to cancel the overlay, `return` the `response` to show the overlay.
 * Notice: The response `json` should have the following properties: `errors`, and `overlayOptions`. If the errors need to be injected into the form, the prop should contain a properly formatted object for the validator to use: `{'input-name-attr': 'The error message'}`. The `overlayOptions` prop should contain an object with at least the `html` prop that holds the content to be displayed in the overlay should there be no errors. If other keys in the `overlayOptions` object match any overlay options (`overlayType: 'modal'` for example), they will be used to update the overlay's options before it is shown.
 * 
 * 
 * @example 
 * // Check to see if a specific overlay is open
 * if($.overlay.activeOverlay) {
 *     var overlay = $.overlay.currentOverlay; // jQuery object
 *     if(overlay.data('options').overlayId === 'some-id') {
 * 			overlay.addClass('some-new-class');
 *         // Do something...
 *     }
 * }
 * @title Use of `$.overlay.activeOverlay` and `$.overlay.currentOverlay`
 * @syntax javascript
 * @desc `$.overlay.activeOverlay` is a boolean for testing if an overlay is active. The `$.overlay.currentOverlay` property holds the currently open overlay (a jQuery object). The options for this overlay are attached using `data('options')`. `$.overlay.currentOverlay` is set to `false` if an overlay is not active.
 * 
 * 
 * @example
 * <!-- Use an <h1> to title an overlay -->
 * <h1>The Title of the Overlay</h1>
 * @title Accessibility: Semantic HTML
 * @syntax html
 * @desc All overlay content must conform to standard semantic HTML guidelines. For example, a heading element `<h*>` must be used for all overlay titles.
 * The focus is returned to the target upon closing the overlays.
 * Any element can be used as long as it contains `class="module-title"` and `tabindex="-1"`.
 * A heading element `<h*>` is suggested to retain semantics.
 * If none exist, the main content body is focused instead.
 * 
 * 
 * @example
 * $.overlay.load({
 *     target: '#some-id',
 *     content: 'url/to/the/content-file.php'
 * });
 * @title Accessibility: Refocus Triggering Target to Maintain Context
 * @syntax javascript
 * @desc AT (assistive technologies) should always be placed back in the same context after closing an overlay. Losing context in a complex page means having to re-naviagate through all previous content for every asyncronous action. This is not very friendly. The Overlay Framework takes great measures to make this automatic. But, there are instances where the `$.overlay.load()` method needs to be used to provide developer flexibility. To make sure the original context always regains focus, you must define a `target` element in the `options` object. This element must either be natively focusable or contain the attribute/value `tabindex="-1"`.
 * 
 * 
 * @example 
 * <a class="async" href="url/to/the/content-file.php">Asynchronous Link</a>
 * @title Asynchronous Links within Overlay Content
 * @syntax html
 * @desc For overlays that require its contents to be updated via ajax when an `anchor` is clicked, add `class="async"` to the `anchor` and point the `href` attribute to your content file.
 * 
 * 
 * @example 
 * <a class="modal" href="url/to/the/content-file.php">Some Text</a>
 * @title Overlay creation within Overlay Content
 * @syntax html
 * @desc For overlays that require its content to contain links to new overlays, add `class="modal"` or `class="layer"` to the `anchor` and configure the `href` consistent with the type of overlay needed.
 * 
 * 
 * @example
 * <!-- Expected Markup -->
 * <button class="button sync" value="1" name="some-name" type="submit" title="Some Text"><span class="buttonText">Some Text</span></button>
 * 
 * // Using acme( 'button', options ) is required instead of simply writing the generated markup
 * <?php
 *     acme( 'button', array(
 *         'text' => 'Some Text',
 *         'title' => 'Some Text',
 *         'name' => 'some-name',
 *         'value' => true,
 *         'class' => 'sync'
 *    ));
 * ?>
 * @title Synchronous Form Submits
 * @syntax html
 * @desc For forms that need synchronous submits (no ajax), add `class="sync"` to the submit `button`.
 * 
 * 
 * @example
 * $(document).delegate('{#some-overlay-id}', 'overlay-before-show', function(e) {
 *     var overlay = $.overlay.currentOverlay;
 *     var form    = overlay.find('{#some-form-id}');
 *     form.bind('validated', function(e) {
 *         // e.valid - Boolean - Did the form validate?
 *         if(e.valid) {
 *             console.log('Successful validation Ominture code here');
 *         } else {
 *             console.log('Non-Successful validation Ominture code here');
 *         }
 *     });
 * });
 * @title Adding Omniture to a Form Controlled by the Validation and Overlay Frameworks
 * @syntax javascript
 * @desc When Omniture code needs to be added to forms controlled by the Validation framework and contained within an overlay, the following pattern should be used. The Validation framework fires a `validated` event when the form has been validated. The `event` object contains a `valid` property (`Boolean`) for testing if the clientside validation was successful.
 * 
 * 
 * @param Object options An options object.
 * @option String overlayId Identifier attribute to be added to the overlay. Default is `overlay`.
 * @option String overlayType `modal` or `layer`. `modal`s display a blocking curtain. `layer`s do not. Default is `modal`.
 * @option String mode Currently, the only option for this is `force`. This produces a dark curtain and no close link. The user is forced to make a choice in the overlay. Default is `false`.
 * @option String template What template wrapper to use. The choices are: `xsmall`, `small`, `community`, `medium`, `large`, `xlarge`. Any css class will work as long as there is corresponding css to support the overlay. The default is `default`.
 * @option String content URL to the content file. Default is `false`.
 * @option Mixed data Data that gets sent to the server when the content is requested. The default is `null`.
 * @option Boolean closeLink Show a close link at top of overlay. Default is `true`. [For modals only: If the `mode` option is set to `force` than this option is ignored.]
 * @option String validate If a `form` is present, should it be validated? Default is `true`. Requires an accompanying validation object in the html.
 * @option String position For layers only. Options are: `targetAbove`, the bottom of the overlay shows at the top-right of the target; `targetCenter`, the overlay shows center-right of the target; `targetBelow`, the top of the overlay shows at the top-right of the target; css selector; dom object; jQuery object. The overlay shows top=0 and left=0 of the first matched element. When a css selector, dom object or jQuery object is supplied, the framework will first look for the one closest match (using jQuery's `.closet()`). If nothing was found, it find the first one on the page. Default is `body`.
 * @option Number x [For `layer`s only]. Position the overlay x value absolutely relative to the `body` element. Default is `0`.
 * @option Number y [For `layer`s only]. Position the overlay y value absolutely relative to the `body` element. Default is `0`.
 * @option Number width Override the template's width.
 * @option Number height Override the template's height.
 * @option Function intercept A pre-callback to validate the response object before it is sent to the overlay. Use this to validate data returned from server to determine whether overlay should be shown. The response object is passed as the only argument and must be `json`. `return false` in the function to cancel the overlay, `return` the `response` to show the overlay. Default is `false`.
 * @option Mixed target [Only accepted when using `$.overlay.load()`] Any DOM node, css selector or jQuery object (must be singular, i.e. the selector resolves to only one element in the page, and `id` is recommended). Default is `false`.
 * @option String contentOverride [Only accepted when using `$.overlay.load()`] The markup to be inserted into the overlay. The `content` options is ignored if `contentOverride` is set. Default is `false`.
 * @option String passForm Accepts a jQuery selector string (example: `#myFormID`), serializes the provided form if one is found, and passes the form data to the server when the content is requested. [NOTE - overwrites the data option]  Default is `false`.
 *
 * 
 * @name overlay
 * @type jQuery
 * @author Ryan Fitzer
 */

/*
	Nice-to-haves
	-------------
	- Run preloader between flows
	- Create a tabbing key check to make sure a keyboard user doesn't accidentally tab out of the overlay
	- Figure out a good pattern for destroying the instance (if needed) via 'destroy'. $.data( this, 'overlay', new overlay( options, this ) ); and then self.element.removeData('overlay').
	- IN-PROGRESS -> Allow for a string/jQuery-object/dom-node to be passed instead of options and used as the 'contentOverride'. $().overlay(string|jQuery-object|dom-node); Test (obj instanceof jQuery).
	- $.overlay.setDefaults();
	- Rethink events: pauseshow, beforeshow, show, pausehide, beforehide, hide. 
	- Option to extend overlayType with function for showing new type.
	- Set up curtain click-to-close event as an option.
	- Unit testing
*/

(function($) {
	
	var win = $(window),
		doc = $(document),
		defaults = {
			overlayId: 'overlay',
			overlayType: 'modal',
			mode: false,
			template: 'default',
			content: false,
			image: false,
			div: false,
			data: null,
			closeLink: true,
			validate: false,
			position: 'body',
			x: false,
			y: false,
			width: false,
			height: false,
			intercept: false,
			passForm: false,
			onClose: false
		},
		defaultsLoad = $.extend({
			target: false,
			contentOverride: false
		}, defaults),
		templateMarkup = '<div class="overlay {templateClass}"><div class="content" tabindex="-1"></div><div id="overlay-loading-curtain"></div></div>',
		preloaderMarkup = '<div id="overlay-loader"></div>',
		curtainMarkup = '<div id="overlay-curtain"></div>',
		closeMarkup = '<a id="close" href="#close" class="icon-sprite close"><span class="offscreen">Close</span></a>';
	
	$.fn.overlay = function(options) {
		doc.delegate(this.selector, 'click.overlay', {options: options}, function(e) {
			e.preventDefault();
			new $.overlay(
				this,
				$.extend( {}, defaults, e.data.options instanceof jQuery ? {contentOverride: e.data.options} : e.data.options || {} ),
				false
			);
		});
		return this;
	}
	
	$.overlay = function(element, options, load) {
		this.isLoad	= load ? load : false;
		this.body = $('body');
		this.options = options;
		this.element =
			(element) ? $(element)
			: (this.options.target instanceof jQuery) ? this.options.target.eq(0)
			: this.options.target && $(this.options.target).eq(0);
		this.options.target = this.element.length ? this.element : false;
		this.setup();
	};	
	
	$.overlay.load = function(options) {
		options = $.extend({}, defaultsLoad, options || {});
		new $.overlay(false, options, true);
	};
	
	$.overlay.exception = function(exception, cleanup, log) {
		log =
			typeof exception === 'boolean' ? exception
			: typeof cleanup === 'boolean' ? cleanup
			: typeof log === 'boolean' ? log
			: true;
		cleanup =
			$.isFunction(exception) ? exception
			: $.isFunction(cleanup) ? cleanup
			: $.isFunction(log) ? log
			: false;
		exception =
			(typeof exception === 'string') ? exception
			: 'Stopped due to an undefined exception.';
		var message = exception;
		
		try {
			log && console.log('Overlay.js exception, ' + exception);
			cleanup && cleanup();
		} catch(e) {
			window.console && console.log(e);
		}
		
		window.onerror = function(e) {
			return true;
		}
		setTimeout(function() {
			window.onerror = null;
		}, 100);
		
		throw message;	
	}
		
	$.overlay.preventDuplicate = function(element, showError) {
		showError = typeof showError === 'boolean' ? showError : true;
		var target =
			(element) && (element instanceof jQuery) && element.length ? element.eq(0)
			: (element) && (element = $(element)) && element.length ? element
			: false;
		var cleanup = function() {
			($.overlay.currentOverlay.find('.module-title:first').length)
			? $.overlay.currentOverlay.find('.module-title:first').focus()
			: $.overlay.currentOverlay.find('.content').focus();
		}
		
		if(!target) $.overlay.exception('The "target" supplied to "$.overlay.preventDuplicate" was not valid.', showError);
		if(target.hasClass('overlay-open')) $.overlay.exception('"$.overlay.preventDuplicate" found this overlay already open.', cleanup, showError);

	}
		
	$.overlay.prototype = {
		
		inited: false,
		
		setup: function() {

			var self 	    = this,
				preloader   = self.body.find('#overlay-loader'),
				curtain     = self.body.find('#overlay-curtain');
			
			if(!curtain.length) {
				self.curtain = $(curtainMarkup).appendTo(self.body);
			} else {
				self.curtain = curtain;
			}

			if(!preloader.length) {
				self.loadAnimation = $(preloaderMarkup).appendTo(self.body);
			} else {
				self.loadAnimation = preloader;
			}
			
			self.element && $.overlay.preventDuplicate(self.element, false);
			self.consolidateOptions();
			self.init();
						
		},
		
		init: function() {
			
			var self = this;
			
			if(self.element) {
			    				
				// Add an easy way to check the target's overlay options
				self.element.data('overlay', {});
				for(option in self.options) self.element.data('overlay')[option] = self.options[option];
				
				// Disallow the target to re-init the open modal
				if(self.element.hasClass('overlay-open')) {
					return false;
				} else {    
                    if(!$.overlay.originalTarget) self.element.addClass('overlay-open state-disabled');
				};
			};
			
			self.body.bind('loading.overlay', function(e) {
				self.body.addClass('overlay-loading').unbind('loading.overlay');
			}).bind('loaded.overlay', function(e) {
				self.preloader('hide');
				self.body.removeClass('overlay-loading').unbind('loaded.overlay');
			});
			
			// If there is an overlay showing, we need to close it and then set in motion our new overlay.
			// Triggering a custom event on the body solves the case so functions can run in order.
			if($.overlay.activeOverlay) {
				self.body.bind('overlay-removed', function(e) {
					self.getContent();
				});
				$.overlay.overlayFlow = true;
				$.overlay.currentOverlay.trigger('close.overlay');
			} else {
			    $.overlay.overlayFlow = false;
			    $.overlay.originalTarget = self.element;
				self.preloader('show');
				self.getContent();
			};
		},

		getContent: function() {

			var self 				= this;
			var args				= arguments;
			var url					= (args.length) ? args[0] : self.options.content;
			var intercept			= self.inited === false && $.isFunction(self.options.intercept);
			var dataType			= self.options.dataType;
			self.currentTemplate	= 
				($.overlay.activeOverlay && !self.options.contentOverride)
				? $.overlay.currentOverlay
				: $(templateMarkup.replace('{templateClass}', self.options.template));
			var content				= self.currentTemplate.find('.content');
			var forms				= self.currentTemplate.find('form');
			var data				= 
				(self.options.data !== null && !self.inited) 
				? self.options.data
				: self.inited && forms.length
				? forms.serialize()
				: null;
			
			if(!self.inited) {
				self.body.trigger('loading.overlay');
			}
			
			// If a form is passed with the passForm option, overwrite the data object with the contents of the form
			if(self.options.passForm) {
				data = $(self.options.passForm).serialize();
			};
			
			if (self.options.contentOverride) {

				self.show(self.options.contentOverride);
				self.inited = true;
				
			}
			else if (self.options.image) {
			    
                var attrs = self.options.image.split('|'),
                    src = attrs[0],
                    query = attrs[1] ? '?' + attrs[1].replace('*', '&') : '',
                    alt = attrs[2] || '',
                    width = attrs[3] || '',
                    height = attrs[4] || '',
                    img = new Image();
                
			    img.src = src + query;
			    img.alt = alt;
			    img.width = width;
			    img.height = height;
                
                self.show(img);
				self.inited = true;
				
			}
			else if (self.options.div) {
				self.show(self.options.div);
				self.inited = true;
			}
			else {
				
				$.ajax({
					url: url,
					data: data,
					dataType: intercept ? 'json' : 'html',
					cache: false,
					type: 'POST',
					curtain: false,
					success: function(response, status, xhr) {
						
						var data = response,
						    redirect = xhr.getResponseHeader('X-Redirect');
						
						if(redirect && redirect !== '' ) {
						    return window.location.replace(redirect);
						}
					    
						if(intercept) {
							if(data = self.options.intercept.call(self, response)) {
								if(data.overlayOptions) {
									for(option in data.overlayOptions) {
										self.options[option] && (self.options[option] = data.overlayOptions[option]);
									}
								}
								if(data.overlayOptions.html)
									self.show(data.overlayOptions.html);
								else $.overlay.exception("No html was returned via the object's overlayOptions.html property");
							}
						} else {
							self.show(response);
						}
						self.inited = true;
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						if(XMLHttpRequest.status === 404 ) {
							if(XMLHttpRequest.responseText) {
								self.show(XMLHttpRequest.responseText);
							} else {
								overlay.attr('aria-busy', 'false');
								overlay.removeClass('loading');
							}
						}
						var message = "Request failed: " + self.options.content;
						window.console && console.log(message);
					}
				});
				
			}
	
		},
		
		show: function(response) {
			
			var self = this;
			var overlay, content;
			
			// Reposition or show overlay
			if($.overlay.activeOverlay) {
				
				overlay = $.overlay.currentOverlay;
				
                if($.overlay.currentOverlay.redirect) {
                    self.body.bind('overlay-removed', function(e) {
                        window.location.href = $.overlay.currentOverlay.redirect;
                    });
                    return overlay.trigger('close.overlay');
                }
				
				overlay.find('.content').html(response);
				
				overlay.trigger('overlay-before-show');
				self.processContent();
				overlay.trigger('reposition.overlay');
				overlay.trigger('overlay-show');
				return;
			}
			
			var winWidth	= win.width();
			var winHeight	= win.height();
			var curtainBg	= '#000';
			var layer		= (self.options.overlayType === 'layer');
			var modal		= (self.options.overlayType === 'modal');
			var css			= {};
			css.left		= '-9999em';
 			self.options.width ? css.width = self.options.width + 'px': null;
 			self.options.height ? css.height = self.options.height + 'px': null;
			var showOverlay	= function() {
				
				overlay.css('position', 'absolute');
				
				var pos = self.position();
				if(modal) {
										
					win.bind('resize.overlay', function() {
						self.curtain.width(win.width());
						self.curtain.height(win.height());
					});
					
					self.curtain.css({
						'width': winWidth,
						'height': winHeight,
						'opacity': .80,
						'background': curtainBg
					});

					self.curtain.stop().fadeIn('fast', function() {
						self.curtain.addClass('curtain-open');
						overlay.css({
							top: pos.y,
							left: pos.x,
							position: 'fixed'
						});
						overlay.addClass('modal');
						overlay.fadeIn(500, function() {
						    overlay.trigger('overlay-show');
            				self.body.trigger('loaded.overlay');
						});
					});
				}
				else {
					// Setup drag functionality
					if($.ui.draggable) {
						overlay.prepend('<div class="drag-handle"/>');
						overlay.draggable({
							handle: '.drag-handle',
							containment: 'document',
							start: function(event, ui) {
								overlay.data('reposition', false);
							}
						});
					}

					overlay.css({
						top: pos.y,
						left: pos.x
					});
					overlay.addClass('layer');
					overlay.fadeIn(500, function() {
					    overlay.trigger('overlay-show');
        				self.body.trigger('loaded.overlay');
					});
				}

			}
						
			self.loadingCurtainMarkup = self.currentTemplate.find('#overlay-loading-curtain');
			self.currentTemplate.attr('id', self.options.overlayId);
			self.currentTemplate.css(css);
			self.body.append(self.currentTemplate);
			
			// Assign the overlay over to the global namespace as soon as it's available in the DOM
			overlay = $.overlay.currentOverlay = self.currentTemplate;
			delete self.currentTemplate;
			$.overlay.activeOverlay = true;
			
			// Add an easy way to check the current overlay's options
			// overlay.data('options', {});
			// for(option in self.options) overlay.data('options')[option] = self.options[option];
			overlay.data('options', self.options);
			
			// Insert the returned markup
			contentArea = overlay.find('.content')
			contentArea.html(response);
						
			overlay.bind('overlay-loading', function(event) {

                overlay.attr('aria-busy', 'true');
				overlay.addClass('loading');
				
				self.loadingCurtainMarkup.css({
					opacity: .8,
					'background-color': '#fff',
					width: overlay.width(),
					height: overlay.height()
				});

			});
			
			overlay.bind('overlay-show', function(event) {

                overlay.attr('aria-busy', 'false');
				overlay.removeClass('loading');
				
				if(overlay.isSecure) return;
				
				// Setup Esc key to hide modal
				overlay.unbind('keydown.overlay').bind('keydown.overlay', function(event) {
					var key = event.keyCode;
					if(self.options.mode === 'force' || !self.options.closeLink) return;
					if(key === 27) {
						overlay.trigger('close.overlay', [true]);
					}
				});
				
				self.curtain.bind('click', function(){
					overlay.trigger('close.overlay', [true]);
				});
				
				if( overlay.find('.module-title').length ) {
				    self.shiftFocus(overlay.find('.module-title').get(0));
				} else {
				    self.shiftFocus(overlay.find('.content').get(0));
				}
				
			});
			
			
			
			/* 
			// Looking to find a way to keep one from tabbing out
			// of an overlay since it is usually the last element
			// in the DOM.
			overlay.bind('keypress', function(event) {
				console.log(event);
				if (event.keyCode === 9) {
					console.log('currentTarget', $(event.currentTarget));
					console.log('child', $(event.currentTarget).find(event.target));
					var parent = $(event.target).parent();
					console.log('target', $(event.target));
					if (parent.is('.overlay') && !$(event.target).is('.content')) {
						console.log('run');
						overlay.find('.content').focus();
						return false;
					}
				}
			});
			*/
			
			overlay.bind('close.overlay', function(e, shiftFocus) {
				self.remove(shiftFocus);
			});
			
			overlay.bind('reposition.overlay', function(event) {
				if(overlay.data('reposition') !== false) {
					var pos = self.position();
					overlay.css({
						top: pos.y,
						left: pos.x
					});
				}
			});
			
			// In-progress
			overlay.bind('retemplate.overlay', function(event, overlayId, template, ssl) {
								
				var type = overlay.hasClass('layer') ? 'overlay layer ' : 'overlay modal ';
				overlayId = overlayId ? overlayId : overlay.attr('id');
				
				overlay.attr({
					'id': overlayId,
					'class': type + template
				});
			});
			
			if(overlay.isSecure) {
				overlay.bind('loaded-ssl', function() {
					overlay.trigger('overlay-before-show');
					showOverlay();
				});
			}
			else {
				overlay.trigger('overlay-before-show');
				self.processContent();
				showOverlay();
			}

		},
		
		shiftFocus: function(element) {
		    
		    var el = $(element);


            // To help Assistive Technologies recognize the focus change,
            // the focus change should happen inside a window timeout

            setTimeout(function () {
				el.attr('tabindex', -1);
                element.focus();
                $(document).trigger('updateBuffer.framework');
                if(element === $.overlay.originalTarget) $.overlay.originalTarget = false;
				el.removeAttr('tabindex');
            }, 0);
		    
		},
		
		remove: function(shiftFocus) {
			
			$.overlay.overlayFlow = shiftFocus ? false : true;
			
			if($.overlay.activeOverlay) {
				
				var self, body, layer, modal;
				
				$.overlay.activeOverlay = false;
				
				self	= this;
				body	= self.body;
				layer	= (self.options.overlayType === 'layer');
				modal	= (self.options.overlayType === 'modal');

				$.overlay.currentOverlay.trigger('overlay-before-hide');
				
				if (TARGET.Config.isIE){
					self.curtain.css({
						height: 0,
						width: 0,
						'visibility': 'visible',
						'display': 'block'
					}).removeClass('curtain-open');
					
					$.overlay.currentOverlay.remove();
					$.overlay.currentOverlay = false;
					body.trigger('overlay-hide', ['#' + self.options.overlayId]);
					body.trigger('overlay-removed').unbind('overlay-removed');
				}
				
				else {
					
					$.overlay.currentOverlay.fadeOut('fast', function() {
						if(self.curtain.hasClass('curtain-open')) {
							self.curtain.fadeOut('fast', function() {
								self.curtain.css({
									height: 0,
									width: 0,
									'visibility': 'visible',
									'display': 'block'
								}).removeClass('curtain-open');
							});
	
							win.unbind('resize.overlay');
						}
	
						$.overlay.currentOverlay.remove();
						$.overlay.currentOverlay = false;
						body.trigger('overlay-hide', ['#' + self.options.overlayId]);
						body.trigger('overlay-removed').unbind('overlay-removed');
					});
				}

				win.unbind('resize.overlay');

				// Return focus to the original target for accessibility
				if ( !$.overlay.overlayFlow ) {
					if($.overlay.originalTarget) {
						$.overlay.originalTarget.removeClass('overlay-open state-disabled');
						self.shiftFocus($.overlay.originalTarget);
						$(document).trigger('updateBuffer.framework');
					}
				}

				self.inited = false;
				
				if (typeof self.options.onClose == 'function') {
					self.options.onClose.call(self);
				}
			}
		},
		
		processContent: function() {
			
			var self 	= this,
				overlay	= $.overlay.currentOverlay,
				forms 	= overlay.find('form');
			
			if(!self.inited) {
				
				// Add the close link
				if(self.options.mode !== 'force' && self.options.closeLink) {
					overlay.append(closeMarkup);
				}
				
				// Setup any ajax links
				overlay.delegate('a.async', 'click', function(e) {
					self.getContent(e.currentTarget.href);
					return false;
				});
				

				// Setup any close/cancel button links
				overlay.delegate('#close, .close, .cancel', 'click', function() {
					overlay.trigger('close.overlay', [true]);
					return false;
				});
				
			}
			
			// Setup form ajax
			// if(forms.length) {
			// 	
			// 	forms.each(function(i, form) {
			// 		
			// 		var form = $(this);
			// 		
			// 		form.data('overlay-form', true);
			// 		form.data('overlay-form-index', i);
			// 
			// 		// Add hidden inputs for buttons
			// 		form.delegate('input:submit, button', 'click', function(event) {
			// 
			// 			var button		= $(this);
			// 			var name 		= button.attr('name');
			// 			var classes		= button.attr('class').replace(/button/, '');
			// 			var value		= (function() {
			// 				var realValue;
			// 				if($.browser.msie) {
			// 					if(button.is('button')) {
			// 						var buttonHtml = button.html();
			// 						button.html('');
			// 						realValue = button.attr('value');
			// 						button.html(buttonHtml);
			// 					}
			// 				} else {
			// 					realValue = button.attr('value');
			// 				}
			// 				return realValue;
			// 			})();
			// 			var input		= $('<input type="hidden" name="' + name + '" class="' + classes + '" value="' + value + '"/>');
			// 			var inputFound	= button.parent().find('input[name="' + name + '"]').length;
			// 			if(!inputFound) {
			// 				button.after(input);
			// 			}
			// 		});
			// 
			// 		self.submitHandler(form);
			// 		
			// 	});
			// }
		},
		
		submitHandler: function(form) {
			
			var self				= this,
				formIndex			= form.data('overlay-form-index'),
				formEvents 			= form.data('events'),
				validate 			= self.options.validate,
				validationObj		= Target.validation,
				validationArgs		= validationObj.length ? validationObj[formIndex] : validationObj,
				sync				= form.find('input, button').hasClass('sync'),
				returnValue			= true,
				pauseSubmitHandlers,
				submitHandler,
				action;
				
			
			$.overlay.currentOverlay.bind('overlay-show', function(e) {
				
				$.overlay.currentOverlay.unbind(e);
				
				// Move the validation object's submitHandler to pausesubmit.overlay event
				if(validate && validationArgs.submitHandler) {
					form.bind('pausesubmit.overlay', {
						submitHandler: validationArgs.submitHandler
					}, function(e) {
						e.data.submitHandler.call(form.data('validator'), form.get(0));
					});
					delete validationArgs.submitHandler;
				}
				
				// Define the length of pausesubmit.overlay handlers
				pauseSubmitHandlers = (formEvents && formEvents.pausesubmit)
					? formEvents.pausesubmit.length - 1
					: 0;

				// Bind resumesubmit.overlay and run the submit handler (only one is supported).
				// The submit handler runs when all pausesubmit.overlay handlers have been executed
				if(formEvents && formEvents.submit) {
					form.bind('resumesubmit.overlay', {
						submitHandler: formEvents.submit[0].handler
					}, function(e) {
						(!pauseSubmitHandlers--) && e.data.submitHandler.call(form.get(0), e);
					});				
				}
				// Bind resumesubmit.overlay and run the default handler.
				// The default handler runs when all pausesubmit.overlay handlers have been executed
				else {
					form.bind('resumesubmit.overlay', function(e) {
						if(!pauseSubmitHandlers--) {
							if(sync) {
								form.get(0).submit();
							} else {							
								self.getContent(form.attr('action'));
							}
						}
					});
				}
				
				// Bind the submit.overlay
				form.unbind('submit').bind('submit.overlay', function(e) {
					
					e.preventDefault();
										
					action = (formEvents && formEvents.pausesubmit) ? 'pausesubmit' : 'resumesubmit';

					validate
					&& form.validate(validationArgs).form()
					&& $.overlay.currentOverlay.trigger('overlay-loading')
					&& form.trigger(action + '.overlay');
					
					!validate
					&& $.overlay.currentOverlay.trigger('overlay-loading')
					&& form.trigger(action + '.overlay');
				});
								
			});
		
		},
				
		position: function() {
			
			var self = this;
			
			// Atomic position: If an 'x' or 'y' value was set
			if(self.options.x || self.options.y) {
				return {
					x: (self.options.x) ? self.options.x + 'px' : 0,
					y: (self.options.y) ? self.options.y + 'px' : 0
				}
			}

			var win				= $(window);
			var winWidth		= win.width();
			var winHeight		= win.height();
			var core			= $('#Core');
			var scrolltop		= win.scrollTop();
			var scrollleft		= win.scrollLeft();
			var layer			= (self.options.overlayType === 'layer');
			var modal			= (self.options.overlayType === 'modal');
			var targetAbove		= (self.options.position === 'targetAbove');
			var targetCenter	= (self.options.position === 'targetCenter');
			var targetBelow		= (self.options.position === 'targetBelow');
			var posElement		= self.options.position;
			var templateWidth 	= self.options.width ? self.options.width : $.overlay.currentOverlay.width();
			var templateHeight 	= self.options.height ? self.options.height : $.overlay.currentOverlay.height();
			var tooTall			= templateHeight > winHeight ? scrolltop + 10 + 'px' : false;
			var defaultPosition	= {
				x: ((winWidth - templateWidth) / 2) + 'px',
				y: tooTall ? tooTall : ((winHeight - templateHeight) / 2 + scrolltop) + 'px'
			}
			
			var modalDefaultPosition	= {
				x: ((winWidth - templateWidth) / 2) + 'px',
				y: ((winHeight - templateHeight) / 2) + 'px'
			}

			// Layers need a bit more care to determine position
			if(layer) {
				if(!self.element) {
					if(self.options.position.jquery && !self.options.position.is('body') && self.options.position.length) {
						var posTarget		= self.options.position;
						var posTargetTop	= posTarget.offset().top;

						if(scrolltop > posTargetTop) {
							$('html, body').animate({
								scrollTop: posTargetTop - 10
							}, 'fast');
						}
						return {
					  		x: posTarget.offset().left + 'px',
					  		y: posTarget.offset().top + 'px'
					  	}
					} else {
						return defaultPosition;
					}
				}

				var targetWidth	= self.element.width();
				var targetTop  	= self.element.offset().top;
				var targetLeft 	= self.element.offset().left;
				var targetRight	= targetWidth + targetLeft;
				var offset 		= self.getViewportOffset({
					viewportWidth: winWidth,
					viewportTop: scrolltop,
					positionRight: targetRight + templateWidth,
					positionTop: targetTop - (templateHeight / 2)
				});
				
				// If the event target is provided, position relative
				if(targetAbove) {
					return {
						x: targetRight - offset.x + 'px',
						y: tooTall ? tooTall : targetTop + offset.y - templateHeight + 'px'
					}
				} 
				
				else if(targetCenter) {
					return {
						x: ( winWidth - templateWidth ) / 2 + scrollleft + 'px',
						y: ( winHeight - templateHeight ) / 2 + scrolltop + 'px'
					}
				}
				
				else if(targetBelow) {
					return {
						x: targetRight - offset.x + 'px',
						y: targetTop + offset.y + 'px'
					}
				}
				
				// If a selector was provided, traverse up from the target and position relative
				else if(self.options.position.jquery && !self.options.position.is('body') && posElement.length) {

					var relParent 			= self.element.closest(posElement);
					var referencePoint		= relParent.length ? relParent : posElement
					var referencePointTop	= referencePoint.offset().top;
					
					if(scrolltop > referencePointTop) {
						$('html, body').animate({
							scrollTop: referencePointTop - 10
						}, 'fast');
					}
					return {
				  		x: referencePoint.offset().left + 'px',
				  		y: referencePoint.offset().top + 'px'
				  	}
				}
				
				// If no position was specified use the default
				else {
					return defaultPosition;
				}
			}
			
			// Modals get the default position
			if(modal) {
				return modalDefaultPosition;
			}
						
		},
		
		preloader: function(action) {
			
			var win,
			    winWidth,
			    winHeight,
			    scrolltop,
			    wLoader,
			    hLoader,
			    self = this;
						
			if(action === 'hide') {
				self.loadAnimation.hide();
			} else {
			    
			    win         = $(window);
                winWidth    = win.width();
                winHeight   = win.height();
                scrolltop   = win.scrollTop();
                wLoader     = self.loadAnimation.width();
                hLoader     = self.loadAnimation.height();
                wBody       = self.body.width();
                hBody       = self.body.height();


				self.loadAnimation.hide();
				self.loadAnimation.css({
					top: (winHeight / 2) - (hLoader / 2),
					left: (winWidth / 2) - (wLoader / 2)
				});
				self.loadAnimation.fadeIn();
			}
		},
		
		getViewportOffset: function(position) {
			
			var offset = {
				x: 0,
				y: 0
			};
			
			if(position.positionRight > position.viewportWidth) {
				offset.x = position.positionRight - position.viewportWidth + 10;
			}
			
			if(position.viewportTop > position.positionTop) {
				offset.y = position.viewportTop - position.positionTop + 10;
			}
			
			return offset;
			
		},

		consolidateOptions: function() {

			var self 		= this,
				options		= self.options,
				hrefOptions = {},
				sameHandling;			

			// Get all the configuration details
			// All variables are checked in the element's class/href first and
			// then in the options passed to the plugin (for manual instantiation)
			self.element
			&& (self.element.attr('href') !== undefined)
			&& (hrefOptions = self.parseQueryString(self.element.attr('href')));

			// The following options get processed the same;
			sameHandling = ['x', 'y', 'mode', 'data', 'width', 'height', 'template', 'overlayId', 'image'];
			$.each(sameHandling, function(i, name) {
				self.options[name] = (hrefOptions[name] !== undefined) ? hrefOptions[name] : options[name];
			});
			
			// The following options have special processing
			self.options.position =
				(/^target/.test(hrefOptions.position))
				? hrefOptions.position
				: $(hrefOptions.position).eq(0).length && $(hrefOptions.position).eq(0) || $(self.options.position);

			self.options.overlayType =
				(hrefOptions.overlayType !== undefined) ? hrefOptions.overlayType
				: (self.element) && self.element.hasClass('layer') ? 'layer'
				: (self.element) && self.element.hasClass('modal') ? 'modal'
				: self.options.overlayType;
				
			self.options.content =
				(hrefOptions.content !== undefined) ? hrefOptions.content
				: (self.options.content) ? self.options.content
				: (self.element) ? self.element.attr('href')
				: self.options.content;

			self.options.closeLink =
				(hrefOptions.closeLink !== undefined)
				? hrefOptions.closeLink === 'true'
				: self.options.closeLink;

			self.options.validate =				
				($.validator)
				? (hrefOptions.validate !== undefined) && (hrefOptions.validate === 'true') || self.options.validate
				: false;
				
			self.options.passForm =
				(hrefOptions.passForm !== undefined)
				? $(hrefOptions.passForm).eq(0).length && $(hrefOptions.passForm).eq(0) || false
				: self.options.passForm;
						
			//if((self.options.content === '' || self.options.content === '#' || !self.options.content) && !self.options.contentOverride) $.overlay.exception('self.options.content and self.options.contentOverride are false.');
		},
		
		parseQueryString: function(href) {

			var collection	= {};
			var querystring	= href.split('?')[1];
			var pairs;

			if(!querystring) return false;

			querystring	= decodeURI(querystring);
			pairs	 	= querystring.split("&");

			for(var i = 0; i < pairs.length; i++) {
			    if(!pairs[i]) {
			        continue;
			    }
			    var seperatorPosition = pairs[i].indexOf("=");
			    if(seperatorPosition == -1) {
			        collection[pairs[i]] = "";
			    } else {
			    	collection[pairs[i].substring(0, seperatorPosition)] = pairs[i].substr(seperatorPosition + 1).replace(/#amp#/,'&');
			    }
			}
			return collection;
		}
		
	}
	
})(jQuery);

// Let the base framework know about us.
// $(window).trigger('register.framework', ['plugin', 'Overlay', $.overlay.registration]);

// Auto instantiation. Uses delegate(). No need for ready() wrapper.
// Can be moved to a global file if needed.
$('.modal:not(.overlay), .layer:not(.overlay)').overlay();
/* jquery.anystretch.min.js */
/*
 * jQuery Anystretch
 * Version 1.1
 * https://github.com/danmillar/jquery-anystretch
 *
 * Add a dynamically-resized background image to the body
 * of a page or any other block level element within it
 *
 * Copyright (c) 2012 Dan Millar (@danmillar / decode.uk.com)
 * Dual licensed under the MIT and GPL licenses.
 *
 * This is a fork of jQuery Backstretch (v1.2)
 * Copyright (c) 2011 Scott Robbin (srobbin.com)
*/
;(function ($) { $.fn.anystretch = function (src, options, callback) { var isBody = this.selector.length ? false : true; return this.each(function (i) { var defaultSettings = { positionX: 'center', positionY: 'center', speed: 0, elPosition: 'relative' }, el = $(this), container = isBody ? $('.anystretch') : el.children(".anystretch"), settings = container.data("settings") || defaultSettings, existingSettings = container.data('settings'), imgRatio, bgImg, bgWidth, bgHeight, bgOffset, bgCSS; if (options && typeof options == "object") $.extend(settings, options); if (options && typeof options == "function") callback = options; $(document).ready(_init); return this; function _init() { if (src) { var img; if (!isBody) { el.css({ position: settings.elPosition, background: "none" }) } if (container.length == 0) { container = $("<div />").attr("class", "anystretch").css({ left: 0, top: 0, position: (isBody ? "fixed" : "absolute"), overflow: "hidden", zIndex: (isBody ? -999999 : -999998), margin: 0, padding: 0, height: "100%", width: "100%" }) } else { container.find("img").addClass("deleteable") } img = $("<img />").css({ position: "absolute", display: "none", margin: 0, padding: 0, border: "none", zIndex: -999999 }).bind("load", function (e) { var self = $(this), imgWidth, imgHeight; self.css({ width: "auto", height: "auto" }); imgWidth = this.width || $(e.target).width(); imgHeight = this.height || $(e.target).height(); imgRatio = imgWidth / imgHeight; _adjustBG(function () { self.fadeIn(settings.speed, function () { container.find('.deleteable').remove(); if (typeof callback == "function") callback() }) }) }).appendTo(container); if (el.children(".anystretch").length == 0) { if (isBody) { $('body').append(container) } else { el.append(container) } } container.data("settings", settings); img.attr({ "src": src, "alt": "" }); $(window).resize(_adjustBG) } } function _adjustBG(fn) { try { bgCSS = { left: 0, top: 0 }; bgWidth = _width(); bgHeight = bgWidth / imgRatio; if (bgHeight >= _height()) { bgOffset = (bgHeight - _height()) / 2; if (settings.positionY == 'center' || settings.centeredY) { $.extend(bgCSS, { top: "-" + bgOffset + "px" }) } else if (settings.positionY == 'bottom') { $.extend(bgCSS, { top: "auto", bottom: "0px" }) } } else { bgHeight = _height(); bgWidth = bgHeight * imgRatio; bgOffset = (bgWidth - _width()) / 2; if (settings.positionX == 'center' || settings.centeredX) { $.extend(bgCSS, { left: "-" + bgOffset + "px" }) } else if (settings.positionX == 'right') { $.extend(bgCSS, { left: "auto", right: "0px" }) } } container.children("img:not(.deleteable)").width(bgWidth).height(bgHeight).filter("img").css(bgCSS) } catch (err) { } if (typeof fn == "function") fn() } function _width() { return isBody ? el.width() : el.innerWidth() } function _height() { return isBody ? el.height() : el.innerHeight() } }) }; $.anystretch = function (src, options, callback) { var el = ("onorientationchange" in window) ? $(document) : $(window); el.anystretch(src, options, callback) } })(jQuery);
