#!/bin/bash

DB=empirelogistics

## Drop db
#echo "Dropping $DB"
#dropdb $DB

## Drop user
#echo "Dropping user"
#psql -c "DROP OWNED BY el CASCADE"
#dropuser el

## Create role el
#echo "Creating password"
#password=`cat etc/passwords/el-pgsql`
#echo "Creating user"
#psql -c "create role el WITH NOSUPERUSER CREATEDB LOGIN REPLICATION PASSWORD '$password';"

#echo "Creating $DB"
#createdb $DB
echo "Enabling PostGIS"
psql -U postgres -q -d $DB -c "create extension if not exists postgis"
psql -U postgres -q -d $DB -c "create extension if not exists postgis_topology"
psql -U postgres -q -d $DB -c "create or replace language plpgsql"
echo "Granting privileges to el"
psql -U postgres -q -c "grant all privileges on database $DB to el"
psql -U postgres -q -c "alter database $DB owner to el"
for tbl in `psql -U postgres -qAt -c "select tablename from pg_tables where schemaname = 'public';" $DB` ; do  psql -U postgres -q -c "alter table $tbl owner to el" $DB ; done
echo "Importing schema"
psql -U el -q -d $DB < etc/schema/schema.sql
