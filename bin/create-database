#!/bin/bash

DB=empirelogistics

## Drop db
#echo "Dropping $DB"
#dropdb $DB 

## Drop user
#echo "Dropping user"
#psql -c "DROP OWNED BY el CASCADE"
#dropuser el

## Create role el
#echo "Creating password"
#password=`cat etc/passwords/el-pgsql`
#echo "Creating user"
#psql -c "create role el WITH NOSUPERUSER CREATEDB LOGIN REPLICATION PASSWORD '$password';"

#echo "Creating $DB"
#createdb $DB
echo "Enabling PostGIS"
psql -U postgres -q -d $DB -c "create extension if not exists postgis"
psql -U postgres -q -d $DB -c "create extension if not exists postgis_topology"
psql -U postgres -q -d $DB -c "create or replace language plpgsql"
echo "Granting privileges to el"
psql -U postgres -q -c "grant all privileges on database $DB to el"
psql -U postgres -q -c "alter database $DB owner to el"
for tbl in `psql -U postgres -qAt -c "select tablename from pg_tables where schemaname = 'public';" $DB` ; do  psql -U postgres -q -c "alter table $tbl owner to el" $DB ; done
echo "Importing rail_ownership schema"
psql -U el -q -d $DB < etc/schema/rail_ownership.sql
echo "Importing state schema"
psql -U el -q -d $DB < etc/schema/state.sql
echo "Importing rail_subdivision schema"
psql -U el -q -d $DB < etc/schema/rail_subdivision.sql
echo "Importing rail_subdivision_state join table schema"
psql -U el -q -d $DB < etc/schema/rail_subdivision_state.sql
echo "Importing rail line attribute lookup tables"
psql -U el -q -d $DB < etc/schema/rail_track_type.sql
psql -U el -q -d $DB < etc/schema/rail_track_grade.sql
psql -U el -q -d $DB < etc/schema/rail_track_gauge.sql
psql -U el -q -d $DB < etc/schema/rail_status.sql
psql -U el -q -d $DB < etc/schema/rail_density.sql
psql -U el -q -d $DB < etc/schema/rail_signal.sql
psql -U el -q -d $DB < etc/schema/rail_passenger.sql
psql -U el -q -d $DB < etc/schema/rail_military.sql
psql -U el -q -d $DB < etc/schema/rail_line_class.sql
echo "Importing port attribute lookup tables"
psql -U el -q -d $DB < etc/schema/port_depth.sql
psql -U el -q -d $DB < etc/schema/port_depth_feet.sql
psql -U el -q -d $DB < etc/schema/port_depth_meters.sql
psql -U el -q -d $DB < etc/schema/port_drydock.sql
psql -U el -q -d $DB < etc/schema/port_harbor_size.sql
psql -U el -q -d $DB < etc/schema/port_harbor_type.sql
psql -U el -q -d $DB < etc/schema/port_repair.sql
psql -U el -q -d $DB < etc/schema/port_shelter.sql
psql -U el -q -d $DB < etc/schema/port_vessel_size.sql
echo "Importing warehouse and warehouse attribute lookup tables"
psql -U el -q -d $DB < etc/schema/warehouse_status.sql
psql -U el -q -d $DB < etc/schema/warehouse_type.sql
psql -U el -q -d $DB < etc/schema/warehouse_owner.sql
psql -U el -q -d $DB < etc/schema/walmart.sql
psql -U el -q -d $DB < etc/schema/warehouse.sql
psql -U el -q -d $DB < etc/schema/warehouse_walmart.sql
